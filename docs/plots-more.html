<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reporting with Data in R - 8&nbsp; Deeper into ggplot</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tidy-data.html" rel="next">
<link href="./plots.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./plots.html">Visualization</a></li><li class="breadcrumb-item"><a href="./plots-more.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Deeper into ggplot</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Reporting with Data in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Install Party</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Counting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./billboard-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Billboard Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./billboard-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Billboard Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Summing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./leso-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Military Surplus Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./leso-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Military Surplus Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Intro to ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plots-more.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Deeper into ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidy-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tidy data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Bind &amp; Join</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./denied-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Denied Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./denied-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Denied analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">R Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./posit-cloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Using posit.cloud</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./group-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Grouping by dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">A counting shortcut</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Troubleshooting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./explore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Exploring a new dataset</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./charts-tips.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Chart production tips</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-goals-for-this-chapter" id="toc-learning-goals-for-this-chapter" class="nav-link active" data-scroll-target="#learning-goals-for-this-chapter"><span class="header-section-number">8.1</span> Learning goals for this chapter</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">8.2</span> References</a></li>
  <li><a href="#set-up-your-notebook" id="toc-set-up-your-notebook" class="nav-link" data-scroll-target="#set-up-your-notebook"><span class="header-section-number">8.3</span> Set up your notebook</a>
  <ul class="collapse">
  <li><a href="#lets-get-the-data" id="toc-lets-get-the-data" class="nav-link" data-scroll-target="#lets-get-the-data"><span class="header-section-number">8.3.1</span> Let’s get the data</a></li>
  </ul></li>
  <li><a href="#goal-1-line-chart" id="toc-goal-1-line-chart" class="nav-link" data-scroll-target="#goal-1-line-chart"><span class="header-section-number">8.4</span> Goal 1: Line chart</a>
  <ul class="collapse">
  <li><a href="#working-through-logic" id="toc-working-through-logic" class="nav-link" data-scroll-target="#working-through-logic"><span class="header-section-number">8.4.1</span> Working through logic</a></li>
  <li><a href="#wrangling-the-data" id="toc-wrangling-the-data" class="nav-link" data-scroll-target="#wrangling-the-data"><span class="header-section-number">8.4.2</span> Wrangling the data</a></li>
  <li><a href="#plot-the-chart" id="toc-plot-the-chart" class="nav-link" data-scroll-target="#plot-the-chart"><span class="header-section-number">8.4.3</span> Plot the chart</a></li>
  <li><a href="#cleaning-up" id="toc-cleaning-up" class="nav-link" data-scroll-target="#cleaning-up"><span class="header-section-number">8.4.4</span> Cleaning Up</a></li>
  <li><a href="#saving-plots-as-an-object" id="toc-saving-plots-as-an-object" class="nav-link" data-scroll-target="#saving-plots-as-an-object"><span class="header-section-number">8.4.5</span> Saving plots as an object</a></li>
  </ul></li>
  <li><a href="#themes" id="toc-themes" class="nav-link" data-scroll-target="#themes"><span class="header-section-number">8.5</span> Themes</a>
  <ul class="collapse">
  <li><a href="#more-with-ggthemes" id="toc-more-with-ggthemes" class="nav-link" data-scroll-target="#more-with-ggthemes"><span class="header-section-number">8.5.1</span> More with ggthemes</a></li>
  </ul></li>
  <li><a href="#goal-2-multiple-line-chart" id="toc-goal-2-multiple-line-chart" class="nav-link" data-scroll-target="#goal-2-multiple-line-chart"><span class="header-section-number">8.6</span> Goal 2: Multiple line chart</a>
  <ul class="collapse">
  <li><a href="#prepare-the-data" id="toc-prepare-the-data" class="nav-link" data-scroll-target="#prepare-the-data"><span class="header-section-number">8.6.1</span> Prepare the data</a></li>
  <li><a href="#plot-the-chart-1" id="toc-plot-the-chart-1" class="nav-link" data-scroll-target="#plot-the-chart-1"><span class="header-section-number">8.6.2</span> Plot the chart</a></li>
  </ul></li>
  <li><a href="#on-your-own" id="toc-on-your-own" class="nav-link" data-scroll-target="#on-your-own"><span class="header-section-number">8.7</span> On your own</a></li>
  <li><a href="#tour-of-some-other-adjustments" id="toc-tour-of-some-other-adjustments" class="nav-link" data-scroll-target="#tour-of-some-other-adjustments"><span class="header-section-number">8.8</span> Tour of some other adjustments</a>
  <ul class="collapse">
  <li><a href="#line-width" id="toc-line-width" class="nav-link" data-scroll-target="#line-width"><span class="header-section-number">8.8.1</span> Line width</a></li>
  <li><a href="#line-type" id="toc-line-type" class="nav-link" data-scroll-target="#line-type"><span class="header-section-number">8.8.2</span> Line type</a></li>
  </ul></li>
  <li><a href="#facets" id="toc-facets" class="nav-link" data-scroll-target="#facets"><span class="header-section-number">8.9</span> Facets</a>
  <ul class="collapse">
  <li><a href="#facet-grids" id="toc-facet-grids" class="nav-link" data-scroll-target="#facet-grids"><span class="header-section-number">8.9.1</span> Facet grids</a></li>
  </ul></li>
  <li><a href="#interactive-plots" id="toc-interactive-plots" class="nav-link" data-scroll-target="#interactive-plots"><span class="header-section-number">8.10</span> Interactive plots</a></li>
  <li><a href="#what-we-learned" id="toc-what-we-learned" class="nav-link" data-scroll-target="#what-we-learned"><span class="header-section-number">8.11</span> What we learned</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Deeper into ggplot</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>The chapter is by Prof.&nbsp;Lukito, with edits from Prof.&nbsp;McDonald.</p>
</div>
</div>
</div>
<p>In the last chapter, you were introduced to <a href="https://ggplot2.tidyverse.org/index.html">ggplot2</a>, the <code>tidyverse</code> package that helps you build graphics, charts, and figures. In this chapter, we’ll take your <code>ggplot</code> knowledge to the next level. We encourage you to treat this chapter as a reference.</p>
<section id="learning-goals-for-this-chapter" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="learning-goals-for-this-chapter"><span class="header-section-number">8.1</span> Learning goals for this chapter</h2>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>How to prepare and build a line chart<br>
</li>
<li>How to use themes to change the looks of a chart<br>
</li>
<li>More about aesthetics in layers!<br>
</li>
<li>Faceting, or making multiple charts from the same data<br>
</li>
<li>How to make interactive plots with <code>Plotly</code></li>
</ul>
</section>
<section id="references" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="references"><span class="header-section-number">8.2</span> References</h2>
<p><code>ggplot2</code> has a LOT to it and we’ll cover only the basics. Here are some references you might use:</p>
<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/index.html">The ggplot2 documentation</a> and <a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization-2.1.pdf">ggplot2 cheatsheets</a>.</li>
<li><a href="https://r4ds.hadley.nz/data-visualize.html">R for Data Science, Chap 3.</a> Hadley Wickham dives right into plots in his book.</li>
<li><a href="https://ggplot2-book.org/index.html">ggplot2: Elegant graphics for Data Analysis</a> by Wickham.</li>
<li><a href="https://r-graphics.org/">R Graphics Cookbook</a> has lots of example plots. Good to harvest code and see how to do things.</li>
<li><a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a> another place to see examples.</li>
</ul>
</section>
<section id="set-up-your-notebook" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="set-up-your-notebook"><span class="header-section-number">8.3</span> Set up your notebook</h2>
<p>This week, we’ll return to our Military Surplus project, but add a new Quarto Document.</p>
<ol type="1">
<li>Open your <code>name-military-surplus</code> project.</li>
<li>Create a new Quarto Document.</li>
<li>Set the title as “Military Surplus figures”</li>
<li>Remove the rest of the boilerplate template.</li>
<li>Save the file and name it <code>03-ggplot.qmd</code>.</li>
<li>Create a setup chunk and load the <code>tidyverse</code> library. Also load a library called <code>scales</code>, though you shouldn’t have to install it as it comes with the tidyverse package.</li>
</ol>
<p>You’ll also need to install the <a href="">scales</a> package and include that in your library.</p>
<ol start="7" type="1">
<li>In your <strong>Console</strong>, run <code>install.packages("scales)</code></li>
<li>Then back in your notebook add <code>library(scales)</code> to your setup chunk.</li>
</ol>
<section id="lets-get-the-data" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="lets-get-the-data"><span class="header-section-number">8.3.1</span> Let’s get the data</h3>
<p>We’ll be importing the cleaned data that has all the states.</p>
<ol type="1">
<li>Create a new section that notes you are importing</li>
<li>Use <code>read_rds()</code> to import the file and save it into an object called <code>leso</code>. The file should be at <code>data-processed/01-leso-all.rds</code> if you named it correctly in our <a href="./leso-cleaning.html#leso-export">analysis</a> .</li>
<li>Glimpse the data so we can see the column names</li>
</ol>
<div class="cell">
<details>
<summary>You should be able to do this by now!</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>leso <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data-processed/01-leso-all.rds"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(leso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 67,603
Columns: 13
$ state             &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL"…
$ agency_name       &lt;chr&gt; "ABBEVILLE POLICE DEPT", "ABBEVILLE POLICE DEPT", "A…
$ nsn               &lt;chr&gt; "2355-01-553-4634", "1005-01-587-7175", "1240-01-411…
$ item_name         &lt;chr&gt; "MINE RESISTANT VEHICLE", "MOUNT,RIFLE", "SIGHT,REFL…
$ quantity          &lt;dbl&gt; 1, 10, 9, 10, 1, 1, 1, 3, 1, 17, 10, 7, 6, 4, 4, 1, …
$ ui                &lt;chr&gt; "Each", "Each", "Each", "Kit", "Each", "Each", "Each…
$ acquisition_value &lt;dbl&gt; 658000.00, 1626.00, 371.00, 15871.59, 10000.00, 6262…
$ demil_code        &lt;chr&gt; "C", "D", "D", "D", "Q", "C", "C", "D", "C", "A", "A…
$ demil_ic          &lt;dbl&gt; 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 3, 3, 1, 1, 1, 1, 3…
$ ship_date         &lt;dttm&gt; 2016-11-09 00:00:00, 2016-09-19 00:00:00, 2016-09-1…
$ station_type      &lt;chr&gt; "State", "State", "State", "State", "State", "State"…
$ total_value       &lt;dbl&gt; 658000.00, 16260.00, 3339.00, 158715.90, 10000.00, 6…
$ control_type      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE…</code></pre>
</div>
</div>
<p>Above we can see the columns were working with.</p>
</section>
</section>
<section id="goal-1-line-chart" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="goal-1-line-chart"><span class="header-section-number">8.4</span> Goal 1: Line chart</h2>
<p>For our first chart here we are looking to plot the total acquisitions value for each year in the state of Texas. It can sometimes help to draw on paper the chart you are hoping to make so you can see how to format the data to make it.</p>
<p>In our case, we’ll need to summarize our data by the year of the shipping date, then add together all the value of the equipment. Here is how we’ll want to structure our data and the chart we’ll make from it.</p>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dttm"],"align":["right"]},{"label":["yearly_value"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2010-01-01","2":"6712835"},{"1":"2011-01-01","2":"2044525"},{"1":"2012-01-01","2":"3597949"},{"1":"2013-01-01","2":"9659423"},{"1":"2014-01-01","2":"42784125"},{"1":"2015-01-01","2":"2265993"},{"1":"2016-01-01","2":"15909307"},{"1":"2017-01-01","2":"13009289"},{"1":"2018-01-01","2":"7220476"},{"1":"2019-01-01","2":"12446415"},{"1":"2020-01-01","2":"4495945"},{"1":"2021-01-01","2":"4598806"},{"1":"2022-01-01","2":"3611528"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-example-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>But we don’t have this data in the format, so we need to make it.</p>
<section id="working-through-logic" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="working-through-logic"><span class="header-section-number">8.4.1</span> Working through logic</h3>
<p>Data visualization is an iterative process: you may prepare the data, do the visualization, and then realize you want to prepare the data a different way. Remember that the process of coding can involve trial and error: you’re often testing different thing to see what works.</p>
<p>There are lots of choices we could make on <em>how</em> to do this, and I explored several different paths while making this chart. While I won’t go through every possible scenario, I’ll try to explain why I made the decisions I did. If I was doing this on my own, I might record these explorations and thoughts in my notebook so I could have a record of why I did things. It’s not like other ways are wrong, they just have different pros and cons.</p>
<p>To kinda walk through this with the chart first:</p>
<ul>
<li>Along the X axis we want to plot each year. Since our data starts as individual transfers and their date, this is a clue that we need to group by the year of that shipping date.</li>
<li>Along the Y axis we want to plot the value of all the equipment in Texas. That’s a clue that we need to summarize our data to add up the value of the equipment.</li>
</ul>
<p>The most exploration came around how I grouped this data by year. There are a myriad of ways to do this, like using <code>year()</code> to pluck the year from the shipping date to make a number like <code>2023</code> or to then convert that to text as “2023”. I chose to create a “floor date” so I end up with a real date because it gives me more flexibility with plotting. ggplot has some tools where I can format the date the way I want, though I admit I had to go learn about them to do this lesson!</p>
<p>The function <a href="https://lubridate.tidyverse.org/reference/round_date.html"><code>floor_date()</code></a> rounds a date <em>down</em> to a common value, but it remains a real date. If I convert both “2023-10-18” and “2023-10-28” to a floor_date unit of “year” then they both end up as “2023-01-01”, the first day of the year. If I choose to set floor_date as a unit of “month” then both dates end up as “2023-10-01”, the first day of the month in each year. It’s like we are rounding the date down to a specific unit. The key here is it remains a real date with properties like year, month, week and day. I’ll draw upon those properties later.</p>
<p>We are going to “create” this date as we group our data. You can read more about this in Appendices chapter <a href="./group-dates.html">Grouping by dates</a>.</p>
</section>
<section id="wrangling-the-data" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="wrangling-the-data"><span class="header-section-number">8.4.2</span> Wrangling the data</h3>
<p>Let’s filter to the data we want (Texas data before 2023) and group it by the year of the <code>ship_date</code> and summarize to sum the <code>total_value</code>.</p>
<ol type="1">
<li>Add a new section: Prepare Texas total values data</li>
<li>Add a new chunk and the code below. We’ll pick it apart after.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tx_values <span class="ot">&lt;-</span> leso <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"TX"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    ship_date <span class="sc">&lt;</span> <span class="st">"2023-01-01"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">year =</span> <span class="fu">floor_date</span>(ship_date, <span class="at">unit =</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yearly_value =</span> <span class="fu">sum</span>(total_value))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>tx_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dttm"],"align":["right"]},{"label":["yearly_value"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2010-01-01","2":"6712835"},{"1":"2011-01-01","2":"2044525"},{"1":"2012-01-01","2":"3597949"},{"1":"2013-01-01","2":"9659423"},{"1":"2014-01-01","2":"42784125"},{"1":"2015-01-01","2":"2265993"},{"1":"2016-01-01","2":"15909307"},{"1":"2017-01-01","2":"13009289"},{"1":"2018-01-01","2":"7220476"},{"1":"2019-01-01","2":"12446415"},{"1":"2020-01-01","2":"4495945"},{"1":"2021-01-01","2":"4598806"},{"1":"2022-01-01","2":"3611528"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Let’s walk through the code:</p>
<ul>
<li>We start by creating a new object to shove all this stuff into: <code>tx_values</code>. Then we start with the data …</li>
<li>You should be familiar enough with the filtering by now to understand what we are doing, but might not realize <em>why</em>. Filtering for just Texas rows makes sense because that is our focus, but you might not snap that the data for the most recent year is incomplete until you see the plot. It’s important to recognize the date range of the data you are plotting so you don’t compare a partial year to a complete one.</li>
<li>Inside this <code>group_by()</code> we have the code that makes our floor date.
<ul>
<li>We start as we often do by naming the new column made by the group: <code>year</code>.</li>
<li>We then use the <code>floor_date()</code> function on the <code>ship_date</code> variable, setting the unit to “year”.</li>
<li>You can see the result of this in the return: Any row with a date within the year “2010” was given a date of “2010-01-01” and then summed togther.</li>
</ul></li>
<li>The last line is the <code>summarize()</code> function where we add all the <code>total_value</code>s together. We first named the column <code>yearly_value</code> since that is what we are creating.</li>
<li>At the end, we print out the contents of the <code>tx_values</code> object we created.</li>
</ul>
</section>
<section id="plot-the-chart" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="plot-the-chart"><span class="header-section-number">8.4.3</span> Plot the chart</h3>
<p>Alright, so now let’s get ready to use the <code>ggplot()</code> function. I want you to create the plot here one step at a time so you can review how the layers are added.</p>
<p>In this new plot, we’ll learn about a new <code>geom</code> layer: <code>geom_line()</code> (recall that in <a href="./plots.html">the last chapter</a>, we learned about <code>geom_point()</code> and <code>geom_col()</code>).</p>
<ol type="1">
<li>Start a new section. Note we are plotting Texas values.</li>
<li>Add and run the ggplot() line first (but without the <code>+</code>)</li>
<li>Then add the <code>+</code> and the <code>geom_point()</code> and run it.</li>
<li>Then add the <code>+</code> and <code>geom_line()</code> and run it.</li>
<li>Then add the <code>+</code> and <code>labs()</code>, and run everything.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_values, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Yearly value of military surplus acquisitions in Texas"</span>, </span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span></span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-annotation="1" data-code-cell="annotated-cell-3">we create the graph</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-annotation="2" data-code-cell="annotated-cell-3">adding the points</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="3" data-code-annotation="3" data-code-cell="annotated-cell-3">adding the lines between the points</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-plot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cleaning-up" class="level3" data-number="8.4.4">
<h3 data-number="8.4.4" class="anchored" data-anchor-id="cleaning-up"><span class="header-section-number">8.4.4</span> Cleaning Up</h3>
<p>Alright, so we have a working plot! But there’s a couple things that are a bit ugly about this plot. First, I’m not digging the weird numbers on the side (what the heck does <code>1e+07</code> even mean?!). If we go back up and look at the output from <code>tx_values</code> we can see the <code>yearly_value</code> numbers are pretty large. These large numbers are causing R to read our numbers as “scientific notation” (a math-y way of reading large numbers). For example, the total cost of supplies in 2014 was <code>42,949,729</code> (that’s the first spike in our figure, around the <code>4e + 07</code> mark). But what a pain to read!</p>
<p>There are a number of ways we could fix this. We could go back into the code block where we prepare the data and divide that value by “1000000” and call the values “per million”. Or, we can do what I did and use the <a href="https://scales.r-lib.org/">scales</a> package to “scale” the output for presentation without changing the underlying number.</p>
<p>Using functions from the scales package can be esoteric and unintuitive, but most of the things you would regularly need are covered in the <a href="https://ggplot2-book.org/scales-position.html">Position and Scales chapter of the ggplot2 book</a>. It is from there that we learn about using a function <code>scale_y_continuous()</code>, the <code>label =</code> argument and the the <code>scale_dollar()</code> function.</p>
<ol type="1">
<li>After the <code>geom_line()</code> line, add the <code>scale_y_continuous</code> function as indicated below.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_values, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-4" class="code-annotation-target"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Yearly value of military surplus acquisitions in Texas"</span>, </span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span></span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-annotation="1" data-code-cell="annotated-cell-4">This is the added line for the scale</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-label-collar-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I added this in the middle of the code because I like to keep the <code>labs()</code> at the bottom of the chart. It doesn’t really matter. What it did was change the labels on the Y axis to use a currency format. Let’s walk through it:</p>
<ul>
<li>The <a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html"><code>scale_y_continous()</code></a> function allows modification to the Y axis, and there is a companion for the X axis. The term “continuous” refers to the values being numbers. There are similar functions for categories (<a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html"><code>scale_*_discrete()</code></a>) and dates (<a href="https://ggplot2.tidyverse.org/reference/scale_date.html"><code>scale_*_date()</code></a>). They all allow modification of things like the labels, grid lines and axis names. (The <code>*</code> there is placeholder for <code>x</code> or <code>y</code>.)</li>
<li>We use that function to set our “labels” with another function from the scales pacakge, <code>label_dollar()</code>.</li>
</ul>
<p>You can</p>
<p>Again, the best resource for these type of things is the <a href="https://ggplot2-book.org/scales.html">Scales</a> chapters in the ggplot2 book.</p>
<p>To show just how much granularity you have with ggplot, let’s make one more change to this chart. Those dollar values are still pretty large, and it might be nice to show them in millions of dollars, like “$10M”.</p>
<ol start="2" type="1">
<li><strong>Edit</strong> the <code>label_dollar()</code> function to add this argument inside: <code>scale_cut = cut_long_scale()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tx_values, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-5-4" class="code-annotation-target"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Yearly value of military surplus acquisitions in Texas"</span>, </span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-annotation="1" data-code-cell="annotated-cell-5">We’re editing this line to add the <code>scale_cut</code> argument to <code>label_dollar()</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-scale-cut-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s show one more change. Notice how the grid lines along the X axis don’t fall along every year? We are getting our “breaks” set every five years, but our “minor breaks” (the fainter lines between the five year increments) sit in the middle of a year. That makes it a little harder to read each year, or even to understand each of those dots fall on a year. We can use the <code>scale_x_date()</code> function to change those by adjust those minor breaks.</p>
<ol start="3" type="1">
<li>In the global <code>aes()</code> function, wrap the <code>date</code> value inside a function called <code>date()</code>. Currently our “date” is really a calendar date/time datatype called <code>&lt;POSIXct&gt;</code>. I’ve found our next function can be pretty picky about wanting a specific <code>&lt;date&gt;</code> datatype so we are adjusting it to avoid an error.</li>
<li>After the scale_y layer, add a new <code>scale_x_date()</code> later as indicated below.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-6-1"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>tx_values <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">date</span>(year), <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-6-6" class="code-annotation-target"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Yearly value of military surplus acquisitions in Texas"</span>, </span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span></span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-annotation="1" data-code-cell="annotated-cell-6">Surround “year” with <code>date()</code> function.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="6" data-code-annotation="2" data-code-cell="annotated-cell-6">This is the added later for <code>scale_x_date()</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-minor-breaks-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>OK, now the fainter “minor breaks” lines fall on each year, making them a little easier for the eye to track. Again, I had to <a href="https://ggplot2-book.org/scales-position.html#sec-date-minor-breaks">do some digging</a> to figure that out.</p>
</section>
<section id="saving-plots-as-an-object" class="level3" data-number="8.4.5">
<h3 data-number="8.4.5" class="anchored" data-anchor-id="saving-plots-as-an-object"><span class="header-section-number">8.4.5</span> Saving plots as an object</h3>
<p>Sometimes it is helpful to push the results of a plot into an R object to “save” those configurations. You can continue to add layers to this object, but you won’t need to rebuild the main portions of the chart each time. We’ll do that here so we can explore themes next.</p>
<ol type="1">
<li><strong>Edit</strong> your Texas plot chunk to save it into an R object called <code>tx_plot</code>.</li>
<li>Then call it after the code so you can see it.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a>tx_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tx_values, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">date</span>(year), <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Yearly value of military surplus acquisitions in Texas"</span>, </span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span></span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-12" class="code-annotation-target"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a>tx_plot</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-annotation="1" data-code-cell="annotated-cell-7">We edit this line to add the object at the beginning.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="12" data-code-annotation="2" data-code-cell="annotated-cell-7">Since we saved the plot into an R object above, we have to call it again to see it. We save graphs like this so we can reuse them.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/t-object-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can continue to build upon the <code>tx_plot</code> object like we do below with themes, but those changes won’t be “saved” into the R environment unless you assign it to an R object.</p>
</section>
</section>
<section id="themes" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="themes"><span class="header-section-number">8.5</span> Themes</h2>
<p>The <em>look</em> of the graph is controlled by the theme. There are a number of preset themes you can use. Let’s look at a couple.</p>
<ol type="1">
<li>Create a new section saying we’ll explore themes.</li>
<li>Add the chunk below and run it.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tx_plot <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/theme-minimal-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This takes our existing <code>tx_plot</code> and then applies the <code>theme_minimal()</code> look to it. This is actually our “Goal graphic” that we were shooting for at the beginning of the lesson!</p>
<p>There are a number of themes built into ggplot, most are pretty simplistic.</p>
<ol type="1">
<li>Edit your existing chunk to try different themes. Some you might try are <code>theme_classic()</code>, <code>theme_dark()</code> and <code>theme_void()</code>.</li>
</ol>
<section id="more-with-ggthemes" class="level3" data-number="8.5.1">
<h3 data-number="8.5.1" class="anchored" data-anchor-id="more-with-ggthemes"><span class="header-section-number">8.5.1</span> More with ggthemes</h3>
<p>There are a number of other packages that build upon <code>ggplot2</code>, including <a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/"><code>ggthemes</code></a>.</p>
<ol type="1">
<li>In your R console, install the <code>ggthemes</code> package using the <code>install.packages()</code> function: <code>install.packages("ggthemes")</code></li>
<li>Add the <code>library(ggthemes)</code> at the top of your current chunk.</li>
<li>Update the theme line to view some of the others options noted below.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tx_plot <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_economist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/theme-economist-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tx_plot <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fivethirtyeight</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/theme-538-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tx_plot <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_stata</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/theme-stata-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is also a <code>theme()</code> function that allows you individually <a href="https://ggplot2.tidyverse.org/reference/theme.html">adjust about every visual element</a> on your plot.</p>
<p>We do a wee bit of that later.</p>
</section>
</section>
<section id="goal-2-multiple-line-chart" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="goal-2-multiple-line-chart"><span class="header-section-number">8.6</span> Goal 2: Multiple line chart</h2>
<p>OK, our Texas military surplus information is fine … but how does that compare to neighboring states? Let’s work through building a new chart that shows all those steps. It’s essentially the same chart as we did above, but adding the bordering states along with Texas.</p>
<p>Here is the data and image we are trying to make:</p>
<div class="cell">
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["state"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["date"],"align":["right"]},{"label":["yearly_value"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"AR","2":"2010-01-01","3":"1236.0"},{"1":"AR","2":"2011-01-01","3":"550133.5"},{"1":"AR","2":"2012-01-01","3":"425291.8"},{"1":"AR","2":"2013-01-01","3":"2698789.4"},{"1":"AR","2":"2014-01-01","3":"12123297.2"},{"1":"AR","2":"2015-01-01","3":"342292.0"},{"1":"AR","2":"2016-01-01","3":"2856971.8"},{"1":"AR","2":"2017-01-01","3":"1736762.9"},{"1":"AR","2":"2018-01-01","3":"1551015.3"},{"1":"AR","2":"2019-01-01","3":"5953144.3"},{"1":"AR","2":"2020-01-01","3":"990621.0"},{"1":"AR","2":"2021-01-01","3":"621341.0"},{"1":"AR","2":"2022-01-01","3":"1387092.1"},{"1":"AR","2":"2023-01-01","3":"238939.5"},{"1":"LA","2":"2010-01-01","3":"365830.0"},{"1":"LA","2":"2011-01-01","3":"10144.0"},{"1":"LA","2":"2012-01-01","3":"685183.8"},{"1":"LA","2":"2013-01-01","3":"4090209.3"},{"1":"LA","2":"2014-01-01","3":"9519285.7"},{"1":"LA","2":"2015-01-01","3":"850577.3"},{"1":"LA","2":"2016-01-01","3":"4960667.8"},{"1":"LA","2":"2017-01-01","3":"2188163.0"},{"1":"LA","2":"2019-01-01","3":"1534720.0"},{"1":"LA","2":"2021-01-01","3":"77000.0"},{"1":"NM","2":"2011-01-01","3":"134868.4"},{"1":"NM","2":"2012-01-01","3":"409042.6"},{"1":"NM","2":"2013-01-01","3":"5485383.2"},{"1":"NM","2":"2014-01-01","3":"8245038.9"},{"1":"NM","2":"2015-01-01","3":"1190841.4"},{"1":"NM","2":"2016-01-01","3":"829049.2"},{"1":"NM","2":"2017-01-01","3":"112158.0"},{"1":"NM","2":"2018-01-01","3":"669364.0"},{"1":"OK","2":"2010-01-01","3":"238085.9"},{"1":"OK","2":"2011-01-01","3":"459032.0"},{"1":"OK","2":"2012-01-01","3":"1506514.2"},{"1":"OK","2":"2013-01-01","3":"3388777.8"},{"1":"OK","2":"2014-01-01","3":"17390250.5"},{"1":"OK","2":"2015-01-01","3":"201722.4"},{"1":"OK","2":"2016-01-01","3":"777694.5"},{"1":"OK","2":"2017-01-01","3":"1012316.2"},{"1":"OK","2":"2018-01-01","3":"190968.0"},{"1":"OK","2":"2019-01-01","3":"3088541.0"},{"1":"OK","2":"2020-01-01","3":"1179.0"},{"1":"OK","2":"2023-01-01","3":"237966.4"},{"1":"TX","2":"2010-01-01","3":"6712835.0"},{"1":"TX","2":"2011-01-01","3":"2044525.3"},{"1":"TX","2":"2012-01-01","3":"3597949.5"},{"1":"TX","2":"2013-01-01","3":"9659422.6"},{"1":"TX","2":"2014-01-01","3":"42784124.9"},{"1":"TX","2":"2015-01-01","3":"2265992.6"},{"1":"TX","2":"2016-01-01","3":"15909306.8"},{"1":"TX","2":"2017-01-01","3":"13009289.3"},{"1":"TX","2":"2018-01-01","3":"7220476.5"},{"1":"TX","2":"2019-01-01","3":"12446415.3"},{"1":"TX","2":"2020-01-01","3":"4495945.3"},{"1":"TX","2":"2021-01-01","3":"4598805.6"},{"1":"TX","2":"2022-01-01","3":"3611528.0"},{"1":"TX","2":"2023-01-01","3":"3213352.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/region-example-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="prepare-the-data" class="level3" data-number="8.6.1">
<h3 data-number="8.6.1" class="anchored" data-anchor-id="prepare-the-data"><span class="header-section-number">8.6.1</span> Prepare the data</h3>
<p>We need to go back to our original <code>leso</code> to get the additional states. But we also know now that we need to create a “floor_date” that has a <code>&lt;date&gt;</code> datatype. Let’s do that as we prepare the data instead of while we are grouping. I’ll sometimes go back into my cleaning notebook to add something like this, but we won’t go quite that far with this.</p>
<p>In the interest of time, here is all the code we are using, with annotations to explain each line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a>region_data <span class="ot">&lt;-</span> leso <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-12-2" class="code-annotation-target"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TX"</span>, <span class="st">"OK"</span>, <span class="st">"AR"</span>, <span class="st">"NM"</span>, <span class="st">"LA"</span>)) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">floor_date</span>(ship_date, <span class="at">unit =</span> <span class="st">"year"</span>) <span class="sc">|&gt;</span> <span class="fu">date</span>()</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-12-6" class="code-annotation-target"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-12-7" class="code-annotation-target"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yearly_value =</span> <span class="fu">sum</span>(total_value))</span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-12-9" class="code-annotation-target"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>region_data</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-annotation="1" data-code-cell="annotated-cell-12">We create a new object to hold the data. We fill that starting with <code>leso</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-annotation="2" data-code-cell="annotated-cell-12">We filter the <code>state</code> column for our list of five states. Note we are using <code>%in%</code> like we did in Chapter 6, but we’re doing it right inside the filter.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="4" data-code-annotation="3" data-code-cell="annotated-cell-12">Here, inside a <code>mutate()</code>, we create the new variable <code>year</code> and fill it with the floor_date of our shipping date based on the year. We then turn that into a <code>&lt;date&gt;</code> datatype.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="6" data-code-annotation="4" data-code-cell="annotated-cell-12">We group by <code>state</code> and <code>year</code>. This is much cleaner now that we’ve already created a <code>year</code> value.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="7" data-code-annotation="5" data-code-cell="annotated-cell-12">Our summarize to total the costs.</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="9" data-code-annotation="6" data-code-cell="annotated-cell-12">And lastly, we print the new object so we can see it.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["state"],"name":[1],"type":["chr"],"align":["left"]},{"label":["year"],"name":[2],"type":["date"],"align":["right"]},{"label":["yearly_value"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"AR","2":"2010-01-01","3":"1236.0"},{"1":"AR","2":"2011-01-01","3":"550133.5"},{"1":"AR","2":"2012-01-01","3":"425291.8"},{"1":"AR","2":"2013-01-01","3":"2698789.4"},{"1":"AR","2":"2014-01-01","3":"12123297.2"},{"1":"AR","2":"2015-01-01","3":"342292.0"},{"1":"AR","2":"2016-01-01","3":"2856971.8"},{"1":"AR","2":"2017-01-01","3":"1736762.9"},{"1":"AR","2":"2018-01-01","3":"1551015.3"},{"1":"AR","2":"2019-01-01","3":"5953144.3"},{"1":"AR","2":"2020-01-01","3":"990621.0"},{"1":"AR","2":"2021-01-01","3":"621341.0"},{"1":"AR","2":"2022-01-01","3":"1387092.1"},{"1":"AR","2":"2023-01-01","3":"238939.5"},{"1":"LA","2":"2010-01-01","3":"365830.0"},{"1":"LA","2":"2011-01-01","3":"10144.0"},{"1":"LA","2":"2012-01-01","3":"685183.8"},{"1":"LA","2":"2013-01-01","3":"4090209.3"},{"1":"LA","2":"2014-01-01","3":"9519285.7"},{"1":"LA","2":"2015-01-01","3":"850577.3"},{"1":"LA","2":"2016-01-01","3":"4960667.8"},{"1":"LA","2":"2017-01-01","3":"2188163.0"},{"1":"LA","2":"2019-01-01","3":"1534720.0"},{"1":"LA","2":"2021-01-01","3":"77000.0"},{"1":"NM","2":"2011-01-01","3":"134868.4"},{"1":"NM","2":"2012-01-01","3":"409042.6"},{"1":"NM","2":"2013-01-01","3":"5485383.2"},{"1":"NM","2":"2014-01-01","3":"8245038.9"},{"1":"NM","2":"2015-01-01","3":"1190841.4"},{"1":"NM","2":"2016-01-01","3":"829049.2"},{"1":"NM","2":"2017-01-01","3":"112158.0"},{"1":"NM","2":"2018-01-01","3":"669364.0"},{"1":"OK","2":"2010-01-01","3":"238085.9"},{"1":"OK","2":"2011-01-01","3":"459032.0"},{"1":"OK","2":"2012-01-01","3":"1506514.2"},{"1":"OK","2":"2013-01-01","3":"3388777.8"},{"1":"OK","2":"2014-01-01","3":"17390250.5"},{"1":"OK","2":"2015-01-01","3":"201722.4"},{"1":"OK","2":"2016-01-01","3":"777694.5"},{"1":"OK","2":"2017-01-01","3":"1012316.2"},{"1":"OK","2":"2018-01-01","3":"190968.0"},{"1":"OK","2":"2019-01-01","3":"3088541.0"},{"1":"OK","2":"2020-01-01","3":"1179.0"},{"1":"OK","2":"2023-01-01","3":"237966.4"},{"1":"TX","2":"2010-01-01","3":"6712835.0"},{"1":"TX","2":"2011-01-01","3":"2044525.3"},{"1":"TX","2":"2012-01-01","3":"3597949.5"},{"1":"TX","2":"2013-01-01","3":"9659422.6"},{"1":"TX","2":"2014-01-01","3":"42784124.9"},{"1":"TX","2":"2015-01-01","3":"2265992.6"},{"1":"TX","2":"2016-01-01","3":"15909306.8"},{"1":"TX","2":"2017-01-01","3":"13009289.3"},{"1":"TX","2":"2018-01-01","3":"7220476.5"},{"1":"TX","2":"2019-01-01","3":"12446415.3"},{"1":"TX","2":"2020-01-01","3":"4495945.3"},{"1":"TX","2":"2021-01-01","3":"4598805.6"},{"1":"TX","2":"2022-01-01","3":"3611528.0"},{"1":"TX","2":"2023-01-01","3":"3213352.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="plot-the-chart-1" class="level3" data-number="8.6.2">
<h3 data-number="8.6.2" class="anchored" data-anchor-id="plot-the-chart-1"><span class="header-section-number">8.6.2</span> Plot the chart</h3>
<p>For our next plot, we’ll add a different line for each state. To do this you would use the color aesthetic <code>aes()</code> in the <code>geom_line()</code> geom. Recall that geoms can have their own <code>aes()</code> variable information. This is especially useful for working with a third variable (like when making a stacked bar chart or line plot with multiple lines). Notice that the color aesthetic (meaning that it is in <code>aes</code>) takes a variable, not a color. You can learn how to change these colors <a href="http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually">here</a>. For now, though, we’ll use the <code>ggplot</code> default colors.</p>
<ol type="1">
<li>Add a note that we’ll now build the chart.</li>
<li>Add the code chunk below and run it. Look through the comments so you understand it.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-1" class="code-annotation-target"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-13-3" class="code-annotation-target"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-13-4" class="code-annotation-target"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-13-5" class="code-annotation-target"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-13-6" class="code-annotation-target"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-13-9" class="code-annotation-target"><a href="#annotated-cell-13-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-annotation="1" data-code-cell="annotated-cell-13">Plotting the <code>region_data</code> object</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="2" data-code-annotation="2" data-code-cell="annotated-cell-13">Set set the x and y axis</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="3" data-code-annotation="3" data-code-cell="annotated-cell-13">Adds the points</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="4" data-code-annotation="4" data-code-cell="annotated-cell-13">Adds the line, coloring them based on the <code>state</code> values</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="5">5</dt>
<dd>
<span data-code-lines="5" data-code-annotation="5" data-code-cell="annotated-cell-13">Fixes our labels on the y axis.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="6">6</dt>
<dd>
<span data-code-lines="6" data-code-annotation="6" data-code-cell="annotated-cell-13">Fixes our minor breaks on the x axis.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="7">7</dt>
<dd>
<span data-code-lines="9" data-code-annotation="7" data-code-cell="annotated-cell-13">Adding all our labels with <code>labs()</code> arguments.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/region-lcolor-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Adding this aesthetic not only added color to the lines, it added a legend so we can tell which is which. If we had tried to build this plot without the added color aesthetic, it wouldn’t plot right because it wouldn’t how how to split the lines.</p>
<p>Notice that only the lines changed colors, and not the points? This is because we only included the aesthetic in the <code>geom_line()</code> geom and not the <code>geom_point()</code> geom.</p>
<ol type="1">
<li><strong>Edit</strong> your <code>geom_point()</code> to add <code>aes(color = state)</code>.</li>
<li>Also edit the <code>labs()</code> function to add <code>color = "State"</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-14-1"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-14-2"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-3" class="code-annotation-target"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-14-4"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-14-5"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-14-6"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-14-7"><a href="#annotated-cell-14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-14-8"><a href="#annotated-cell-14-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-14-9"><a href="#annotated-cell-14-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-10" class="code-annotation-target"><a href="#annotated-cell-14-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3" data-code-annotation="1" data-code-cell="annotated-cell-14">Color aesthetic added here.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="10" data-code-annotation="2" data-code-cell="annotated-cell-14">Adding <code>color = "State"</code> here redraws the title above the color legend.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/region-pcolor-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>OK, you have a line chart for reference!</p>
</section>
</section>
<section id="on-your-own" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="on-your-own"><span class="header-section-number">8.7</span> On your own</h2>
<p>I want you to make a line chart of military surplus acquisitions in three states that are <strong>different</strong> from the five we used above. This is very similar to the chart you just made, but with different values.</p>
<p>Some things to do/consider:</p>
<ol type="1">
<li>Do this in a new section and explain it.</li>
<li>You’ll need to prepare the data just like we did above to get the right data points and the right states.</li>
<li>I really suggest you build both chunks (the data prep and the chart) one line at a time so you can see what each step adds.</li>
</ol>
</section>
<section id="tour-of-some-other-adjustments" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="tour-of-some-other-adjustments"><span class="header-section-number">8.8</span> Tour of some other adjustments</h2>
<p>You don’t have to add these examples below to your own notebook, but here are some examples of other things you can control.</p>
<section id="line-width" class="level3" data-number="8.8.1">
<h3 data-number="8.8.1" class="anchored" data-anchor-id="line-width"><span class="header-section-number">8.8.1</span> Line width</h3>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-15-1"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-15-2"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-15-3"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-4" class="code-annotation-target"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-15-5"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-15-6"><a href="#annotated-cell-15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-15-7"><a href="#annotated-cell-15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-15-8"><a href="#annotated-cell-15-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-15-9"><a href="#annotated-cell-15-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<span id="annotated-cell-15-10"><a href="#annotated-cell-15-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-annotation="1" data-code-cell="annotated-cell-15">You can set the line width for a geom, but note it is taking an inputted value, not one from the data. This is why it is outside the <code>aes()</code> function.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/line-width-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="line-type" class="level3" data-number="8.8.2">
<h3 data-number="8.8.2" class="anchored" data-anchor-id="line-type"><span class="header-section-number">8.8.2</span> Line type</h3>
<p>This example adds a <code>linetype = state</code> to the ggplot aesthetic. This gives each state a different type of line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-16-1"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-16-2"><a href="#annotated-cell-16-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-16-3"><a href="#annotated-cell-16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-16-4" class="code-annotation-target"><a href="#annotated-cell-16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state, <span class="at">linetype =</span> state), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-16-5"><a href="#annotated-cell-16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-16-7"><a href="#annotated-cell-16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-16-8"><a href="#annotated-cell-16-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-16-9"><a href="#annotated-cell-16-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<span id="annotated-cell-16-10"><a href="#annotated-cell-16-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-annotation="1" data-code-cell="annotated-cell-16">We add the linetype here, but have to put it INSIDE the <code>aes()</code> now because we are “mapping” the type based on values in the <code>state</code> variable.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/linetype-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>But note that ggplot added a new legend because it takes the name from the variable “state”. We can fix this through overiding it in the <code>labs()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-17-3"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state, <span class="at">linetype =</span> state), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-17-8"><a href="#annotated-cell-17-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-17-9"><a href="#annotated-cell-17-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-17-10" class="code-annotation-target"><a href="#annotated-cell-17-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>, <span class="at">linetype =</span> <span class="st">"State"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="10" data-code-annotation="1" data-code-cell="annotated-cell-17">We add <code>linetype = "State"</code> to the <code>labs()</code> function, which would collapse everything into a single legend.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/linetype-lab-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="facets" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="facets"><span class="header-section-number">8.9</span> Facets</h2>
<p>Facets are a way to make multiple graphs based on a variable in the data, as it creates a bunch of mini charts you can compare among each other. There are two types, the <code>facet_wrap()</code> and the <code>facet_grid()</code>. There is a good explanation of these in <a href="https://r4ds.hadley.nz/layers.html#facets">R for Data Science</a>.</p>
<p>We’ll start with the chart we have already, and then split it into facets by state.</p>
<ol type="1">
<li>Start a new section about facets</li>
<li>Add the code below to create your chart and view it. This is the same plot we’ve already created</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-18-3"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state, <span class="at">linetype =</span> state), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-18-5"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-18-6"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-18-7"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-18-8"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-18-9"><a href="#annotated-cell-18-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<span id="annotated-cell-18-10"><a href="#annotated-cell-18-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>, <span class="at">linetype =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-11" class="code-annotation-target"><a href="#annotated-cell-18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="11" data-code-annotation="1" data-code-cell="annotated-cell-18">This is the only line we added, setting a facet wrap to split on the state.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/facet-wrap-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Since each state facet is labeled, we don’t really need the color legend, so we can use the <a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme()</code></a> function to override that.</p>
<ol start="3" type="1">
<li>Add the last line here to remove the legend.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-19-3"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state, <span class="at">linetype =</span> state), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-19-5"><a href="#annotated-cell-19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-19-6"><a href="#annotated-cell-19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-19-7"><a href="#annotated-cell-19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Yearly military surplus acquisitions in Texas and bordering states"</span>, </span>
<span id="annotated-cell-19-8"><a href="#annotated-cell-19-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-19-9"><a href="#annotated-cell-19-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<span id="annotated-cell-19-10"><a href="#annotated-cell-19-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>, <span class="at">linetype =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-19-11"><a href="#annotated-cell-19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-19-12" class="code-annotation-target"><a href="#annotated-cell-19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="12" data-code-annotation="1" data-code-cell="annotated-cell-19">Here we set the legend.position to “none”, which is the answer to remove it. We could also set that to “bottom” or “left” to move it, if that was our desire. It is not, but you can try it if you like.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/facet-legend-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="facet-grids" class="level3" data-number="8.9.1">
<h3 data-number="8.9.1" class="anchored" data-anchor-id="facet-grids"><span class="header-section-number">8.9.1</span> Facet grids</h3>
<p>A <code>facet_grid()</code> allows you to plot on a combination of variables. We don’t really have enough variables to compare with our leso data but we can show this with the <code>penguins</code> data we used in the last chapter.</p>
<p>This chart compares the filpper length and body mass, but it does so for each species of bird by their gender.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-3"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-4" class="code-annotation-target"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-20-5" class="code-annotation-target"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-20-6" class="code-annotation-target"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sex)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-20-7" class="code-annotation-target"><a href="#annotated-cell-20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex <span class="sc">~</span> species)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-annotation="1" data-code-cell="annotated-cell-20">This drops any rows that are missing values, as some don’t have sex marked.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="5" data-code-annotation="2" data-code-cell="annotated-cell-20">Our ggplot chart, much like we did in the last chapter, comparing flippers to weight.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="6" data-code-annotation="3" data-code-cell="annotated-cell-20">We add the points and color them to distinquish the sex of the birds.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="7" data-code-annotation="4" data-code-cell="annotated-cell-20">We add the <code>facet_grid</code> that splits the chart by both sex and species.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img src="plots-more_files/figure-html/facet-grid-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="interactive-plots" class="level2" data-number="8.10">
<h2 data-number="8.10" class="anchored" data-anchor-id="interactive-plots"><span class="header-section-number">8.10</span> Interactive plots</h2>
<p>Want to make your plot interactive? You can use <a href="https://plotly.com/r/">plotly</a>’s <code>ggplotly()</code> function to transform your graph into an interactive chart.</p>
<p>To use plotly, you’ll want to install the plotly package, add the library, and then use the ggplotly() function:</p>
<ol type="1">
<li>In your R Console, run <code>install.packages("plotly")</code>. (You only have to do this once on your computer.)</li>
<li>Add a new section to note you are creating an interactive chart.</li>
<li>Add the code below and run it. Then play with the chart!</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-21-1"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="annotated-cell-21-2"><a href="#annotated-cell-21-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-21-3" class="code-annotation-target"><a href="#annotated-cell-21-3" aria-hidden="true" tabindex="-1"></a>region_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(region_data,</span>
<span id="annotated-cell-21-4"><a href="#annotated-cell-21-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> yearly_value)) <span class="sc">+</span> </span>
<span id="annotated-cell-21-5"><a href="#annotated-cell-21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-21-6"><a href="#annotated-cell-21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-21-7"><a href="#annotated-cell-21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale_cut =</span> <span class="fu">cut_long_scale</span>())) <span class="sc">+</span></span>
<span id="annotated-cell-21-8"><a href="#annotated-cell-21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">minor_breaks =</span> <span class="fu">breaks_width</span>(<span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-21-9"><a href="#annotated-cell-21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Military police"</span>, </span>
<span id="annotated-cell-21-10"><a href="#annotated-cell-21-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Cost of acquisitions"</span>,</span>
<span id="annotated-cell-21-11"><a href="#annotated-cell-21-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Source: Law Enforcement Support Office"</span>,</span>
<span id="annotated-cell-21-12"><a href="#annotated-cell-21-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"State"</span>)</span>
<span id="annotated-cell-21-13"><a href="#annotated-cell-21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-21-14"><a href="#annotated-cell-21-14" aria-hidden="true" tabindex="-1"></a>region_plot <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-21-15" class="code-annotation-target"><a href="#annotated-cell-21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplotly</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="3,5" data-code-annotation="1" data-code-cell="annotated-cell-21">We saved our good plot into an object.</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="15" data-code-annotation="2" data-code-cell="annotated-cell-21">Then we pipe that object into the <code>ggplotly()</code> function, which makes it interactive.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2b9161233a1dfd9300a2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2b9161233a1dfd9300a2">{"x":{"data":[{"x":[14610,14975,15340,15706,16071,16436,16801,17167,17532,17897,18262,18628,18993,19358],"y":[1236,550133.54000000062,425291.78000000014,2698789.3500000001,12123297.18,342291.95000000007,2856971.7599999998,1736762.8600000001,1551015.2600000005,5953144.2600000035,990621,621341,1387092.0999999982,238939.53000000003],"text":["year: 2010-01-01<br />yearly_value:     1236.0<br />state: AR","year: 2011-01-01<br />yearly_value:   550133.5<br />state: AR","year: 2012-01-01<br />yearly_value:   425291.8<br />state: AR","year: 2013-01-01<br />yearly_value:  2698789.4<br />state: AR","year: 2014-01-01<br />yearly_value: 12123297.2<br />state: AR","year: 2015-01-01<br />yearly_value:   342292.0<br />state: AR","year: 2016-01-01<br />yearly_value:  2856971.8<br />state: AR","year: 2017-01-01<br />yearly_value:  1736762.9<br />state: AR","year: 2018-01-01<br />yearly_value:  1551015.3<br />state: AR","year: 2019-01-01<br />yearly_value:  5953144.3<br />state: AR","year: 2020-01-01<br />yearly_value:   990621.0<br />state: AR","year: 2021-01-01<br />yearly_value:   621341.0<br />state: AR","year: 2022-01-01<br />yearly_value:  1387092.1<br />state: AR","year: 2023-01-01<br />yearly_value:   238939.5<br />state: AR"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"AR","legendgroup":"AR","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"frame":null},{"x":[14610,14975,15340,15706,16071,16436,16801,17167,17897,18628],"y":[365830,10144,685183.84999999939,4090209.3200000003,9519285.6699999999,850577.30000000005,4960667.8100000005,2188163.0499999998,1534720,77000],"text":["year: 2010-01-01<br />yearly_value:   365830.0<br />state: LA","year: 2011-01-01<br />yearly_value:    10144.0<br />state: LA","year: 2012-01-01<br />yearly_value:   685183.8<br />state: LA","year: 2013-01-01<br />yearly_value:  4090209.3<br />state: LA","year: 2014-01-01<br />yearly_value:  9519285.7<br />state: LA","year: 2015-01-01<br />yearly_value:   850577.3<br />state: LA","year: 2016-01-01<br />yearly_value:  4960667.8<br />state: LA","year: 2017-01-01<br />yearly_value:  2188163.0<br />state: LA","year: 2019-01-01<br />yearly_value:  1534720.0<br />state: LA","year: 2021-01-01<br />yearly_value:    77000.0<br />state: LA"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(163,165,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(163,165,0,1)"}},"hoveron":"points","name":"LA","legendgroup":"LA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.8897637795275593,"color":"rgba(163,165,0,1)","dash":"solid"},"frame":null},{"x":[14975,15340,15706,16071,16436,16801,17167,17532],"y":[134868.39000000001,409042.59999999998,5485383.1600000001,8245038.9100000001,1190841.3699999999,829049.21999999997,112157.97,669364],"text":["year: 2011-01-01<br />yearly_value:   134868.4<br />state: NM","year: 2012-01-01<br />yearly_value:   409042.6<br />state: NM","year: 2013-01-01<br />yearly_value:  5485383.2<br />state: NM","year: 2014-01-01<br />yearly_value:  8245038.9<br />state: NM","year: 2015-01-01<br />yearly_value:  1190841.4<br />state: NM","year: 2016-01-01<br />yearly_value:   829049.2<br />state: NM","year: 2017-01-01<br />yearly_value:   112158.0<br />state: NM","year: 2018-01-01<br />yearly_value:   669364.0<br />state: NM"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(0,191,125,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,125,1)"}},"hoveron":"points","name":"NM","legendgroup":"NM","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.8897637795275593,"color":"rgba(0,191,125,1)","dash":"solid"},"frame":null},{"x":[14610,14975,15340,15706,16071,16436,16801,17167,17532,17897,18262,19358],"y":[238085.87999999995,459031.96000000089,1506514.1900000009,3388777.8000000003,17390250.479999997,201722.39999999999,777694.46999999997,1012316.23,190968,3088541,1179,237966.39999999999],"text":["year: 2010-01-01<br />yearly_value:   238085.9<br />state: OK","year: 2011-01-01<br />yearly_value:   459032.0<br />state: OK","year: 2012-01-01<br />yearly_value:  1506514.2<br />state: OK","year: 2013-01-01<br />yearly_value:  3388777.8<br />state: OK","year: 2014-01-01<br />yearly_value: 17390250.5<br />state: OK","year: 2015-01-01<br />yearly_value:   201722.4<br />state: OK","year: 2016-01-01<br />yearly_value:   777694.5<br />state: OK","year: 2017-01-01<br />yearly_value:  1012316.2<br />state: OK","year: 2018-01-01<br />yearly_value:   190968.0<br />state: OK","year: 2019-01-01<br />yearly_value:  3088541.0<br />state: OK","year: 2020-01-01<br />yearly_value:     1179.0<br />state: OK","year: 2023-01-01<br />yearly_value:   237966.4<br />state: OK"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(0,176,246,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,176,246,1)"}},"hoveron":"points","name":"OK","legendgroup":"OK","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.8897637795275593,"color":"rgba(0,176,246,1)","dash":"solid"},"frame":null},{"x":[14610,14975,15340,15706,16071,16436,16801,17167,17532,17897,18262,18628,18993,19358],"y":[6712835,2044525.27,3597949.4899999951,9659422.6099999994,42784124.949999988,2265992.6300000004,15909306.809999999,13009289.340000004,7220476.4900000002,12446415.280000003,4495945.3100000005,4598805.6400000006,3611527.9999999977,3213352.8699999969],"text":["year: 2010-01-01<br />yearly_value:  6712835.0<br />state: TX","year: 2011-01-01<br />yearly_value:  2044525.3<br />state: TX","year: 2012-01-01<br />yearly_value:  3597949.5<br />state: TX","year: 2013-01-01<br />yearly_value:  9659422.6<br />state: TX","year: 2014-01-01<br />yearly_value: 42784124.9<br />state: TX","year: 2015-01-01<br />yearly_value:  2265992.6<br />state: TX","year: 2016-01-01<br />yearly_value: 15909306.8<br />state: TX","year: 2017-01-01<br />yearly_value: 13009289.3<br />state: TX","year: 2018-01-01<br />yearly_value:  7220476.5<br />state: TX","year: 2019-01-01<br />yearly_value: 12446415.3<br />state: TX","year: 2020-01-01<br />yearly_value:  4495945.3<br />state: TX","year: 2021-01-01<br />yearly_value:  4598805.6<br />state: TX","year: 2022-01-01<br />yearly_value:  3611528.0<br />state: TX","year: 2023-01-01<br />yearly_value:  3213352.9<br />state: TX"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(231,107,243,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(231,107,243,1)"}},"hoveron":"points","name":"TX","legendgroup":"TX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","line":{"width":1.8897637795275593,"color":"rgba(231,107,243,1)","dash":"solid"},"frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826498,"l":48.949771689497723},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Military police","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[14372.6,19595.400000000001],"tickmode":"array","ticktext":["2010","2015","2020"],"tickvals":[14610,16436,18262],"categoryorder":"array","categoryarray":["2010","2015","2020"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Year","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-2137968.2974999994,44923272.247499987],"tickmode":"array","ticktext":["$0","$10M","$20M","$30M","$40M"],"tickvals":[0,10000000,20000000,30000000,40000000],"categoryorder":"array","categoryarray":["$0","$10M","$20M","$30M","$40M"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Cost of acquisitions","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"State","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"447123b633cc":{"x":{},"y":{},"colour":{},"type":"scatter"},"4471f02a865":{"x":{},"y":{},"colour":{}}},"cur_data":"447123b633cc","visdat":{"447123b633cc":["function (y) ","x"],"4471f02a865":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now you have tool tips on your points when you hover over them.</p>
<p>The <code>ggplotly()</code> function is not perfect. For instance, I’ve shortened the title to the point of uselessness because it ran on top of the controls. I’m sure that could be overcome with some effort. Alternatively, you can use plotly’s own syntax to build some quite interesting charts, but it’s a whole <a href="https://plotly.com/r/">new syntax to master</a>.</p>
</section>
<section id="what-we-learned" class="level2" data-number="8.11">
<h2 data-number="8.11" class="anchored" data-anchor-id="what-we-learned"><span class="header-section-number">8.11</span> What we learned</h2>
<p>There is so much more to <code>ggplot2</code> than what we’ve shown here, but these are the basics that should get you through the class. At the top of this chapter are a list of other resources to learn more.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./plots.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Intro to ggplot</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./tidy-data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tidy data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>