<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 5 Transform | Reporting with Data in R</title>
  <meta name="description" content="Chapter 5 Transform | Reporting with Data in R is a series of lessons for a course in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It is taught by Christian McDonald.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 5 Transform | Reporting with Data in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 5 Transform | Reporting with Data in R is a series of lessons for a course in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It is taught by Christian McDonald." />
  <meta name="github-repo" content="utdata/rwd-class" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Transform | Reporting with Data in R" />
  
  <meta name="twitter:description" content="Chapter 5 Transform | Reporting with Data in R is a series of lessons for a course in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It is taught by Christian McDonald." />
  

<meta name="author" content="Christian McDonald">


<meta name="date" content="2019-02-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="columns.html">
<link rel="next" href="cleaning.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reporting with Data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this class</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the author</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>1</b> Install Party</a><ul>
<li class="chapter" data-level="1.1" data-path="install.html"><a href="install.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="install.html"><a href="install.html#installing-rstudio"><i class="fa fa-check"></i><b>1.2</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="install.html"><a href="install.html#install-visual-studio-code"><i class="fa fa-check"></i><b>1.3</b> Install Visual Studio Code</a></li>
<li class="chapter" data-level="1.4" data-path="install.html"><a href="install.html#class-project-folder"><i class="fa fa-check"></i><b>1.4</b> Class project folder</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#rstudio-tour"><i class="fa fa-check"></i><b>2.1</b> RStudio tour</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#updating-preferences"><i class="fa fa-check"></i><b>2.2</b> Updating preferences</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#starting-a-new-project"><i class="fa fa-check"></i><b>2.3</b> Starting a new Project</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#using-r-notebooks"><i class="fa fa-check"></i><b>2.4</b> Using R Notebooks</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#create-your-first-notebook"><i class="fa fa-check"></i><b>2.4.1</b> Create your first notebook</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro.html"><a href="intro.html#save-the-.rmd-file"><i class="fa fa-check"></i><b>2.4.2</b> Save the .Rmd file</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro.html"><a href="intro.html#run-the-notebook"><i class="fa fa-check"></i><b>2.4.3</b> Run the notebook</a></li>
<li class="chapter" data-level="2.4.4" data-path="intro.html"><a href="intro.html#adding-new-code-chunks"><i class="fa fa-check"></i><b>2.4.4</b> Adding new code chunks</a></li>
<li class="chapter" data-level="2.4.5" data-path="intro.html"><a href="intro.html#practice-adding-code-chunks"><i class="fa fa-check"></i><b>2.4.5</b> Practice adding code chunks</a></li>
<li class="chapter" data-level="2.4.6" data-path="intro.html"><a href="intro.html#preview-the-report"><i class="fa fa-check"></i><b>2.4.6</b> Preview the report</a></li>
<li class="chapter" data-level="2.4.7" data-path="intro.html"><a href="intro.html#the-toolbar"><i class="fa fa-check"></i><b>2.4.7</b> The toolbar</a></li>
<li class="chapter" data-level="2.4.8" data-path="intro.html"><a href="intro.html#knit-the-final-workbook"><i class="fa fa-check"></i><b>2.4.8</b> Knit the final workbook</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#turning-in-our-projects"><i class="fa fa-check"></i><b>2.5</b> Turning in our projects</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>3</b> Importing data</a><ul>
<li class="chapter" data-level="3.1" data-path="import.html"><a href="import.html#goals-for-this-section"><i class="fa fa-check"></i><b>3.1</b> Goals for this section</a></li>
<li class="chapter" data-level="3.2" data-path="import.html"><a href="import.html#data-types"><i class="fa fa-check"></i><b>3.2</b> Data types</a><ul>
<li class="chapter" data-level="3.2.1" data-path="import.html"><a href="import.html#what-is-clean-data"><i class="fa fa-check"></i><b>3.2.1</b> What is clean data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="import.html"><a href="import.html#create-a-new-project"><i class="fa fa-check"></i><b>3.3</b> Create a new project</a><ul>
<li class="chapter" data-level="3.3.1" data-path="import.html"><a href="import.html#the-r-package-environment"><i class="fa fa-check"></i><b>3.3.1</b> The R Package environment</a></li>
<li class="chapter" data-level="3.3.2" data-path="import.html"><a href="import.html#installing-and-using-packages"><i class="fa fa-check"></i><b>3.3.2</b> Installing and using packages</a></li>
<li class="chapter" data-level="3.3.3" data-path="import.html"><a href="import.html#load-the-libraries"><i class="fa fa-check"></i><b>3.3.3</b> Load the libraries</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="import.html"><a href="import.html#lets-get-some-data"><i class="fa fa-check"></i><b>3.4</b> Let’s get some data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="import.html"><a href="import.html#inspect-the-data"><i class="fa fa-check"></i><b>3.4.1</b> Inspect the data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="import.html"><a href="import.html#import-csv-as-data"><i class="fa fa-check"></i><b>3.5</b> Import csv as data</a><ul>
<li class="chapter" data-level="3.5.1" data-path="import.html"><a href="import.html#help-files"><i class="fa fa-check"></i><b>3.5.1</b> Help files</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="import.html"><a href="import.html#assign-our-data-to-a-data-frame"><i class="fa fa-check"></i><b>3.6</b> Assign our data to a data frame</a></li>
<li class="chapter" data-level="3.7" data-path="import.html"><a href="import.html#inspect-the-data-1"><i class="fa fa-check"></i><b>3.7</b> Inspect the data</a><ul>
<li class="chapter" data-level="3.7.1" data-path="import.html"><a href="import.html#write-notes-about-things-to-change"><i class="fa fa-check"></i><b>3.7.1</b> Write notes about things to change</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="import.html"><a href="import.html#turn-in-your-project"><i class="fa fa-check"></i><b>3.8</b> Turn in your project</a></li>
<li class="chapter" data-level="3.9" data-path="import.html"><a href="import.html#resources"><i class="fa fa-check"></i><b>3.9</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="columns.html"><a href="columns.html"><i class="fa fa-check"></i><b>4</b> Columns</a><ul>
<li class="chapter" data-level="4.1" data-path="columns.html"><a href="columns.html#goals-for-this-section-1"><i class="fa fa-check"></i><b>4.1</b> Goals for this section</a></li>
<li class="chapter" data-level="4.2" data-path="columns.html"><a href="columns.html#relaunch-the-wells-project"><i class="fa fa-check"></i><b>4.2</b> Relaunch the Wells project</a></li>
<li class="chapter" data-level="4.3" data-path="columns.html"><a href="columns.html#clean-up-column-names"><i class="fa fa-check"></i><b>4.3</b> Clean up column names</a><ul>
<li class="chapter" data-level="4.3.1" data-path="columns.html"><a href="columns.html#clean-names-with-janitor"><i class="fa fa-check"></i><b>4.3.1</b> Clean names with janitor</a></li>
<li class="chapter" data-level="4.3.2" data-path="columns.html"><a href="columns.html#simple-renaming-of-individual-columns"><i class="fa fa-check"></i><b>4.3.2</b> Simple renaming of individual columns</a></li>
<li class="chapter" data-level="4.3.3" data-path="columns.html"><a href="columns.html#mass-renaming-of-columns"><i class="fa fa-check"></i><b>4.3.3</b> Mass renaming of columns</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="columns.html"><a href="columns.html#clean-data-within-columns"><i class="fa fa-check"></i><b>4.4</b> Clean data within columns</a><ul>
<li class="chapter" data-level="4.4.1" data-path="columns.html"><a href="columns.html#using-lubridate-to-clean-dates"><i class="fa fa-check"></i><b>4.4.1</b> Using lubridate to clean dates</a></li>
<li class="chapter" data-level="4.4.2" data-path="columns.html"><a href="columns.html#fix-the-bore-hole-depth"><i class="fa fa-check"></i><b>4.4.2</b> Fix the bore hole depth</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="columns.html"><a href="columns.html#export-the-data"><i class="fa fa-check"></i><b>4.5</b> Export the data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transform.html"><a href="transform.html"><i class="fa fa-check"></i><b>5</b> Transform</a><ul>
<li class="chapter" data-level="5.1" data-path="transform.html"><a href="transform.html#goals-for-the-section"><i class="fa fa-check"></i><b>5.1</b> Goals for the section</a></li>
<li class="chapter" data-level="5.2" data-path="transform.html"><a href="transform.html#introducing-dplyr"><i class="fa fa-check"></i><b>5.2</b> Introducing dplyr</a></li>
<li class="chapter" data-level="5.3" data-path="transform.html"><a href="transform.html#start-a-new-r-notebook"><i class="fa fa-check"></i><b>5.3</b> Start a new R Notebook</a></li>
<li class="chapter" data-level="5.4" data-path="transform.html"><a href="transform.html#record-our-goals"><i class="fa fa-check"></i><b>5.4</b> Record our goals</a></li>
<li class="chapter" data-level="5.5" data-path="transform.html"><a href="transform.html#set-up-our-notebook"><i class="fa fa-check"></i><b>5.5</b> Set up our notebook</a></li>
<li class="chapter" data-level="5.6" data-path="transform.html"><a href="transform.html#import-our-data"><i class="fa fa-check"></i><b>5.6</b> Import our data</a></li>
<li class="chapter" data-level="5.7" data-path="transform.html"><a href="transform.html#filter"><i class="fa fa-check"></i><b>5.7</b> Filter()</a><ul>
<li class="chapter" data-level="5.7.1" data-path="transform.html"><a href="transform.html#filter-your-turn"><i class="fa fa-check"></i><b>5.7.1</b> Filter your turn</a></li>
<li class="chapter" data-level="5.7.2" data-path="transform.html"><a href="transform.html#common-mistakes-with-filter"><i class="fa fa-check"></i><b>5.7.2</b> Common mistakes with filter</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="transform.html"><a href="transform.html#combining-filters"><i class="fa fa-check"></i><b>5.8</b> Combining filters</a><ul>
<li class="chapter" data-level="5.8.1" data-path="transform.html"><a href="transform.html#your-turn-combining-filters"><i class="fa fa-check"></i><b>5.8.1</b> Your turn combining filters</a></li>
<li class="chapter" data-level="5.8.2" data-path="transform.html"><a href="transform.html#common-mistakes-with-combining-filters"><i class="fa fa-check"></i><b>5.8.2</b> Common mistakes with combining filters</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="transform.html"><a href="transform.html#arrange"><i class="fa fa-check"></i><b>5.9</b> Arrange()</a></li>
<li class="chapter" data-level="5.10" data-path="transform.html"><a href="transform.html#multi-step-operations"><i class="fa fa-check"></i><b>5.10</b> Multi-step operations</a><ul>
<li class="chapter" data-level="5.10.1" data-path="transform.html"><a href="transform.html#your-turn-to-combine-and-pipe"><i class="fa fa-check"></i><b>5.10.1</b> Your turn to combine and pipe</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="transform.html"><a href="transform.html#select"><i class="fa fa-check"></i><b>5.11</b> Select()</a></li>
<li class="chapter" data-level="5.12" data-path="transform.html"><a href="transform.html#mutate"><i class="fa fa-check"></i><b>5.12</b> Mutate()</a><ul>
<li class="chapter" data-level="5.12.1" data-path="transform.html"><a href="transform.html#your-turn-to-mutate"><i class="fa fa-check"></i><b>5.12.1</b> Your turn to mutate</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="transform.html"><a href="transform.html#summarize"><i class="fa fa-check"></i><b>5.13</b> Summarize()</a><ul>
<li class="chapter" data-level="5.13.1" data-path="transform.html"><a href="transform.html#ignoring-na"><i class="fa fa-check"></i><b>5.13.1</b> ignoring na</a></li>
<li class="chapter" data-level="5.13.2" data-path="transform.html"><a href="transform.html#your-turn-with-summarise"><i class="fa fa-check"></i><b>5.13.2</b> Your turn with summarise</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="transform.html"><a href="transform.html#group_by"><i class="fa fa-check"></i><b>5.14</b> Group_by()</a><ul>
<li class="chapter" data-level="5.14.1" data-path="transform.html"><a href="transform.html#group-and-count"><i class="fa fa-check"></i><b>5.14.1</b> Group and count</a></li>
<li class="chapter" data-level="5.14.2" data-path="transform.html"><a href="transform.html#your-turn-to-group"><i class="fa fa-check"></i><b>5.14.2</b> Your turn to group</a></li>
<li class="chapter" data-level="5.14.3" data-path="transform.html"><a href="transform.html#counting-only"><i class="fa fa-check"></i><b>5.14.3</b> Counting only</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="transform.html"><a href="transform.html#transform-review"><i class="fa fa-check"></i><b>5.15</b> Transform review</a></li>
<li class="chapter" data-level="5.16" data-path="transform.html"><a href="transform.html#turn-in-your-project-1"><i class="fa fa-check"></i><b>5.16</b> Turn in your project</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>6</b> Cleaning</a><ul>
<li class="chapter" data-level="6.1" data-path="cleaning.html"><a href="cleaning.html#goals-for-this-section-2"><i class="fa fa-check"></i><b>6.1</b> Goals for this section</a><ul>
<li class="chapter" data-level="6.1.1" data-path="cleaning.html"><a href="cleaning.html#resources-1"><i class="fa fa-check"></i><b>6.1.1</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cleaning.html"><a href="cleaning.html#taking-stock-of-the-data"><i class="fa fa-check"></i><b>6.2</b> Taking stock of the data</a></li>
<li class="chapter" data-level="6.3" data-path="cleaning.html"><a href="cleaning.html#setup-and-import"><i class="fa fa-check"></i><b>6.3</b> Setup and import</a></li>
<li class="chapter" data-level="6.4" data-path="cleaning.html"><a href="cleaning.html#clean-the-proposed_use-column"><i class="fa fa-check"></i><b>6.4</b> Clean the proposed_use column</a><ul>
<li class="chapter" data-level="6.4.1" data-path="cleaning.html"><a href="cleaning.html#count-values-in-a-column"><i class="fa fa-check"></i><b>6.4.1</b> Count values in a column</a></li>
<li class="chapter" data-level="6.4.2" data-path="cleaning.html"><a href="cleaning.html#change-values-in-a-column"><i class="fa fa-check"></i><b>6.4.2</b> Change values in a column</a></li>
<li class="chapter" data-level="6.4.3" data-path="cleaning.html"><a href="cleaning.html#reassign-your-changes-back-to-the-data-frame"><i class="fa fa-check"></i><b>6.4.3</b> Reassign your changes back to the data frame</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="cleaning.html"><a href="cleaning.html#export-your-updated-data-frame"><i class="fa fa-check"></i><b>6.5</b> Export your updated data frame</a></li>
<li class="chapter" data-level="6.6" data-path="cleaning.html"><a href="cleaning.html#future-addition"><i class="fa fa-check"></i><b>6.6</b> Future addition</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>7</b> Graphics</a><ul>
<li class="chapter" data-level="7.1" data-path="graphics.html"><a href="graphics.html#goals-for-this-section-3"><i class="fa fa-check"></i><b>7.1</b> Goals for this section</a><ul>
<li class="chapter" data-level="7.1.1" data-path="graphics.html"><a href="graphics.html#resources-and-further-reading"><i class="fa fa-check"></i><b>7.1.1</b> Resources and further reading</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="graphics.html"><a href="graphics.html#introduction-ggplot"><i class="fa fa-check"></i><b>7.2</b> Introduction ggplot</a></li>
<li class="chapter" data-level="7.3" data-path="graphics.html"><a href="graphics.html#set-up-our-notebook-1"><i class="fa fa-check"></i><b>7.3</b> Set up our Notebook</a></li>
<li class="chapter" data-level="7.4" data-path="graphics.html"><a href="graphics.html#wells-per-county"><i class="fa fa-check"></i><b>7.4</b> Wells per county</a><ul>
<li class="chapter" data-level="7.4.1" data-path="graphics.html"><a href="graphics.html#shape-our-data"><i class="fa fa-check"></i><b>7.4.1</b> Shape our data</a></li>
<li class="chapter" data-level="7.4.2" data-path="graphics.html"><a href="graphics.html#the-basic-ggplot-template"><i class="fa fa-check"></i><b>7.4.2</b> The basic ggplot template</a></li>
<li class="chapter" data-level="7.4.3" data-path="graphics.html"><a href="graphics.html#plot-our-wells-by-county"><i class="fa fa-check"></i><b>7.4.3</b> Plot our wells by county</a></li>
<li class="chapter" data-level="7.4.4" data-path="graphics.html"><a href="graphics.html#add-a-layer-of-text-labels"><i class="fa fa-check"></i><b>7.4.4</b> Add a layer of text labels</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="graphics.html"><a href="graphics.html#wells-per-county-over-time"><i class="fa fa-check"></i><b>7.5</b> Wells per county over time</a><ul>
<li class="chapter" data-level="7.5.1" data-path="graphics.html"><a href="graphics.html#work-up-the-data-frame"><i class="fa fa-check"></i><b>7.5.1</b> Work up the data frame</a></li>
<li class="chapter" data-level="7.5.2" data-path="graphics.html"><a href="graphics.html#draw-the-plot"><i class="fa fa-check"></i><b>7.5.2</b> Draw the plot</a></li>
<li class="chapter" data-level="7.5.3" data-path="graphics.html"><a href="graphics.html#your-turn-add-layers"><i class="fa fa-check"></i><b>7.5.3</b> Your turn: Add layers</a></li>
<li class="chapter" data-level="7.5.4" data-path="graphics.html"><a href="graphics.html#dates-as-numbers-and-the-problems-they-cause"><i class="fa fa-check"></i><b>7.5.4</b> Dates as numbers and the problems they cause</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="graphics.html"><a href="graphics.html#your-turn-build-a-line-chart"><i class="fa fa-check"></i><b>7.6</b> Your turn: Build a line chart</a></li>
<li class="chapter" data-level="7.7" data-path="graphics.html"><a href="graphics.html#review-of-ggplot"><i class="fa fa-check"></i><b>7.7</b> Review of ggplot</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>8</b> Tidy data</a></li>
<li class="chapter" data-level="9" data-path="graphics2.html"><a href="graphics2.html"><i class="fa fa-check"></i><b>9</b> Graphics II</a></li>
<li class="chapter" data-level="10" data-path="census.html"><a href="census.html"><i class="fa fa-check"></i><b>10</b> Census</a><ul>
<li class="chapter" data-level="10.1" data-path="census.html"><a href="census.html#resources-2"><i class="fa fa-check"></i><b>10.1</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="joins.html"><a href="joins.html"><i class="fa fa-check"></i><b>11</b> Joins and merges</a></li>
<li class="chapter" data-level="12" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>12</b> Data packages</a></li>
<li class="chapter" data-level="13" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>13</b> Maps</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reporting with Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transform" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Transform</h1>
<div id="goals-for-the-section" class="section level2">
<h2><span class="header-section-number">5.1</span> Goals for the section</h2>
<ul>
<li>Start using Markdown to record our goals, actions and explain our code.</li>
<li>Use the <a href="">dplyr</a> tools to filter, sort and create new columns of data.</li>
</ul>
</div>
<div id="introducing-dplyr" class="section level2">
<h2><span class="header-section-number">5.2</span> Introducing dplyr</h2>
<p>One of the packages within the tidyverse is <a href="https://dplyr.tidyverse.org/">dplyr</a> ( <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a> ) which allows us to transform our data frames in ways that let us explore the data and prepare it for visualizing. It’s the R equivalent of common Excel functions like sort, filter and pivoting.</p>
<div class="figure">
<img src="images/transform-dplyractions.png" alt="dplyr functions" width="600" />
<p class="caption">dplyr functions</p>
</div>
<p>(Some slides included here are used with permission from Hadley and Charlotte Wickham.)</p>
</div>
<div id="start-a-new-r-notebook" class="section level2">
<h2><span class="header-section-number">5.3</span> Start a new R Notebook</h2>
<p>As I explained at the end of our last lesson, it’s a good practice to separate your import/cleaning functions from your analysis functions into separate notebooks, so we’ll create a new one for our analysis.</p>
<ul>
<li>Launch RStudio and open your wells project.</li>
<li>Create a new R Notebook and set a new title of “Wells exploration and analysis”.</li>
<li>Remove the boilerplate language and add a description of our goals: To explore an analyze our wells project. Mention that you have to run the other notebook first in case your someone else (or your future self) comes here first.</li>
<li>Save your file as <code>02-wells-explore.Rmd</code>.</li>
<li>Insert a new chunk to load the tidyverse library but after the <code>{r}</code> add the word “setup”, like this: <code>{r setup}</code>. We’ll start naming all our chunks this way.</li>
</ul>
<pre class="pre"><code>{r setup}
library(tidyverse)</code></pre>
<p>Same for the import.</p>
<pre class="pre"><code>{r import}
wells &lt;- readRDS(&quot;data-out/wells_02.rds&quot;)</code></pre>
</div>
<div id="record-our-goals" class="section level2">
<h2><span class="header-section-number">5.4</span> Record our goals</h2>
<p>What do we want to learn about these wells? Look over the columns and some of the values in them and come up with a list of at least five things you might want to learn from the data.</p>
<ul>
<li>Add a Markdown headline <code>## Goals</code>.</li>
<li>Create a bullet list of things you might want to find. Use a <code>*</code> or <code>-</code> to start each new line.</li>
</ul>
<p>We’ll review some of your ideas in class.</p>
</div>
<div id="set-up-our-notebook" class="section level2">
<h2><span class="header-section-number">5.5</span> Set up our notebook</h2>
<p>By adding the word <code>setup</code> after our the <code>{r}</code> at the beginning, then we can find that chunk in our navigation drop down at the bottom of the R Notebook window.</p>
<div class="figure">
<img src="images/transform-navigate.png" alt="R Notebook navigation" width="500" />
<p class="caption">R Notebook navigation</p>
</div>
</div>
<div id="import-our-data" class="section level2">
<h2><span class="header-section-number">5.6</span> Import our data</h2>
<ul>
<li>Add a Markdown headline and description that you are loading the data.</li>
<li>Add a code chunk named <code>import</code> with the following:</li>
</ul>
<div class="figure">
<img src="images/transform-wells-import.png" alt="Wells data imported" width="600" />
<p class="caption">Wells data imported</p>
</div>
<p>Now we are back to where we ended with the first notebook.</p>
</div>
<div id="filter" class="section level2">
<h2><span class="header-section-number">5.7</span> Filter()</h2>
<p>Let’s filter all the wells to the those just in Travis County. We’ll use dplyr’s <code>filter()</code> function to this this. It works like this:</p>
<div class="figure">
<img src="images/transform-filter.png" alt="dplyr filter function" width="600" />
<p class="caption">dplyr filter function</p>
</div>
<p>Let’s filter our wells data to just those in Travis County:</p>
<div class="figure">
<img src="images/transform-wells-travis.png" alt="Travis wells" />
<p class="caption">Travis wells</p>
</div>
<p>When you run this, you’ll see that you the about 9000 rows instead of the 18,000+ of the full data set.</p>
<p>Note the two equals signs there <code>==</code>. It’s important two use two of them, as a single <code>=</code> will not work, as that means something else.</p>
<p>There are a number of these logical test operations:</p>
<div class="figure">
<img src="images/transform-logical-test.png" alt="dplyr logical tests" width="600" />
<p class="caption">dplyr logical tests</p>
</div>
<div id="filter-your-turn" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Filter your turn</h3>
<p>Create new code blocks and filter for the following:</p>
<ul>
<li>Wells with a proposed use of Irrigation.</li>
<li>Wells at least 1000 feet deep.</li>
<li>One more that might help you answer one of your goals you listed above.</li>
</ul>
</div>
<div id="common-mistakes-with-filter" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Common mistakes with filter</h3>
<div class="figure">
<img src="images/transform-common-mistakes.png" alt="Common filtering mistakes" />
<p class="caption">Common filtering mistakes</p>
</div>
</div>
</div>
<div id="combining-filters" class="section level2">
<h2><span class="header-section-number">5.8</span> Combining filters</h2>
<p>You can filter for more than one thing at a time by separating more than one test with a comma.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(wells, county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>, proposed_use <span class="op">==</span><span class="st"> &quot;Irrigation&quot;</span>)</code></pre></div>
<p>If you use a comma to separate tests, then both tests have to be true. If you want OR, then you use a pipe <code>|</code> (the shift-key above the backslash.)</p>
<div class="figure">
<img src="images/transform-boolean.png" alt="Boolean operators" width="600" />
<p class="caption">Boolean operators</p>
</div>
<div id="your-turn-combining-filters" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Your turn combining filters</h3>
<p>Your quest is to filter to wells in Travis or Williamson counties that have a start date in 2018. <strong>BIG HINT</strong>: If you include <code>library(lubridate)</code> in your notebook then you can access the year of a field with <code>year(name_of_date_field)</code>.</p>
</div>
<div id="common-mistakes-with-combining-filters" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Common mistakes with combining filters</h3>
<div class="figure">
<img src="images/transform-mistakes-two.png" alt="Common mistakes combining" width="600" />
<p class="caption">Common mistakes combining</p>
</div>
<p>Note if you want to combine a series of strings in your filter, you have to put them inside a “concatenate” function, which is shortened to <code>c()</code>, as in the example above.</p>
</div>
</div>
<div id="arrange" class="section level2">
<h2><span class="header-section-number">5.9</span> Arrange()</h2>
<p>The <code>arrange()</code> function sorts data.</p>
<div class="figure">
<img src="images/transform-arrange.png" alt="Sort with arrange()" width="600" />
<p class="caption">Sort with arrange()</p>
</div>
<p>Let’s sort our data by their depth:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(wells, borehole_depth)</code></pre></div>
<p>You’ll have to scroll the columns over to see it, and the depths start at zero, which is not very sexy. As journalists, we usually want to see the largest (or deepest) thing, so we can arrange the column in descending order with this:</p>
<div class="figure">
<img src="images/transform-wells-deep.png" alt="Deepest wells" />
<p class="caption">Deepest wells</p>
</div>
<p>Now we see some deep wells … 3300 feet when I pulled my test data.</p>
</div>
<div id="multi-step-operations" class="section level2">
<h2><span class="header-section-number">5.10</span> Multi-step operations</h2>
<p>But what if you want to both filter and arrange? It is possible to nest such operations, but there is a better way: the pipe.</p>
<div class="figure">
<img src="images/transform-pipe.png" alt="Piping functions" width="600" />
<p class="caption">Piping functions</p>
</div>
<p>Two things to think of with the pipe <code>%&gt;%</code>.</p>
<ul>
<li>Think of it as “and then to this”.</li>
<li>The keyboard command <em>Cmd+Shift+m</em> (Mac) or <em>Ctrl+Shift+m</em> (Windows) will give you the pipe.</li>
</ul>
<p>Need to remember that key command? While I didn’t invent the pipe, you might remember that Professor <strong>M</strong>cDonald taught it to you.</p>
<p>Let’s find the deepest well in Travis County:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wells <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(borehole_depth))</code></pre></div>
<p>All the tidyverse functions understand the pipe, and we’ll be using it a lot. It makes it easier to write and understand the code.</p>
<p>Another advantage you’ll see is you can use tab completion in more places when you use pipes. RStudio better understands the fields you are working with when you declare the data frame first.</p>
<div id="your-turn-to-combine-and-pipe" class="section level3">
<h3><span class="header-section-number">5.10.1</span> Your turn to combine and pipe</h3>
<p>Find a list of the deepest irrigation wells in Travis County in 2017. Use the pipe to string together your functions.</p>
</div>
</div>
<div id="select" class="section level2">
<h2><span class="header-section-number">5.11</span> Select()</h2>
<p>As we’ve worked with <code>borehole_depth</code> it’s been kind of a pain to tab through all the fields to see the result we want. The <code>select()</code> function allows you to choose which fields to display from a data frame. If we are only interested in the <code>owner</code> and <code>borehole_depth</code> from our previous query of deepest wells in Travis, then we we can pipe the results to a select function. It works by listing the column names inside the function. You can use <code>-</code> before a column name to remove it.</p>
<p>Add this to the end of your previous code chunk:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&lt;</span>code chunk<span class="op">&gt;</span><span class="st"> </span><span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(owner_name, borehole_depth)</code></pre></div>
<p>The order of all these operations matter. If you use select to remove a column, you cannot filter using that column later.</p>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">5.12</span> Mutate()</h2>
<p>The mutate function allows us to change data based on a formula. We can assign the change back to an existing column or create a new one.</p>
<div class="figure">
<img src="images/transform-mutate.png" alt="Create columns with mutate()" width="600" />
<p class="caption">Create columns with mutate()</p>
</div>
<p>In the example above:</p>
<ul>
<li><code>gapminder</code> is the source data frame.</li>
<li><code>gdp</code> is the new column being created. it comes first.</li>
<li><code>= gdpPercap * pop</code> is the function. It is multiplying the the two columns that are in the <code>gapminder</code> data frame.</li>
</ul>
<p>The applied function doesn’t have to be math. It could be pulling part of a string or any number of things.</p>
<p>We’ll use this to create a new “year” column that has just the year that well was started. It will help us plot data later.</p>
<p>We’re going to do this is two steps. We’ll first write the function to make sure it working like we want, then we’ll assign the result back to the <code>wells</code> data frame.</p>
<div class="figure">
<img src="images/transform-wells-mutate-select.png" alt="Mutate and select" />
<p class="caption">Mutate and select</p>
</div>
<p>You’ll end up with two columns. We added the <code>select()</code> function so we didn’t have to dig through the data frame to see if it worked. Now we can modify the code chunk to save our changes:</p>
<ul>
<li>Before the code chunk, write out what we are doing. Add a Markdown headline and description of our task: to add a “year” column.</li>
<li>Name the chunk by adding <code>add_year</code> inside the <code>{r}</code> part of the chunk.</li>
<li>Remove the pipe and the <code>select()</code> statement, as we don’t want to lose those columns for realz.</li>
<li>Edit the first line <code>wells %&gt;%</code> to <code>wells &lt;- wells %&gt;%</code> to assign the mutate result back to our wells data frame.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wells &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year_drilled =</span> <span class="kw">year</span>(drilling_start_date))</code></pre></div>
<p>When you do this, it won’t print the table to the screen anymore because you’ve instead reassigned it. Inspect the <code>wells</code> data frame within the Environment tab and to make sure it was created properly.</p>
<p>Like with <code>filter()</code>, we can create more than one column within the same <code>mutate()</code> function by separating them with commas.</p>
<div id="your-turn-to-mutate" class="section level3">
<h3><span class="header-section-number">5.12.1</span> Your turn to mutate</h3>
<ul>
<li>Modify the above mutate function to also add a <code>month_drilled</code> column.</li>
</ul>
</div>
</div>
<div id="summarize" class="section level2">
<h2><span class="header-section-number">5.13</span> Summarize()</h2>
<p>The <code>summarize()</code> and <code>summarise()</code> functions compute tables <em>about</em> your data. They are the same function, as R supports both the American and European spelling of summarize. I don’t care which you use.</p>
<div class="figure">
<img src="images/transform-summarise.png" alt="Learn about your data with Summarize()" width="600" />
<p class="caption">Learn about your data with Summarize()</p>
</div>
<p>Much like the <code>mutate()</code> function, we list the name of the new column first, then assign to it the function we want to accomplish using <code>=</code>.</p>
<p>Let’s find the average <code>borehole_depth</code> of all the wells.</p>
<div class="figure">
<img src="images/transform-wells-nanowork.png" alt="Attempt to find the mean" />
<p class="caption">Attempt to find the mean</p>
</div>
<p>But, our return isn’t good? What’s up with that?</p>
<div id="ignoring-na" class="section level3">
<h3><span class="header-section-number">5.13.1</span> ignoring na</h3>
<p>In short, you can’t divide by zero or a NULL or NA value. I’ll show you how to ignore them, but first we should find out how many there are:</p>
<div class="figure">
<img src="images/transform-wells-findna.png" alt="Find NA values" />
<p class="caption">Find NA values</p>
</div>
<p>Take a look at this and guess what is happening. Clearly <code>is.na</code> is a thing. How is it being used?</p>
<p>There are 22 records returned out of 18k+. Can we safely exclude them? I think so.</p>
<p>We can apply a similar function <code>na.rm</code> function inside our <code>summarise()</code> filter to remove the missing values before the calculation, like this:</p>
<div class="figure">
<img src="images/transform-wells-narm.png" alt="NAs removed from summarize" />
<p class="caption">NAs removed from summarize</p>
</div>
<p>A mean (or average in common terms) is a way to use one number to represent a group of numbers. It works well when the variance in the numbers is not great. Median is another way, and sometimes better when there are high or low numbers that would unduly influence a mean.</p>
</div>
<div id="your-turn-with-summarise" class="section level3">
<h3><span class="header-section-number">5.13.2</span> Your turn with summarise</h3>
<p>Like filter and mutate, you can do more than one calculation within a summarize function. Edit the code chunk above in two ways:</p>
<ul>
<li>Make sure to name the code chunk, something like <code>depth_summaries</code>.</li>
<li>Modify the summarize function to also create a <code>median_depth</code> summary. Look at your dplyr cheat sheet or google to find out how.</li>
</ul>
</div>
</div>
<div id="group_by" class="section level2">
<h2><span class="header-section-number">5.14</span> Group_by()</h2>
<p>The <code>summarise()</code> function is an especially useful in combination with another function called <code>group_by()</code>, which allows us to pivot tables to count and measure data by its values.</p>
<div class="figure">
<img src="images/transform-groupby.png" alt="Group by" width="600" />
<p class="caption">Group by</p>
</div>
<p>This is easier to understand when you can see an example, so let’s do it.</p>
<div id="group-and-count" class="section level3">
<h3><span class="header-section-number">5.14.1</span> Group and count</h3>
<p>So, we have more than 18,000 wells, but we don’t know how many of each kind. We could filter them one-by-one, but there is an easier way.</p>
<div class="figure">
<img src="images/transform-wells-groupbyn.png" alt="Group and count" />
<p class="caption">Group and count</p>
</div>
<p>Let’s break this down:</p>
<ul>
<li>We start with the <strong>wells</strong> data frame.</li>
<li>We then <strong>group_by</strong> the data by the <code>proposed_use</code>. If we print the data frame at this point, we won’t really see a difference. The <code>group_by()</code> function always needs another function.</li>
<li>We then <strong>summarise</strong> the grouped data. In this case, we are creating a column called <code>count</code>, and we are assigning to is a special function <code>n()</code> which counts the number of records within each group.
<ul>
<li>The result is for each unique value in the <strong>prospose_use</strong> column, we get the number of records that have that have that value.</li>
</ul></li>
<li>We then <strong>arrange</strong> the resulting table in descending order by our new column, <code>count</code>, so we can see which value has the most records.</li>
</ul>
<p>We can see that “Domestic” wells are more prevalent by a wide margin. If page through the list, you’ll see that to get an accurate count of each type of well, we’ll need to do some data cleaning. We’ll do that at another time.</p>
<p>Let’s walk through another example:</p>
<div class="figure">
<img src="images/transform-group-summarise.png" alt="Group and summarise" width="600" />
<p class="caption">Group and summarise</p>
</div>
</div>
<div id="your-turn-to-group" class="section level3">
<h3><span class="header-section-number">5.14.2</span> Your turn to group</h3>
<ul>
<li>How many wells were drilled in each county? Use the same <code>group_by</code> and <code>summarise</code> method to make a table that counts wells drilled in each county.</li>
<li>Since you can <code>summarise</code> by more than one thing, try to find the count and average (mean) borehole_depth of wells by proposed use. You can copy the first summary we did and work from that, editing the <code>summarise</code> statement.</li>
</ul>
</div>
<div id="counting-only" class="section level3">
<h3><span class="header-section-number">5.14.3</span> Counting only</h3>
<p>We’ll use summarize to do more than count, but if counting is all you want to know, there is an easier way. (I’ll try not to show you too many alternate methods … there are many ways to do everything, but this is worth knowing.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">well <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(proposed_use)</code></pre></div>
<p>It creates a column named “n” with the count. You could <em>then</em> use <code>rename(new = old)</code> to call it something else, like “wells_drilled”.</p>
</div>
</div>
<div id="transform-review" class="section level2">
<h2><span class="header-section-number">5.15</span> Transform review</h2>
<p>This has been a lot to learn, but it is the basics of just about any data analysis … to <strong>filter</strong>, <strong>select</strong>, <strong>arrange</strong>, <strong>group</strong> and <strong>summarise</strong> values. And to create new variables with with <strong>mutate</strong>.</p>
<p>Next, we’ll start plotting some of this data so we can <em>see</em> it.</p>
</div>
<div id="turn-in-your-project-1" class="section level2">
<h2><span class="header-section-number">5.16</span> Turn in your project</h2>
<p>At this point, you’ll want so <strong>save</strong>, <strong>knit to HTML</strong> and then close your project. Zip up the folder and turn it into the assignment in Canvas.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="columns.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cleaning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-transform.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
