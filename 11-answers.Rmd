# Plotting for answers {#answers}

This is the second of of a two-chapter project. Now that we have assembled and cleaned our data, we need to answer this question in our followup to the [Denied] series: **Has the percentage of special education students in each school district changed since the benchmarking policy was dropped? How many districts were above that arbitrary 8.5% benchmark before and after the changes? And lastly, how have local districts changed?**

The idea here is to answer those two questions through plotting. We'll use this chapter to walk through the process of using plots to explore and find answers from yor data.

## Goals of this chapter

- Introduce `datatables()` from the [DT package](https://rstudio.github.io/DT/)
- Practice pivots to prepare data for plotting
- Practice plots to reveal insights in data
- There is a writing assignment

## Project setup

1. Within the same project you've been working, create a new R Notebook. You might call it `02-analysis`.
1. We will be using a new package so you'll need to install it. Use your Console to run `install.packages("DT")`.
1. Include the libraries below and run them.

```{r setup, results='hide', message=F, warning=F}
library(tidyverse)
library(scales)
library(DT)
```

## Import cleaned data

1. Create a section for your import
2. Import your cleaned data and call it `sped` if you want to follow along here.

You should know how do do all that and I don't know what you called in export anyway.

```{r import, include=FALSE}
sped <- read_rds("data-processed/01-sped-districts.rds")

sped %>% head()
```

But to recap, it should look like this:

```{r}
sped %>% head()
```

## Make a searchable table

Wouldn't it be nice to be able to see the percentage of special education students for each district for each year? The way our data is formatted now, that's pretty hard to see with our "long" data here.

Something more like this?  (But with all the years)

| distname      | cntyname | 2013 | 2014 | 2015 | etc |
|---------------|----------|-----:|-----:|-----:|-----|
| CAYUGA ISD    | ANDERSON | 12.3 | 13.7 | 13.2 | ... |
| ELKHART ISD   | ANDERSON |  9.1 |  8.9 | 10.4 | ... |
| FRANKSTON ISD | ANDERSON | 10.8 |  9.7 |  9.7 | ... |
| NECHES ISD    | ANDERSON | 11.1 |    9 | 11.1 | ... |
| PALESTINE ISD | ANDERSON |  7.7 |  7.8 |  8.7 | ... |
| WESTWOOD ISD  | ANDERSON |  9.3 |   10 |  9.3 | ... |

And what if you could make that table searchable to find a district by name or county? That would be magic, right?

We can do this by first reshaping our data using `pivot_wider()` and then applying a function called `datatable()`.

### Pivot wider

You used [`pivot_wider()`](https://tidyr.tidyverse.org/reference/pivot_wider.html) with the candy data [in Chapter 9](https://utdata.github.io/rwdir/tidy-data.html#pivot-wider), so you can look back at how that was done, but here are some hints:

1. Create a new section that notes you are creating a table of district percents.
1. First use `select()` to get just the columns you need: `distname`, `cntyname` and `sped_percent.`
1. Then use `pivot_wider()`to make a tibble like the one above. Remember that the `names_from =` argument wants to know which column you want to use to create the names of the new columns. The `values_from = ` argument wants to know which column to pull the cell values from.
1. Save the result into a new tibble and call it `district_percents_data`

<details>
  <summary>You won't need this code below because I believe in you</summary>

```{r select-pivot-wider}
district_percents_data <- sped %>% 
  select(distname, cntyname, year, sped_percent) %>% 
  pivot_wider(names_from = year, values_from = sped_percent)
```
<details>


### Make a datatable

Now comes the magic. 

1. In a new R chunk take your `district_percents_data` and then pipe it into a function called `datatable()`

```{r datatable}
district_percents_data %>% 
  datatable()
```

That's kinda brilliant, isn't it? You know can search by any value in the table.

Quick, tell me what was the percentage for Austin ISD in 2020?

That will be useful tool for you when you are writing about specific districts.

## Plot yearly student percentage

Our first question about this data was this: **Has the percentage of special education students in each school district changed since the benchmarking policy was dropped?**

Given the data we have, can we answer this?

I'll often do a hand drawing of a chart that might help me understand or communicate data. This helps me think about how to summarize and shape my data to get to that point.

For this question, we might think of a chart like this: 

![](images/chart-example.png)

For each year, we'd like to know the percentage of students in special education. If we are to chart this, the x axis would be the year and the y axis would be the percentage for that year.

We have the percent of students in special education for each district in each year. We _could_ get an average of those percentages for each year, but that won't take into account the size of each districts.

But we also have the count of all students in a district `all_count` and count of all special education students `sped_count`. With these, we can build a more accurate percentage across _all_ the districts with this. This allows us to calculate our student groups by year.

So, let's build this bar chart ... starting with the data. This is a "simple" group_by and summarize, so I'll give you hints but you write it yourself.

1. Start a new notebook section and note you are getting yearly percentages
1. In an R chunk, start with your `sped` data.
1. Group by the `year` variable.
1. In summarize, create a `sum()` of the `all_count` variable
1. In the same sumarize, create a sum() of the `sped_count` variable. You might call this `total_students`.
1. Check your results at this point ... make sure it makes sense. You might call this `total_sped`
1. Use `mutate()` to create a percentage called `sped_percent` from your `total_students` and `total_sped` summaries.
1. I suggest you save all that into a new tibble called `yearly_percent` (because that's what I'm gonna use.)

<details>
  <summary>My verison</summary>
```{r yearly-percent-data}
yearly_percent <- sped %>% 
  group_by(year) %>% 
  summarise(
    total_students = sum(all_count),
    total_sped = sum(sped_count)
  ) %>% 
  mutate(sped_percent = ((total_sped / total_students) * 100) %>% round(1))

yearly_percent
```
</details>

And with that table, you can plot your chart using the `year` and `sped_percent`.


```{r yearly-percent-plot}
yearly_percent %>% 
  ggplot(aes(x = year, y = sped_percent)) + 
  geom_col() +
  geom_text(aes(label = sped_percent, vjust = -.5))
```

This definitely shows us that the percentage of students in special education (in traditional public schools) has increased each year since 2017 when the benchmark was dropped and then outlawed by the legislature.

I would be careful about saying the increase is _because_ of the changes (though that is likely true), but you can certainly say with authority that it has gone up, and interview other people to pontificate on the reasons why.

BTW, if you wanted to make that chart in [datawrapper](https://academy.datawrapper.de/article/20-how-to-create-a-column-chart), you could use the same tibble, select just the `year` and `sped_percent` columsn and then use the `clipr::write_clip()` function to copy your data.


## Districts by benchmark and year

Our second question is this: **How many districts were above that arbitrary 8.5% benchmark before and after the changes?**









