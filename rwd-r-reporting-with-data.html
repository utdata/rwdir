<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Reporting with Data in R</title>
  <meta name="description" content="Reporting with Data in R is a series of lessons and instructions used in the Spring 2019 course J327D REPORTING WITH DATA in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It was taught by Christian McDonald.">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="Reporting with Data in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Reporting with Data in R is a series of lessons and instructions used in the Spring 2019 course J327D REPORTING WITH DATA in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It was taught by Christian McDonald." />
  <meta name="github-repo" content="utdata/rwd-r-reporting-with-data" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Reporting with Data in R" />
  
  <meta name="twitter:description" content="Reporting with Data in R is a series of lessons and instructions used in the Spring 2019 course J327D REPORTING WITH DATA in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It was taught by Christian McDonald." />
  

<meta name="author" content="Christian McDonald">


<meta name="date" content="2019-06-18">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<style type="text/css">
  p.caption {
    color: #777;
    margin-top: 10px;
  }
  p code, pre, pre code, li code {
    background-color: #DCDCDC !important;
  }
</style>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Reporting with Data in R</h1>
<p class="author"><em>Christian McDonald</em></p>
<p class="date"><em>2019-06-18</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#about-this-class">About this class</a><ul>
<li><a href="#about-this-book">About this book</a></li>
<li><a href="#about-the-author">About the author</a></li>
<li><a href="#other-resources">Other resources</a></li>
</ul></li>
<li><a href="#install"><span class="toc-section-number">1</span> Install Party</a><ul>
<li><a href="#installing-r"><span class="toc-section-number">1.1</span> Installing R</a></li>
<li><a href="#installing-rstudio"><span class="toc-section-number">1.2</span> Installing RStudio</a></li>
<li><a href="#class-project-folder"><span class="toc-section-number">1.3</span> Class project folder</a></li>
</ul></li>
<li><a href="#intro"><span class="toc-section-number">2</span> Introduction to R</a><ul>
<li><a href="#rstudio-tour"><span class="toc-section-number">2.1</span> RStudio tour</a></li>
<li><a href="#updating-preferences"><span class="toc-section-number">2.2</span> Updating preferences</a></li>
<li><a href="#starting-a-new-project"><span class="toc-section-number">2.3</span> Starting a new Project</a></li>
<li><a href="#using-r-notebooks"><span class="toc-section-number">2.4</span> Using R Notebooks</a><ul>
<li><a href="#create-your-first-notebook"><span class="toc-section-number">2.4.1</span> Create your first notebook</a></li>
<li><a href="#save-the-.rmd-file"><span class="toc-section-number">2.4.2</span> Save the .Rmd file</a></li>
<li><a href="#run-the-notebook"><span class="toc-section-number">2.4.3</span> Run the notebook</a></li>
<li><a href="#adding-new-code-chunks"><span class="toc-section-number">2.4.4</span> Adding new code chunks</a></li>
<li><a href="#practice-adding-code-chunks"><span class="toc-section-number">2.4.5</span> Practice adding code chunks</a></li>
<li><a href="#preview-the-report"><span class="toc-section-number">2.4.6</span> Preview the report</a></li>
<li><a href="#the-toolbar"><span class="toc-section-number">2.4.7</span> The toolbar</a></li>
<li><a href="#knit-the-final-workbook"><span class="toc-section-number">2.4.8</span> Knit the final workbook</a></li>
</ul></li>
<li><a href="#turning-in-our-projects"><span class="toc-section-number">2.5</span> Turning in our projects</a></li>
</ul></li>
<li><a href="#import"><span class="toc-section-number">3</span> Importing data</a><ul>
<li><a href="#goals-for-this-section"><span class="toc-section-number">3.1</span> Goals for this section</a></li>
<li><a href="#data-types"><span class="toc-section-number">3.2</span> Data types</a><ul>
<li><a href="#what-is-clean-data"><span class="toc-section-number">3.2.1</span> What is clean data</a></li>
</ul></li>
<li><a href="#create-a-new-project"><span class="toc-section-number">3.3</span> Create a new project</a><ul>
<li><a href="#the-r-package-environment"><span class="toc-section-number">3.3.1</span> The R Package environment</a></li>
<li><a href="#installing-and-using-packages"><span class="toc-section-number">3.3.2</span> Installing and using packages</a></li>
<li><a href="#load-the-libraries"><span class="toc-section-number">3.3.3</span> Load the libraries</a></li>
</ul></li>
<li><a href="#lets-get-some-data"><span class="toc-section-number">3.4</span> Let’s get some data</a><ul>
<li><a href="#inspect-the-data"><span class="toc-section-number">3.4.1</span> Inspect the data</a></li>
</ul></li>
<li><a href="#import-csv-as-data"><span class="toc-section-number">3.5</span> Import csv as data</a><ul>
<li><a href="#help-files"><span class="toc-section-number">3.5.1</span> Help files</a></li>
</ul></li>
<li><a href="#assign-our-data-to-a-data-frame"><span class="toc-section-number">3.6</span> Assign our data to a data frame</a></li>
<li><a href="#inspect-the-data-1"><span class="toc-section-number">3.7</span> Inspect the data</a><ul>
<li><a href="#write-notes-about-things-to-change"><span class="toc-section-number">3.7.1</span> Write notes about things to change</a></li>
</ul></li>
<li><a href="#turn-in-your-project"><span class="toc-section-number">3.8</span> Turn in your project</a></li>
<li><a href="#practice-assignment-import-census"><span class="toc-section-number">3.9</span> Practice assignment: Import census</a></li>
<li><a href="#resources"><span class="toc-section-number">3.10</span> Resources</a></li>
</ul></li>
<li><a href="#columns"><span class="toc-section-number">4</span> Columns</a><ul>
<li><a href="#goals-for-this-section-1"><span class="toc-section-number">4.1</span> Goals for this section</a></li>
<li><a href="#relaunch-the-wells-project"><span class="toc-section-number">4.2</span> Relaunch the Wells project</a></li>
<li><a href="#clean-up-column-names"><span class="toc-section-number">4.3</span> Clean up column names</a><ul>
<li><a href="#clean-names-with-janitor"><span class="toc-section-number">4.3.1</span> Clean names with janitor</a></li>
<li><a href="#simple-renaming-of-individual-columns"><span class="toc-section-number">4.3.2</span> Simple renaming of individual columns</a></li>
<li><a href="#mass-renaming-of-columns"><span class="toc-section-number">4.3.3</span> Mass renaming of columns</a></li>
</ul></li>
<li><a href="#clean-data-within-columns"><span class="toc-section-number">4.4</span> Clean data within columns</a><ul>
<li><a href="#using-lubridate-to-clean-dates"><span class="toc-section-number">4.4.1</span> Using lubridate to clean dates</a></li>
<li><a href="#fix-the-bore-hole-depth"><span class="toc-section-number">4.4.2</span> Fix the bore hole depth</a></li>
</ul></li>
<li><a href="#export-the-data"><span class="toc-section-number">4.5</span> Export the data</a></li>
<li><a href="#turn-in-wells"><span class="toc-section-number">4.6</span> Turn in wells</a></li>
<li><a href="#practice-assignment-clean-census-names"><span class="toc-section-number">4.7</span> Practice assignment: Clean census names</a></li>
</ul></li>
<li><a href="#transform"><span class="toc-section-number">5</span> Transform</a><ul>
<li><a href="#goals-for-the-section"><span class="toc-section-number">5.1</span> Goals for the section</a></li>
<li><a href="#introducing-dplyr"><span class="toc-section-number">5.2</span> Introducing dplyr</a></li>
<li><a href="#start-a-new-r-notebook"><span class="toc-section-number">5.3</span> Start a new R Notebook</a></li>
<li><a href="#record-our-goals"><span class="toc-section-number">5.4</span> Record our goals</a></li>
<li><a href="#name-your-code-chunks"><span class="toc-section-number">5.5</span> Name your code chunks</a></li>
<li><a href="#import-our-data"><span class="toc-section-number">5.6</span> Import our data</a></li>
<li><a href="#filter"><span class="toc-section-number">5.7</span> Filter()</a><ul>
<li><a href="#filter-your-turn"><span class="toc-section-number">5.7.1</span> Filter your turn</a></li>
<li><a href="#common-mistakes-with-filter"><span class="toc-section-number">5.7.2</span> Common mistakes with filter</a></li>
</ul></li>
<li><a href="#combining-filters"><span class="toc-section-number">5.8</span> Combining filters</a><ul>
<li><a href="#your-turn-combining-filters"><span class="toc-section-number">5.8.1</span> Your turn combining filters</a></li>
<li><a href="#common-mistakes-with-combining-filters"><span class="toc-section-number">5.8.2</span> Common mistakes with combining filters</a></li>
</ul></li>
<li><a href="#arrange"><span class="toc-section-number">5.9</span> Arrange()</a></li>
<li><a href="#multi-step-operations"><span class="toc-section-number">5.10</span> Multi-step operations</a><ul>
<li><a href="#your-turn-to-combine-and-pipe"><span class="toc-section-number">5.10.1</span> Your turn to combine and pipe</a></li>
</ul></li>
<li><a href="#select"><span class="toc-section-number">5.11</span> Select()</a></li>
<li><a href="#mutate"><span class="toc-section-number">5.12</span> Mutate()</a><ul>
<li><a href="#your-turn-to-mutate"><span class="toc-section-number">5.12.1</span> Your turn to mutate</a></li>
<li><a href="#document-and-save-new-columns"><span class="toc-section-number">5.12.2</span> Document and save new columns</a></li>
<li><a href="#export-the-mutated-data"><span class="toc-section-number">5.12.3</span> Export the mutated data</a></li>
</ul></li>
<li><a href="#summarize"><span class="toc-section-number">5.13</span> Summarize()</a><ul>
<li><a href="#ignoring-na"><span class="toc-section-number">5.13.1</span> ignoring na</a></li>
<li><a href="#your-turn-with-summarise"><span class="toc-section-number">5.13.2</span> Your turn with summarise</a></li>
</ul></li>
<li><a href="#group_by"><span class="toc-section-number">5.14</span> Group_by()</a><ul>
<li><a href="#group-and-count"><span class="toc-section-number">5.14.1</span> Group and count</a></li>
<li><a href="#your-turn-to-group"><span class="toc-section-number">5.14.2</span> Your turn to group</a></li>
<li><a href="#counting-only"><span class="toc-section-number">5.14.3</span> Counting only</a></li>
</ul></li>
<li><a href="#transform-review"><span class="toc-section-number">5.15</span> Transform review</a></li>
<li><a href="#turn-in-your-in-class-project"><span class="toc-section-number">5.16</span> Turn in your in-class project</a></li>
<li><a href="#practice-assignment-transforms-on-census"><span class="toc-section-number">5.17</span> Practice assignment: Transforms on census</a></li>
</ul></li>
<li><a href="#cleaning"><span class="toc-section-number">6</span> Cleaning</a><ul>
<li><a href="#goals-for-this-section-2"><span class="toc-section-number">6.1</span> Goals for this section</a><ul>
<li><a href="#resources-1"><span class="toc-section-number">6.1.1</span> Resources</a></li>
</ul></li>
<li><a href="#taking-stock-of-the-data"><span class="toc-section-number">6.2</span> Taking stock of the data</a></li>
<li><a href="#setup-and-import"><span class="toc-section-number">6.3</span> Setup and import</a></li>
<li><a href="#clean-the-proposed_use-column"><span class="toc-section-number">6.4</span> Clean the proposed_use column</a><ul>
<li><a href="#count-values-in-a-column"><span class="toc-section-number">6.4.1</span> Count values in a column</a></li>
<li><a href="#change-values-in-a-column"><span class="toc-section-number">6.4.2</span> Change values in a column</a></li>
<li><a href="#reassign-your-changes-back-to-the-data-frame"><span class="toc-section-number">6.4.3</span> Reassign your changes back to the data frame</a></li>
</ul></li>
<li><a href="#export-your-updated-data-frame"><span class="toc-section-number">6.5</span> Export your updated data frame</a></li>
<li><a href="#future-addition"><span class="toc-section-number">6.6</span> Future addition</a></li>
</ul></li>
<li><a href="#graphics"><span class="toc-section-number">7</span> Graphics</a><ul>
<li><a href="#goals-for-this-section-3"><span class="toc-section-number">7.1</span> Goals for this section</a></li>
<li><a href="#introduction-ggplot"><span class="toc-section-number">7.2</span> Introduction ggplot</a></li>
<li><a href="#the-basic-ggplot-template"><span class="toc-section-number">7.3</span> The basic ggplot template</a></li>
<li><a href="#lets-plot"><span class="toc-section-number">7.4</span> Let’s plot!</a><ul>
<li><a href="#set-up-our-notebook"><span class="toc-section-number">7.4.1</span> Set up our Notebook</a></li>
<li><a href="#scatterplot"><span class="toc-section-number">7.4.2</span> Scatterplot</a></li>
</ul></li>
<li><a href="#plotting-our-wells-data"><span class="toc-section-number">7.5</span> Plotting our wells data</a><ul>
<li><a href="#total-wells-per-county"><span class="toc-section-number">7.5.1</span> Total wells per county</a></li>
<li><a href="#add-a-layer-of-text-labels"><span class="toc-section-number">7.5.2</span> Add a layer of text labels</a></li>
</ul></li>
<li><a href="#wells-per-county-over-time"><span class="toc-section-number">7.6</span> Wells per county over time</a><ul>
<li><a href="#work-up-the-data-frame"><span class="toc-section-number">7.6.1</span> Work up the data frame</a></li>
<li><a href="#draw-the-plot"><span class="toc-section-number">7.6.2</span> Draw the plot</a></li>
<li><a href="#your-turn-add-layers"><span class="toc-section-number">7.6.3</span> Your turn: Add layers</a></li>
<li><a href="#dates-as-numbers-and-the-problems-they-cause"><span class="toc-section-number">7.6.4</span> Dates as numbers and the problems they cause</a></li>
</ul></li>
<li><a href="#your-turn-build-a-line-chart"><span class="toc-section-number">7.7</span> Your turn: Build a line chart</a></li>
<li><a href="#review-of-ggplot"><span class="toc-section-number">7.8</span> Review of ggplot</a></li>
<li><a href="#plotly-for-more-interactive-graphics"><span class="toc-section-number">7.9</span> Plotly for more interactive graphics</a><ul>
<li><a href="#ggplotly"><span class="toc-section-number">7.9.1</span> ggplotly</a></li>
<li><a href="#more-with-plot_ly-function"><span class="toc-section-number">7.9.2</span> More with <code>plot_ly()</code> function</a></li>
<li><a href="#plotlys-freemium-model"><span class="toc-section-number">7.9.3</span> Plotly’s freemium model</a></li>
</ul></li>
<li><a href="#resources-2"><span class="toc-section-number">7.10</span> Resources</a></li>
</ul></li>
<li><a href="#tidy"><span class="toc-section-number">8</span> Tidy data</a><ul>
<li><a href="#goals-for-this-section-4"><span class="toc-section-number">8.1</span> Goals for this section</a></li>
<li><a href="#what-is-tidy-data"><span class="toc-section-number">8.2</span> What is tidy data</a></li>
<li><a href="#tidyr-package"><span class="toc-section-number">8.3</span> Tidyr package</a></li>
<li><a href="#the-tidyr-verbs"><span class="toc-section-number">8.4</span> The tidyr verbs</a></li>
<li><a href="#set-up-the-mixbev-project"><span class="toc-section-number">8.5</span> Set up the mixbev project</a></li>
<li><a href="#create-an-explore-notebook"><span class="toc-section-number">8.6</span> Create an explore notebook</a><ul>
<li><a href="#peruse-the-data"><span class="toc-section-number">8.6.1</span> Peruse the data</a></li>
</ul></li>
<li><a href="#what-might-we-learn-about-this-dataset"><span class="toc-section-number">8.7</span> What might we learn about this dataset</a></li>
<li><a href="#add-years-and-months-values"><span class="toc-section-number">8.8</span> Add years and months values</a></li>
<li><a href="#campus-bars"><span class="toc-section-number">8.9</span> Campus bars</a><ul>
<li><a href="#total-78705-sales-leaders-in-2018"><span class="toc-section-number">8.9.1</span> Total 78705 sales leaders in 2018</a></li>
</ul></li>
<li><a href="#west-campus-student-hot-spots"><span class="toc-section-number">8.10</span> West Campus student hot spots</a></li>
<li><a href="#campus-area-bar-sales-over-time"><span class="toc-section-number">8.11</span> Campus-area bar sales over time</a><ul>
<li><a href="#visualizing-your-visualization"><span class="toc-section-number">8.11.1</span> Visualizing your visualization</a></li>
<li><a href="#what-did-we-find"><span class="toc-section-number">8.11.2</span> What did we find?</a></li>
</ul></li>
<li><a href="#types-of-sales-within-student-bars"><span class="toc-section-number">8.12</span> Types of sales within student bars</a></li>
<li><a href="#how-gather-works"><span class="toc-section-number">8.13</span> How gather() works</a></li>
<li><a href="#applying-gather-to-beer-wine-and-liquor"><span class="toc-section-number">8.14</span> Applying gather() to beer, wine and liquor</a><ul>
<li><a href="#plot-sales-by-type-for-a-single-campus-area-bar"><span class="toc-section-number">8.14.1</span> Plot sales by type for a single campus-area bar</a></li>
<li><a href="#plot-sales-by-type-for-multiple-campus-area-bars"><span class="toc-section-number">8.14.2</span> Plot sales by type for multiple campus-area bars</a></li>
<li><a href="#what-did-we-learn"><span class="toc-section-number">8.14.3</span> What did we learn?</a></li>
</ul></li>
<li><a href="#the-spread-function"><span class="toc-section-number">8.15</span> The spread() function</a></li>
<li><a href="#practice-assignment-exploring-the-top-seller"><span class="toc-section-number">8.16</span> Practice assignment: Exploring the top seller</a></li>
<li><a href="#bonus-top-5-sellers-in-travis-county-over-three-years"><span class="toc-section-number">8.17</span> Bonus: Top 5 sellers in Travis County over three years</a></li>
<li><a href="#bonus-total-sales-by-county"><span class="toc-section-number">8.18</span> Bonus: Total sales by county</a></li>
</ul></li>
<li><a href="#reordering-factors"><span class="toc-section-number">9</span> Reordering factors</a><ul>
<li><a href="#goals-for-this-section-5"><span class="toc-section-number">9.1</span> Goals for this section</a></li>
<li><a href="#create-our-survey-project"><span class="toc-section-number">9.2</span> Create our survey project</a><ul>
<li><a href="#setup"><span class="toc-section-number">9.2.1</span> Setup</a></li>
<li><a href="#libraries"><span class="toc-section-number">9.2.2</span> Libraries</a></li>
<li><a href="#import-the-data"><span class="toc-section-number">9.2.3</span> Import the data</a></li>
</ul></li>
<li><a href="#figuring-out-our-data-shape"><span class="toc-section-number">9.3</span> Figuring out our data shape</a></li>
<li><a href="#charting-the-popularity-of-princess"><span class="toc-section-number">9.4</span> Charting the popularity of princess</a></li>
<li><a href="#create-our-princess-plot"><span class="toc-section-number">9.5</span> Create our princess plot</a><ul>
<li><a href="#labels-and-titles"><span class="toc-section-number">9.5.1</span> Labels and titles</a></li>
</ul></li>
<li><a href="#factors"><span class="toc-section-number">9.6</span> Factors</a></li>
<li><a href="#reorder-princess"><span class="toc-section-number">9.7</span> Reorder princess</a></li>
<li><a href="#factors-recap"><span class="toc-section-number">9.8</span> Factors recap</a></li>
<li><a href="#practice-make-an-ice-cream-chart"><span class="toc-section-number">9.9</span> Practice: Make an ice cream chart</a><ul>
<li><a href="#turn-in-this-project"><span class="toc-section-number">9.9.1</span> Turn in this project</a></li>
</ul></li>
<li><a href="#resources-3"><span class="toc-section-number">9.10</span> Resources</a></li>
</ul></li>
<li><a href="#joins"><span class="toc-section-number">10</span> Joins</a><ul>
<li><a href="#goals-for-this-section-6"><span class="toc-section-number">10.1</span> Goals for this section</a></li>
<li><a href="#project-setup"><span class="toc-section-number">10.2</span> Project setup</a><ul>
<li><a href="#download-the-data"><span class="toc-section-number">10.2.1</span> Download the data</a></li>
</ul></li>
<li><a href="#the-story"><span class="toc-section-number">10.3</span> The story</a></li>
<li><a href="#explore-the-data"><span class="toc-section-number">10.4</span> Explore the data</a><ul>
<li><a href="#third-down-conversions"><span class="toc-section-number">10.4.1</span> Third-down conversions</a></li>
<li><a href="#scoring"><span class="toc-section-number">10.4.2</span> Scoring</a></li>
</ul></li>
<li><a href="#about-joins"><span class="toc-section-number">10.5</span> About joins</a></li>
<li><a href="#build-our-scatterplot"><span class="toc-section-number">10.6</span> Build our scatterplot</a><ul>
<li><a href="#add-a-fit-line"><span class="toc-section-number">10.6.1</span> Add a fit line</a></li>
<li><a href="#run-a-correlation-test"><span class="toc-section-number">10.6.2</span> Run a correlation test</a></li>
</ul></li>
<li><a href="#how-does-texas-compare"><span class="toc-section-number">10.7</span> How does Texas compare?</a></li>
<li><a href="#correlaton-test-for-texas"><span class="toc-section-number">10.8</span> Correlaton test for Texas</a></li>
<li><a href="#practice-1-compare-penn-state"><span class="toc-section-number">10.9</span> Practice 1: Compare Penn State</a></li>
<li><a href="#practice-2-penalties-vs-scoring"><span class="toc-section-number">10.10</span> Practice 2: Penalties vs scoring</a></li>
<li><a href="#using-bind_rows-to-merge-data-sets"><span class="toc-section-number">10.11</span> Using bind_rows() to merge data sets</a><ul>
<li><a href="#combine-data-with-a-group"><span class="toc-section-number">10.11.1</span> Combine data with a group</a></li>
</ul></li>
</ul></li>
<li><a href="#census"><span class="toc-section-number">11</span> Census</a><ul>
<li><a href="#goals-of-this-section"><span class="toc-section-number">11.1</span> Goals of this section</a></li>
<li><a href="#census-bureau-programs-and-platforms"><span class="toc-section-number">11.2</span> Census Bureau programs and platforms</a><ul>
<li><a href="#decennial-census"><span class="toc-section-number">11.2.1</span> Decennial Census</a></li>
<li><a href="#american-community-survey"><span class="toc-section-number">11.2.2</span> American Community Survey</a></li>
<li><a href="#population-estimates-program"><span class="toc-section-number">11.2.3</span> Population Estimates Program</a></li>
</ul></li>
<li><a href="#using-the-new-data-portal"><span class="toc-section-number">11.3</span> Using the new data portal</a><ul>
<li><a href="#tips-about-using-downloaded-portal-data-in-r"><span class="toc-section-number">11.3.1</span> Tips about using downloaded portal data in R</a></li>
<li><a href="#importing-downloaded-data"><span class="toc-section-number">11.3.2</span> Importing downloaded data</a></li>
<li><a href="#fields-made-to-join-with-other-data"><span class="toc-section-number">11.3.3</span> Fields made to join with other data</a></li>
</ul></li>
<li><a href="#using-the-census-api-in-r"><span class="toc-section-number">11.4</span> Using the Census API in R</a><ul>
<li><a href="#setting-up-an-api-key"><span class="toc-section-number">11.4.1</span> Setting up an API key</a></li>
<li><a href="#the-censusapi-package"><span class="toc-section-number">11.4.2</span> The censusapi package</a></li>
<li><a href="#the-tidycensus-package"><span class="toc-section-number">11.4.3</span> The tidycensus package</a></li>
<li><a href="#adding-geometry-to-tidycensus"><span class="toc-section-number">11.4.4</span> Adding geometry to tidycensus</a></li>
<li><a href="#map-shapes-only-with-tigris"><span class="toc-section-number">11.4.5</span> Map shapes only with tigris</a></li>
</ul></li>
<li><a href="#interactive-maps-with-leaflet"><span class="toc-section-number">11.5</span> Interactive maps with leaflet</a></li>
<li><a href="#resources-4"><span class="toc-section-number">11.6</span> Resources</a></li>
</ul></li>
<li><a href="#how-to-tackle-a-new-dataset"><span class="toc-section-number">12</span> How to tackle a new dataset</a><ul>
<li><a href="#start-by-listing-questions"><span class="toc-section-number">12.1</span> Start by listing questions</a></li>
<li><a href="#understand-your-data"><span class="toc-section-number">12.2</span> Understand your data</a></li>
<li><a href="#counting-and-aggregation"><span class="toc-section-number">12.3</span> Counting and aggregation</a><ul>
<li><a href="#counting-rows-based-on-a-column"><span class="toc-section-number">12.3.1</span> Counting rows based on a column</a></li>
<li><a href="#sum-mean-and-other-aggregations"><span class="toc-section-number">12.3.2</span> Sum, mean and other aggregations</a></li>
<li><a href="#creating-columns-to-show-difference"><span class="toc-section-number">12.3.3</span> Creating columns to show difference</a></li>
</ul></li>
<li><a href="#cleaning-up-categorical-data"><span class="toc-section-number">12.4</span> Cleaning up categorical data</a></li>
<li><a href="#time-as-a-variable"><span class="toc-section-number">12.5</span> Time as a variable</a></li>
<li><a href="#explore-the-distributions-in-your-data"><span class="toc-section-number">12.6</span> Explore the distributions in your data</a><ul>
<li><a href="#more-on-histograms"><span class="toc-section-number">12.6.1</span> More on histograms</a></li>
</ul></li>
</ul></li>
<li><a href="#publishing-your-findings"><span class="toc-section-number">13</span> Publishing your findings</a><ul>
<li><a href="#examples"><span class="toc-section-number">13.1</span> Examples</a></li>
<li><a href="#how-to-publish-your-projects"><span class="toc-section-number">13.2</span> How to publish your projects</a><ul>
<li><a href="#using-github-pages"><span class="toc-section-number">13.2.1</span> Using Github Pages</a></li>
</ul></li>
<li><a href="#making-branded-graphics"><span class="toc-section-number">13.3</span> Making branded graphics</a></li>
</ul></li>
<li><a href="#chart-examples"><span class="toc-section-number">14</span> Chart examples</a><ul>
<li><a href="#bar-charts"><span class="toc-section-number">14.1</span> Bar charts</a><ul>
<li><a href="#explanaton"><span class="toc-section-number">14.1.1</span> Explanaton</a></li>
</ul></li>
<li><a href="#column-chart"><span class="toc-section-number">14.2</span> Column chart</a></li>
<li><a href="#a-line-chart"><span class="toc-section-number">14.3</span> A line chart</a><ul>
<li><a href="#explanation"><span class="toc-section-number">14.3.1</span> Explanation</a></li>
</ul></li>
<li><a href="#scatterplot-1"><span class="toc-section-number">14.4</span> Scatterplot</a><ul>
<li><a href="#explanation-1"><span class="toc-section-number">14.4.1</span> Explanation</a></li>
</ul></li>
<li><a href="#histogram"><span class="toc-section-number">14.5</span> Histogram</a></li>
<li><a href="#titles-labels-and-other-cleanup"><span class="toc-section-number">14.6</span> Titles, labels and other cleanup</a><ul>
<li><a href="#title-and-axis-labels"><span class="toc-section-number">14.6.1</span> Title and axis labels</a></li>
<li><a href="#flip-the-graphic"><span class="toc-section-number">14.6.2</span> Flip the graphic</a></li>
<li><a href="#fix-exponential-numbers-on-an-axis"><span class="toc-section-number">14.6.3</span> Fix exponential numbers on an axis</a></li>
</ul></li>
<li><a href="#interactivity-with-plotly"><span class="toc-section-number">14.7</span> Interactivity with plotly</a></li>
<li><a href="#resources-5"><span class="toc-section-number">14.8</span> Resources</a></li>
</ul></li>
<li><a href="#verbs"><span class="toc-section-number">15</span> Verbs</a><ul>
<li><a href="#importexport"><span class="toc-section-number">15.1</span> Import/Export</a></li>
<li><a href="#data-manipulation"><span class="toc-section-number">15.2</span> Data manipulation</a></li>
<li><a href="#aggregation"><span class="toc-section-number">15.3</span> Aggregation</a></li>
<li><a href="#math"><span class="toc-section-number">15.4</span> Math</a></li>
</ul></li>
<li><a href="#notes-about-future-sessions">Notes about future sessions</a><ul>
<li><a href="#maps">Maps</a></li>
<li><a href="#joins-1">Joins</a></li>
<li><a href="#data-packages">Data packages</a><ul>
<li><a href="#twitter">Twitter</a></li>
</ul></li>
<li><a href="#tools-for-pdfs">Tools for PDFs</a></li>
<li><a href="#more-graphics-ideas">More graphics ideas</a></li>
<li><a href="#matt-waite-ideas-yet-to-incorporate">Matt Waite ideas yet to incorporate</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reporting with Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="about-this-class" class="section level1 unnumbered">
<h1>About this class</h1>
<p>Reporting with Data in R is a series of lessons and instructions used in the Spring 2019 course J327D REPORTING WITH DATA in the School of Journalism, Moody College of Communication at the University of Texas at Austin. It was taught by me, Christian McDonald.</p>
<p>There is a <a href="https://github.com/utdata/rwd-r-assignments">companion Github repository</a> of mastery lessons that goes along with this book.</p>
<p>I’m a strong proponent of Scripted Journalism, a method of committing data-centric journalism in a programmatic, repeatable and transparent way. There are a myriad of programming languages that further this, including Python (<a href="https://pandas.pydata.org/">pandas</a> and <a href="https://jupyter.org/">Jupyter</a>) and JavaScript (<a href="https://beta.observablehq.com/">Observable</a>), but we’ll be using <a href="https://www.r-project.org/">R</a>, <a href="https://rmarkdown.rstudio.com/">RMarkdown</a> and <a href="https://www.rstudio.com/">RStudio</a>.</p>
<p>R is a super powerful, open-source programming language for data that is deep with features and an awesome community of users who build upon it. No matter the challenge before you in your data storytelling, there is probably a package available to help you solve that challenge. Probably more than one.</p>
<div id="about-this-book" class="section level2 unnumbered">
<h2>About this book</h2>
<p>There is always more than one way to do things in R. This book is an opinionated collection of lessons intended to teach students new to progamming and R for the expressed act of committing journalism. As a beginner course, I strive to make it as simple as possible, which means I may not go into detail about alternative (and possibly better) ways to accomplish tasks in favor of staying in the Tidyverse and reducing options to simplify understanding.</p>
<p>This book was written for a specific semester of a class that changes every semester. It was my first time to introduce R to beginning students. While the experience went well, there were pros and cons to using R in a beginning data class and I continue to experiment with material. There are learnings from this first attempt that need to be incorporated into this book that have not been, and I’m not sure when I’ll get back to it.</p>
<p>My next running of the course (Summer 2019) will not use R and will instead focus on a series of other tools, including <a href="http://workbenchdata.com/">Workbench</a>, which allows for a similar scripted workflow but without the same level of coding.</p>
</div>
<div id="about-the-author" class="section level2 unnumbered">
<h2>About the author</h2>
<p>I’m a career journalist who most recently served as Data and Projects Editor at the Austin American-Statesman before joining the University of Texas at Austin faculty full-time in Fall 2018. I’ve taught data-related course at UT since 2013.</p>
<ul>
<li>My UT Github: <a href="https://github.com/utdata">utdata</a></li>
<li>My Personal Github: <a href="https://github.com/critmcdonald?tab=repositories">critmcdonald</a></li>
<li>Twitter: <a href="https://twitter.com/crit">crit</a></li>
<li>Email: <a href="mailto:christian.mcdonald@utexas.edu" class="email">christian.mcdonald@utexas.edu</a></li>
</ul>
</div>
<div id="other-resources" class="section level2 unnumbered">
<h2>Other resources</h2>
<p>This text stands upon the shoulders of giants and by design does not cover all aspects of using R. Here are some other useful books, tutorials and sites dedicated to R. There are other task-specific tutorials and articles sprinkled throughout the book in the Resources section of select chapters.</p>
<ul>
<li><a href="https://utdata.github.io/r-journalism-examples/">R Journalism Examples</a>, a companion piece of sorts to this book with example code to accomplish specific tasks. It is a work-in-progress, and quite nascent at that.</li>
<li><a href="https://r4ds.had.co.nz/index.html">R for Data Science</a> by Hadley Wickham and Garrett Grolemund.</li>
<li>The <a href="https://www.tidyverse.org/">Tidyverse</a> site, which has tons of documentation and help.</li>
<li>The <a href="https://www.rstudio.com/resources/cheatsheets/">RStudio Cheatsheets</a>.</li>
<li><a href="https://r-graphics.org/index.html">R Graphics Cookbook</a></li>
<li><a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a> another place to see examples.</li>
<li><a href="http://learn.r-journalism.com/en/">R for Journalists</a> site by Andrew Tran, a reporter at the Washington Post. A series of videos and tutorials on using R in a journalism setting.</li>
<li><a href="https://www.crcpress.com/Practical-R-for-Mass-Communication-and-Journalism/Machlis/p/book/9781138726918">Practical R for Journalism</a> by Sharon Machlis, an editor with PC World and related publications, she is a longtime proponent of using R in journalism.</li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="install" class="section level1">
<h1><span class="header-section-number">1</span> Install Party</h1>
<p>Let’s get this party started.</p>
<blockquote>
<p>NOTE: R and RStudio are already installed on lab computers.</p>
</blockquote>
<div id="installing-r" class="section level2">
<h2><span class="header-section-number">1.1</span> Installing R</h2>
<p>Our first task is to install the <a href="https://www.r-project.org/">R programming language</a> onto your computer. There are a number of “mirrors” which have the software.</p>
<ul>
<li>Go to the <a href="https://cran.r-project.org/mirrors.html">download site</a>.</li>
<li>Go down to USA and choose one of the links there. They should all work the same.</li>
<li>Click on the link for your operating system.</li>
<li>The following steps will differ slightly based on your operating system.
<ul>
<li>For Macs, you want the “latest package”</li>
<li>For Windows, you want the “base” package. You’ll need to decide whether you want the 32- or 64-bit version. (Unless you’ve got a pretty old system, chances are you’ll want 64-bit.)</li>
</ul></li>
</ul>
<p>Here’s hoping it will be self explanatory after that.</p>
</div>
<div id="installing-rstudio" class="section level2">
<h2><span class="header-section-number">1.2</span> Installing RStudio</h2>
<p><a href="https://www.rstudio.com/">RStudio</a> is an “integrated development environment” – or IDE – for programming in R. Basically, it’s the program you will use when doing work for this class.</p>
<ul>
<li>Go to <a href="https://www.rstudio.com" class="uri">https://www.rstudio.com</a> and find the “Download RStudio” button.</li>
<li>Find the “Free” versions and find the installer for your operating system and download it.</li>
<li>Install it. Should be like installing any other program.</li>
</ul>
</div>
<div id="class-project-folder" class="section level2">
<h2><span class="header-section-number">1.3</span> Class project folder</h2>
<p>To keep things consistent and help with troubleshooting, I’d like you to save your work in the same location all the time.</p>
<ul>
<li>On both Mac and Windows, every user has a “Documents” folder. Open that folder. (If you don’t know where it is, ask me to help you find it.)</li>
<li>Create a new folder called “rwd”. Use all lowercase letters.</li>
</ul>
<p>When we create new “Projects”, I want you to always save them in the <code>Documents/rwd</code> folder.</p>
<!--chapter:end:01-install.Rmd-->
</div>
</div>
<div id="intro" class="section level1">
<h1><span class="header-section-number">2</span> Introduction to R</h1>
<div id="rstudio-tour" class="section level2">
<h2><span class="header-section-number">2.1</span> RStudio tour</h2>
<p>When you launch RStudio, you’ll get a screen that looks like this:</p>
<div class="figure">
<img src="images/intro-start.png" alt="Rstudio launch screen" />
<p class="caption">Rstudio launch screen</p>
</div>
</div>
<div id="updating-preferences" class="section level2">
<h2><span class="header-section-number">2.2</span> Updating preferences</h2>
<p>There is a preference in RStudio that I would like you to change. By default, the program wants to save a the state of your work (all the variables and such) when you close a project, but that is not good practice. We’ll change that.</p>
<ul>
<li>Go to the <strong>RStudio</strong> menu and choose <strong>Preferences</strong></li>
<li>Under the <strong>General</strong> tab, uncheck the first four boxes.</li>
<li>On the option “Save Workspace to .Rdata on exit”, change that to <strong>Never</strong>.</li>
<li>Click <em>OK</em> to close the box.</li>
</ul>
</div>
<div id="starting-a-new-project" class="section level2">
<h2><span class="header-section-number">2.3</span> Starting a new Project</h2>
<p>When we work in RStudio, we will create “Projects” to hold all the files related to one another. This sets the “working directory”, which is a sort of home base for the project.</p>
<ul>
<li>Click on the second button that has a green <code>+R</code> sign.</li>
<li>That brings up a box to create the project with several options. You want <strong>New Directory</strong> (unless you already have a Project directory, which you don’t for this.)</li>
<li>For <strong>Project Type</strong>, choose <strong>New Project</strong>.</li>
<li>Next, for the <strong>Directory name</strong>, choose a new name for your project folder. For this project, use “firstname-first-project” but use YOUR firstname.</li>
</ul>
<p>I want you to be anal about naming your folders. It’s a good programming habit.</p>
<ul>
<li>Use lowercase characters.</li>
<li>Don’t use spaces. Use dashes.</li>
<li>For this class, start with your first name.</li>
</ul>
<div class="figure">
<img src="images/intro-newproject.png" alt="Rstudio project name, directory" />
<p class="caption">Rstudio project name, directory</p>
</div>
<p>When you hit <strong>Create Project</strong>, your RStudio window will refresh and you’ll see the <code>yourfirstname-first-project.Rproj</code> file in your Files list.</p>
</div>
<div id="using-r-notebooks" class="section level2">
<h2><span class="header-section-number">2.4</span> Using R Notebooks</h2>
<p>For this class, we will almost always use <a href="https://rmarkdown.rstudio.com/lesson-10.html">R Notebooks</a>. This format allows us to write text in between our blocks of code. The text is written in a language called <a href="https://rmarkdown.rstudio.com/lesson-1.html">R Markdown</a>, a juiced-up version of the common documentation syntax used by programmers, Markdown. It’s not hard to learn. Here’s a <a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">Markdown guide</a>.</p>
<div id="create-your-first-notebook" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Create your first notebook</h3>
<ul>
<li>Click on the button at the top-left of RStudio that has just the green <code>+</code> sign.</li>
<li>Choose the item <strong>R Notebook</strong>.</li>
</ul>
<p>This will open a new file with some boilerplate R Markdown code.</p>
<ul>
<li>At the top between the <code>---</code> marks, is the <strong>metadata</strong>. This is written using YAML, and what is inside are commands for the R Notebook. Don’t sweat the YAML syntax too much right now, as we won’t be editing it often.</li>
<li>Next, you’ll see a couple of paragraphs of text that describes how to use an R Notebooks. It is written in R Markdown, and has some inline links and bold commands, which you will learn,</li>
<li>Then you will see an R code chunk that looks like the figure below.</li>
</ul>
<div class="figure">
<img src="images/intro-rcodechunk.png" alt="R code chunk" />
<p class="caption">R code chunk</p>
</div>
<p>Let’s take a closer look at this:</p>
<ul>
<li>The three back tick characters ( found at the top left on your keyboard) followed by the <code>{r}</code> indicate that this is a chunk of R code. The last three back ticks say the code chunk is over.</li>
<li>The <code>{r}</code> bit can have some parameters added to it. We’ll get into that later.</li>
<li>The line <code>plot(cars)</code> is R programming code. We’ll see what those commands do in a bit.</li>
<li>The green right-arrow to the far right is a play button to run the code that is inside the chunk.</li>
<li>The green down-arrow and bar to the left of that runs all the code in the Notebook up to that point.</li>
</ul>
</div>
<div id="save-the-.rmd-file" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Save the .Rmd file</h3>
<ul>
<li>Do command-s or hit the floppy disk icon to save the file.</li>
<li>It will ask you what you want to name this file. Call it <code>01-first-file.Rmd</code>.</li>
</ul>
<p>When you do this, you may see another new file created in your Files directory. It’s the pretty version of the notebook which we’ll see in a minute.</p>
<p>In the metadata portion of the file, give your notebook a better title.</p>
<ul>
<li>Replace “R Notebook” in the <code>title: &quot;R Notebook&quot;</code> code to be “Christian’s first notebook”, but use your name.</li>
</ul>
</div>
<div id="run-the-notebook" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Run the notebook</h3>
<p>There is only one chunk to run in this notebook, so:</p>
<ul>
<li>Click on the green right-arrow to run the code.</li>
</ul>
<p>You should get something like this:</p>
<div class="figure">
<img src="images/intro-defaultplot.png" alt="Cars plot" />
<p class="caption">Cars plot</p>
</div>
<p>What you’ve done here is create a plot chart of a piece of sample data that is already inside R. (FWIW, It is the speed of cars and the distances taken to stop. Note that the data were recorded in the 1920s.)</p>
<p>But that wasn’t a whole lot of code to see there is a relationship with speed vs stopping distance, eh?</p>
</div>
<div id="adding-new-code-chunks" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Adding new code chunks</h3>
<p>The text after the chart describes how to insert a new code chunk. Let’s do that.</p>
<ul>
<li>Add a return after the paragraph of text about code chunks, but before the next bit about previews.</li>
<li>Use the keys <em>Cmd+Option+I</em> to add the chunk.</li>
<li>Your cursor will be inserted into the middle of the chunk. Type in this code in the space provided:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># update 52 to your age</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">age =<span class="st"> </span><span class="dv">52</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">(age <span class="op">-</span><span class="st"> </span><span class="dv">7</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<ul>
<li>Change for “52” to your real age.</li>
<li>With your cursor somewhere in the code block, use the key command <em>Cmd+Shift+Return</em>, which is the key command to RUN ALL LINES of code chunk.</li>
<li>NOTE: To run an individual line, use <em>Cmd+Return</em> while on that line.</li>
</ul>
<p>Congratulations! The answer given at the bottom of that code chunk is the <a href="https://www.psychologytoday.com/us/blog/meet-catch-and-keep/201405/who-is-too-young-or-too-old-you-date">socially-acceptable maximum age of anyone you should date</a>.</p>
<p>Throwing aside whether the formula is sound, let’s break down the code.</p>
<ul>
<li><code># update 52 to your age</code> is a comment. It’s a way to explain what is happening in the code without being considered part of the code.</li>
<li><code>age = 52</code> is assigning a number (<code>52</code>) to a variable name (<code>age</code>). A variable is a placeholder. It can hold numbers, text or even groups of numbers. They are key to programming because they allow you to change the value of the variable as you go along.</li>
<li>The next part is simple math: <code>(age - 7) * 2</code> takes the value of <code>age</code> and subtracts <code>7</code>, then multiplies by <code>2</code>.</li>
<li>When you run it, you get <code>[1] 90</code>. That means there was one observation, and the value was “90”. For the record, my wife is <em>much</em> younger than that.</li>
</ul>
<p>Now you can play with the age variable assignment to test out different ages.</p>
</div>
<div id="practice-adding-code-chunks" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Practice adding code chunks</h3>
<p>Now, on your own, add a similar code chunk that calculates the minimum age of someone you should date, but using the formula <code>(age / 2) + 7</code>. Add a comment in the code that explains what it is for.</p>
</div>
<div id="preview-the-report" class="section level3">
<h3><span class="header-section-number">2.4.6</span> Preview the report</h3>
<p>The rest of the boilerplate text here describes how you can <em>Preview</em> and <em>Knit</em> a notebook. Let’s do that now.</p>
<ul>
<li>Press <em>Cmd+Shift+K</em> to open a Preview.</li>
</ul>
<p>This will open a new window and show you the “pretty” notebook that we are building.</p>
<p>Preview is a little different than <em>Knit</em>, which runs all the code, then creates the new knitted HTML document. It’s <strong>Knit to HMTL</strong> that you’ll want to do before turning in your assignments.</p>
</div>
<div id="the-toolbar" class="section level3">
<h3><span class="header-section-number">2.4.7</span> The toolbar</h3>
<p>One last thing to point out before we turn this in: The toolbar that runs across the top of the R Notebook file window. The image below explains some of the more useful tools, but you <em>REALLY</em> should learn and use keyboard commands when they are available.</p>
<div class="figure">
<img src="images/intro-toolbar.png" alt="R Notebook toolbar" />
<p class="caption">R Notebook toolbar</p>
</div>
</div>
<div id="knit-the-final-workbook" class="section level3">
<h3><span class="header-section-number">2.4.8</span> Knit the final workbook</h3>
<ul>
<li>Save your File with <em>Cmd+S</em>.</li>
<li>Use the <strong>Knit</strong> button in the toolbar to choose <strong>Knit to HTML</strong>.</li>
</ul>
</div>
</div>
<div id="turning-in-our-projects" class="section level2">
<h2><span class="header-section-number">2.5</span> Turning in our projects</h2>
<p>If you now look in your Files pane, you’ll see you have four files in our project. (Note the only one you actually edited was the <code>.Rmd</code> file.)</p>
<div class="figure">
<img src="images/intro-files.png" alt="Files list" />
<p class="caption">Files list</p>
</div>
<p>The best way to turn in all of those files into Canvas is to compress them into a single <code>.zip</code> file that you can upload to the assignment.</p>
<ul>
<li>In your computer’s Finder, open the <code>Documents/rwd</code> folder.</li>
<li>Follow the directions for your operating system linked below to create a compressed version of your <code>yourname-final-project</code> folder.</li>
<li><a href="http://www.macinstruct.com/node/159">Compress files on a Mac</a>.</li>
<li><a href="https://www.laptopmag.com/articles/how-to-zip-files-windows-10">Compress flies on Windows</a>.</li>
<li>Upload the resulting <code>.zip</code> file to the assignment for this week in Canvas.</li>
</ul>
<p>Here is what the compression steps looks like on a Mac:</p>
<div class="figure">
<img src="images/intro-compress.gif" alt="Compress file: Mac" />
<p class="caption">Compress file: Mac</p>
</div>
<p>If you find you make changes to your R files after you’ve zipped your folder, you’ll need to delete the <code>zip</code> file and do it again.</p>
<p>Because we are building “repeatable” code, I’ll be able to download your <code>.zip</code> files, uncompress them, and the re-run them to get the same results.</p>
<p>Well done! You’ve completed the first level and earned the <em>Beginner</em> badge.</p>
<!--chapter:end:02-intro.Rmd-->
</div>
</div>
<div id="import" class="section level1">
<h1><span class="header-section-number">3</span> Importing data</h1>
<div id="goals-for-this-section" class="section level2">
<h2><span class="header-section-number">3.1</span> Goals for this section</h2>
<ul>
<li>Learn a little about data types available to R.</li>
<li>Practice organized project setup.</li>
<li>Learn about R packages, how to install and import them.</li>
<li>Learn how to import CSV files.</li>
<li>Introduce the Data Frame/Tibble.</li>
</ul>
<p>We will do this through working with well drilling reports from the Texas Water Development board. We’ll pull reports from counties in the Austin MSA and be able to see the kinds of wells dug, where they are and the pace of drilling.</p>
</div>
<div id="data-types" class="section level2">
<h2><span class="header-section-number">3.2</span> Data types</h2>
<p>After installing and launching RStudio, the next trick is to import data. Depending on the data source, this can be brilliantly easy or a pain in the rear. It all depends on how well-formatted is the data.</p>
<p>In this class, we will primarily be importing Excel files, CSVs (Comma Separated Value) and APIs (Application Programming Interface).</p>
<ul>
<li>CSVs are a kind of lowest-common-denominator for data. Most any database or program can import or export them.</li>
<li>Excel files are good, but are often messy because humans get involved. There are often multiple header rows, columns used in multiple ways, notes added, etc. Just know you might have to clean them up before using them.</li>
<li>APIs are systems designed to respond to programming. In the data world, we often use the APIs by writing a query to ask a system to return a selection of data. By definition, the data is well structured. You can often determine the file type of the output as part of the API call, including …</li>
<li>JSON (or JavaScript Object Notation) is the data format preferred by JavaScript. R can read it, too. It is often the output format of APIs, and prevalent enough that you need to understand how it works. We’ll get into it more later.</li>
</ul>
<p>Don’t get me wrong … there are plenty of other data types and connections available through R, but those are the ones we’ll deal with most in the class.</p>
<div id="what-is-clean-data" class="section level3">
<h3><span class="header-section-number">3.2.1</span> What is clean data</h3>
<p>The Checking Your Data section of this <a href="https://www.datacamp.com/community/tutorials/r-data-import-tutorial">DataCamp tutorial</a> has a good outline of what makes good data, but in general it should:</p>
<ul>
<li>Have a single header row with well-formed column names.
<ul>
<li>Once column name for each column. No merged cells.</li>
<li>Short names are better than long ones.</li>
<li>Spaces in names make them harder to work with. Use and <code>_</code> or <code>.</code> between words.</li>
</ul></li>
<li>Remove notes or comments from the files.</li>
<li>Each column should have the same kind of data: numbers vs words, etc.</li>
<li>Each row should be an</li>
</ul>
<p>In our first lesson, we’ll be using a CSV file that has several rows of description at the top. We’ll be able to skip those description lines when we import.</p>
</div>
</div>
<div id="create-a-new-project" class="section level2">
<h2><span class="header-section-number">3.3</span> Create a new project</h2>
<p>We did this in our first lesson, but here are the basic steps:</p>
<ul>
<li>Launch RStudio</li>
<li>Use the <code>+R</code> button to create a <strong>New Project</strong> in a <strong>New Directory</strong></li>
<li>Name the project <code>yourfirstname-wells</code> and put it in your <code>~/Documents/rwd</code> folder.</li>
<li>Use the <code>+</code> button to use <strong>R Notebook</strong> to start a new notebook.</li>
<li>Change the title to “Wells drilled in Austin MSA”.</li>
<li>Delete the other boilerplate text.</li>
<li>Save the file as <code>01-wells-import.Rmd</code>.</li>
</ul>
<div id="the-r-package-environment" class="section level3">
<h3><span class="header-section-number">3.3.1</span> The R Package environment</h3>
<p>We have to back up from the step-by-step nature of this lesson and talk a little about the R programming language.</p>
<p>R is an open-source language, which means that other programmers can contribute to how it works. It is what makes R beautiful.</p>
<p>What happens is developers will find it difficult to do a certain task, so they will write an R “Package” of code that helps them with that task. They share that code with the community, and suddenly the R garage has an <a href="https://youtu.be/Y1En6FKd5Pk?t=24">“ultimate set of tools”</a> that would make Spicoli’s dad proud.</p>
<p>One set of these tools is Hadley Wickham’s <a href="https://www.tidyverse.org/">Tidyverse</a>, a set of packages for data science. These are the tools we will use most in this course. While not required reading, I highly recommend Wickham’s book <a href="https://r4ds.had.co.nz/index.html">R for data science</a>, which is free. We’ll use some of Wickham’s lectures in the course.</p>
<p>There are also a series of useful <a href="https://www.rstudio.com/resources/cheatsheets/">cheatsheets</a> that can help you as you use the packages and functions from the tidyverse. We’ll refer to these throughout the course.</p>
</div>
<div id="installing-and-using-packages" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Installing and using packages</h3>
<p>There are two steps to using an R package:</p>
<ul>
<li><strong>Install the package</strong> using <code>install.packages(&quot;package_name&quot;)</code>. You only have to do this once for each computer, so I usually do it using the R Console instead of a script.</li>
<li><strong>Include the library</strong> using <code>library(package_name)</code>. This has to be done for each Notebook or script that uses it, so it is usually one of the first things in the notebook.</li>
</ul>
<p>We’re going to install several packages we will use in the Wells project. To do this, we are going to use the <strong>Console</strong>, which we haven’t talked about much.</p>
<div class="figure">
<img src="images/import-console.png" alt="The Console and Terminal" width="600" />
<p class="caption">The Console and Terminal</p>
</div>
<ul>
<li>Use the image above to orient yourself to the R Console and Terminal.</li>
<li>In the console, type in <code>install.packages(&quot;tidyverse&quot;)</code> and hit return.</li>
</ul>
<p>You’ll see a bunch of commands work through your Console. Remember that you only have to install a package to your computer once.</p>
<p>We’ll need another package, so also do:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;janitor&quot;</span>)</a></code></pre></div>
<p>We’ll use some commands from janitor to clean up our data column names, among other things. A good reference to learn more is the <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html">janitor vignette</a>.</p>
<p>I start <em>every</em> data project with these two packages.</p>
</div>
<div id="load-the-libraries" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Load the libraries</h3>
<p>Next, we’re going to tell our R Notebook to use these two libraries.</p>
<ul>
<li>After the metadata at the top of your notebook, use <em>Cmd+option+i</em> to insert an R code chunk.</li>
<li>In that chunk, type in the two libraries and run the code block with <em>Cmd+shift+Return</em>.</li>
</ul>
<p>It will look like this:</p>
<div class="figure">
<img src="images/import-libraries.png" alt="Libraries imported" width="600" />
<p class="caption">Libraries imported</p>
</div>
</div>
</div>
<div id="lets-get-some-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Let’s get some data</h2>
<p>I could’ve supplied you with the raw data, but it is not hard to find and grab yourself, so let’s do that.</p>
<p>Because I want you to teach you good data project skills, I want you first to make a folder to store your raw data. It’s good practice to separate your raw data from any other output or data. It will make it easy for others to find, and can help you avoid overwriting that raw data, which should remain a pristine copy.</p>
<ul>
<li>In the <strong>Files</strong> pane, use the <strong>New Folder</strong> button to create a folder called <code>data-raw</code>. (I typically make a <code>data-out</code> or similar folder for any files that I create.)</li>
<li>In a web browser, go to the <a href="http://www.twdb.texas.gov/groundwater/data/drillersdb.asp">Texas Water Development Board Driller Reports</a> page and then click on the <strong>Well Reports Search by County and Use</strong> link.</li>
<li>In the <strong>County</strong> drop down, choose: Bastrop, Caldwell, Hays, Travis and Williamson counties.</li>
<li>In the <strong>Proposed Use</strong> column, choose <strong>Select All</strong>.</li>
<li>Click <strong>View Reports</strong>. You’ll get 400+ returns.</li>
<li>Look for the floppy disk/arrow icon that is the download button. Choose <strong>CSV (comma delimited)</strong>.</li>
</ul>
<p>That file should end up in your Downloads folder. Use your finder to move this into your project folder in the <code>data-raw</code> folder you created.</p>
<p><a href="http://www.twdb.texas.gov/groundwater/data/doc/TWRSRS_UserManual.pdf?d=43539.49999999895">This document</a> has some descriptions of fields we may need later.</p>
<div id="inspect-the-data" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Inspect the data</h3>
<p>We want to look at the data so we understand it.</p>
<ul>
<li>In the <strong>Files</strong> pane, click on the <code>data-raw</code> folder to open in.</li>
<li>Click on the <code>WellsRpts_County_Use.csv</code> file until you get the drop down that says View Files.</li>
</ul>
<div class="figure">
<img src="images/import-inspectdata.png" alt="View file" />
<p class="caption">View file</p>
</div>
<ul>
<li>When you choose that, you’ll get a warning that it is a big file. It <em>should</em> open it just fine, into a new window. It will look like this:</li>
</ul>
<div class="figure">
<img src="images/import-wellsfile.png" alt="Wells file" />
<p class="caption">Wells file</p>
</div>
<p>The numbers on the left are row numbers in the file. Because lines will wrap in your window, those numbers let you know where each line starts.</p>
<p>Note that the real header for this file starts as line <code>5</code>, which means when we import this file, we need to skip the first four lines.</p>
<p>You can close this file now.</p>
</div>
</div>
<div id="import-csv-as-data" class="section level2">
<h2><span class="header-section-number">3.5</span> Import csv as data</h2>
<ul>
<li>Now we need to start adding some text to indicate what we are doing, which right now we are importing the file. So, write some text in Markdown that describes where the data came from and what it is.
<ul>
<li>Write where the data came from. Include the link to the web page.</li>
<li>Include which counties were included, and which</li>
</ul></li>
<li>After your descriptions, add a new code chunk (<em>Cmd+option+i</em>).</li>
<li>Inside the chunk, add the following and hit return, then I’ll explain:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/WellRpts_County_Use.csv&quot;</span>)</a></code></pre></div>
<ul>
<li><code>read_csv()</code> is the function we are using the load the data. This version from the <strong>readr</strong> package in the tidyverse is different from <code>read.csv</code> that comes with R. It is mo betta.</li>
<li>Inside the parenthesis is the path to our data, inside quotes. If you start typing in that path and hit tab, it will complete the path. (Easier to show than explain).</li>
</ul>
<p>This prints two things to our notebook, which are shown as tabs.</p>
<p>The first resultc called “R Console” shows what columns were imported and the data types. It’s important to review these to make sure things happened the way that you want. When I look at this, I’m struck that the column names all start with “Textbox”, which wasn’t what I expected when I was looking at the data on the website. (FWIW, the fact the text is in <strong>red</strong> is NOT an indication of a problem.)</p>
<div class="figure">
<img src="images/import-show-cols.png" alt="Show cols" />
<p class="caption">Show cols</p>
</div>
<p>The second result prints out the data like a table. The data object is called a <a href="https://tibble.tidyverse.org/">Tibble</a>, which is a fancy version of a data frame that is part of the tidyverse.</p>
<blockquote>
<p>I will often call a tibble a “data frame”, which is the generic R from of this data structure. Think of data frames and tibbles like a well-structured table in a spreadsheet. They are organized rows of data with columns where every item in the column is of the same data type.</p>
</blockquote>
<div class="figure">
<img src="images/import-show-data.png" alt="Show imported data" />
<p class="caption">Show imported data</p>
</div>
<p>What went wrong? Remember that our data doesn’t really start until line five. We need to modify our import to skip the first for lines. But how does we find out how to do that? Help is on the way!!</p>
<div id="help-files" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Help files</h3>
<p>Another tab over by your <strong>Files</strong> pane is the <strong>Help</strong> pane.</p>
<ul>
<li>Click on the <strong>Help</strong> pane</li>
<li>In the search box, type in <code>read_csv</code> and hit Return.</li>
</ul>
<p>What you get in return is information about that function. Any function loaded into RStudio also comes with these help files. The documentation style might look foreign at first, but you’ll get used to reading them.</p>
<p>If we look through this one, we can see there is a <code>skip = x</code> option we can add to our import to skip lines.</p>
<ul>
<li>Modify the import line to this and then rerun the entire chunk with <em>Cmd+shift+Return</em>:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/WellRpts_County_Use.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>I first tried <code>skip = 4</code>, but then it didn’t properly use the header row, I <em>think</em> because the readr package skips empty rows by default.</p>
</div>
</div>
<div id="assign-our-data-to-a-data-frame" class="section level2">
<h2><span class="header-section-number">3.6</span> Assign our data to a data frame</h2>
<p>As of right now, we’ve only printed the data to our screen. We haven’t “saved” it at all. What we need to do next is “assign” it to a data frame.</p>
<p>It’s kind of weird, but the convention in R is to work from right to left. We <em>name</em> things before we fill them with stuff. So, to create a data frame, the structure is this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">new_data_frame &lt;-<span class="st"> </span>stuff_going_into_new_data_frame</a></code></pre></div>
<p>We have our stuff as the output of our <code>read_csv()</code> function … now we need to assign it to a data frame we will call <code>wells</code>.</p>
<ul>
<li>Edit your existing code chunk to look like this:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">wells &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/WellRpts_County_Use.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>Run that chunk and two things happen:</p>
<ul>
<li>We no longer see the result printed to the screen. That’s because we created a data frame instead.</li>
<li>In the <strong>Environment</strong> tab at the top-right of RStudio, you’ll see <code>wells</code> listed.
<ul>
<li>Click on the blue play button next to wells and it will expand to show you a summary of the columns.</li>
<li>Click on the name and it will open a “View” of the data in another window, so you can look at it, sort of like a spreadsheet.</li>
</ul></li>
</ul>
</div>
<div id="inspect-the-data-1" class="section level2">
<h2><span class="header-section-number">3.7</span> Inspect the data</h2>
<p>Now that you are looking at the data, take a look at both the data types in the Environment tab, along with the View of the data. Take special care to look at the data types and examples to see if they make sense to you. Some things to consider:</p>
<ul>
<li>Are numbers actually numbers or characters?</li>
<li>Are there numbers that should be strings, like ZIP codes?</li>
<li>Have integers been imported as double numbers or vice versa?</li>
<li>Are dates imported properly?</li>
</ul>
<div id="write-notes-about-things-to-change" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Write notes about things to change</h3>
<ul>
<li>In text below the table output, I want you to write out a list of all the things you might have to fix in this data frame.</li>
</ul>
<p>We’ll fix them in the next lesson, as well as start looking more closely at the data.</p>
</div>
</div>
<div id="turn-in-your-project" class="section level2">
<h2><span class="header-section-number">3.8</span> Turn in your project</h2>
<p>Congratulations! You have created a new project in R and imported data. That is a feat of skill worth celebrating, so we will turn in this in as an assignment.</p>
<ul>
<li>Save your <code>.Rmd</code> file.</li>
<li>Use the <strong>Preview/Knit</strong> button to Knit your report to HTML. Look your report over and make sure you like it.</li>
<li>If you need to, edit your <code>.Rmd</code> file, save, reKnit.</li>
<li>When you are ready, go under the <strong>File</strong> menu to <strong>Close project</strong>.</li>
<li>Go into your computer’s finder and locate your <code>firstnanme-wells</code> project.</li>
<li>Create a <code>.zip</code> file of the folder.</li>
<li>Upload it to the proper assignment in Canvas.</li>
</ul>
</div>
<div id="practice-assignment-import-census" class="section level2">
<h2><span class="header-section-number">3.9</span> Practice assignment: Import census</h2>
<p>To practice these skills on your own, you’ll create a new project and use new data. You’ll work on it through multiple lessons, applying what you’ve learned along the way.</p>
<ul>
<li>Create a new Project called “firstname-census-practice”. You’ll want to save that inside your “rwd” folder so you can use it later. We’ll keep building on it.</li>
<li>Create a new folder in your project called “data-raw”.</li>
<li>Download this CSV file and put it into your data-raw folder: <a href="https://drive.google.com/file/d/1L51qQbdW3dHXTdlvlHx3z5p8Py5Cgv2a/view">DEC_10_SF1_TX_County_population.csv</a>. The data is 2010 Census populations by county and race for Texas.</li>
<li>Start a new R Notebook with a good title and filename.</li>
<li>Write text to describe the data set.</li>
<li>Import the data using <code>read_csv()</code> and print the data to the screen.</li>
<li>Compare the imported data to the original csv file and note any problems you might see with the column names or data types that you might want to fix.</li>
<li>Save, Knit, and Zip the project folder and upload to the “Practice: Import” assignment.</li>
</ul>
</div>
<div id="resources" class="section level2">
<h2><span class="header-section-number">3.10</span> Resources</h2>
<ul>
<li>This <a href="https://www.datacamp.com/community/tutorials/r-data-import-tutorial">DataCamp tutorial on imports</a> covers a ton of different data types and connections.</li>
</ul>
<!--chapter:end:03-import.Rmd-->
</div>
</div>
<div id="columns" class="section level1">
<h1><span class="header-section-number">4</span> Columns</h1>
<p>I’m a bit anal about cleaning up column names in my data frames, because it makes them easier to work with later. As such, I’m going to show you three different ways to clean or edit column names.</p>
<div id="goals-for-this-section-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Goals for this section</h2>
<ul>
<li>Use the janitor plugin to clean columns names</li>
<li>Mass rename columns with a pattern match</li>
<li>Rename individual columns</li>
<li>Fix data columns and other data types</li>
</ul>
</div>
<div id="relaunch-the-wells-project" class="section level2">
<h2><span class="header-section-number">4.2</span> Relaunch the Wells project</h2>
<ul>
<li>Launch RStudio. It will probably open to the last project you worked on.</li>
<li>Open your Wells project. There are several ways you can accomplish this:
<ul>
<li>If you’ve had the project open before, you can use the drop down in the top-right of RStudio to see a list of recent projects, and choose it from there.</li>
<li>Or, under the <strong>File</strong> menu to <strong>Recent projects</strong> and choose it.</li>
<li>Or, under <strong>File</strong> you can use <strong>Open Project…</strong> and go to that folder and choose it.</li>
</ul></li>
<li>Look in the Files pane to the right and fine your <code>01-wells-import.Rmd</code> file and open it.</li>
<li>Use the <strong>Run</strong> button in the R Notebook toolbar to <strong>Run All</strong> of the chunks, which will load all your data and load the data frame from our last assignment.</li>
</ul>
<p>However you do it, make real sure you are in your wells project and that you are in your <code>01-wells-import.Rmd</code> file.</p>
</div>
<div id="clean-up-column-names" class="section level2">
<h2><span class="header-section-number">4.3</span> Clean up column names</h2>
<p>At the end of our last lesson, we printed the <code>wells</code> data frame to the screen and clicked through the columns to look at the data. I like my column names to be standardized:</p>
<ul>
<li>Spaces in names make them harder to work with. Use and <code>_</code> or <code>.</code> between words.</li>
<li>Short names are better than long ones.</li>
<li>lower_case is nice.</li>
</ul>
<div id="clean-names-with-janitor" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Clean names with janitor</h3>
<p>I use function from the “janitor” package called <code>clean_names</code> that will standardize column names. Often, this is all I need to do.</p>
<ul>
<li>After your list of things to fix, write a Markdown headline <code>## Clean column names</code>. Using the <code>##</code> makes this a smaller headline than the title. (The more <code>#</code>’s the smaller the headline.) The idea is to use these to organize your code and thoughts.</li>
<li>Explain in text that we’ll use janitor to clean the column names.</li>
<li>Insert a new code chunk (<em>Cmd+shift+i</em> should be second nature by now.)</li>
<li>Insert the name of your <code>wells</code> data frame and run it to inspect the column names again.</li>
</ul>
<p>These are not <em>too</em> bad, but they are a mix of upper and lowercase names, and some of them are rather long. We’ll try the janitor <code>clean_names</code> function first.</p>
<ul>
<li>In a new code chunk, start with the <code>wells</code> data frame.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw">clean_names</span>()</a></code></pre></div>
<p>And you’ll get a result like this:</p>
<div class="figure">
<img src="images/columns-janitor.png" alt="Columns cleaned with janitor" />
<p class="caption">Columns cleaned with janitor</p>
</div>
<div id="about-the-pipe" class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> About the pipe</h4>
<p>Let’s take take a moment to talk about this <code>%&gt;%</code> text you see there. (It’s called a <strong>pipe</strong> for dumb reasons I don’t want to get into). Think of it as the “And THEN do THIS” key. It takes the result of what is on the left, and allows you to then THEN do the thing on the right.</p>
<p>We will use the <code>%&gt;%</code> pipe command <em>a lot</em>, so it is worth knowing that the keyboard command <em>Cmd+shift+m</em> will give you that string of characters. I did NOT invent this keyboard command, but you might remember that Professor <strong>M</strong>cDonald taught it to you. It will serve you well.</p>
<p>Remember: Think of the <code>%&gt;%</code> command as “Then”. So, we first have the <code>wells</code> data frame, THEN we are cleaning the names.</p>
</div>
<div id="assign-clean-names-back-to-wells" class="section level4">
<h4><span class="header-section-number">4.3.1.2</span> Assign clean names back to wells</h4>
<p>Now, we haven’t <em>actually</em> changed the names <em>for realz</em>, we just printed the data frame to our screen with those new names. We have to <strong>assign</strong> those changes somewhere to keep them. We could create a new data frame, but in this case, we’ll just replace our current <code>wells</code> with our new <code>wells</code>, similar to how we filled wells the first time with our raw data.</p>
<p>Like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">wells &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">clean_names</span>()</a></code></pre></div>
<p>The result no longer prints to our screen, but we can look at our <strong>Environment</strong> tab and check on our results, if we want.</p>
<p>This is a start, but we still have some problems:</p>
<ul>
<li>We have some long names, like “well_report_tracking_number2”.</li>
<li>We have an annoying trailing “2” at the end of all the column names.</li>
</ul>
</div>
</div>
<div id="simple-renaming-of-individual-columns" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Simple renaming of individual columns</h3>
<p>Renaming individual columns is pretty simple, and is another example of the “piping” concept of <code>data %&gt;% do_something()</code>. In this case, we’ll be useing the <code>rename()</code> function, which works like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">rename</span>(<span class="dt">new_column_name =</span> old_column_name)<span class="st">`</span></a></code></pre></div>
<p>The <code>=</code> assignment works from-right-to-left, just of like <code>&lt;-</code> does when we put data into a data frame.</p>
<p>So, let’s apply this to our wells data frame:</p>
<ul>
<li>Add Markdown text that says we are going to rename two columns: well_report_tracking_number2 and plugging_report_tracking_number2.</li>
<li>Add a new code chunk and print the <code>wells</code> data frame.</li>
<li>Now go back and add a <code>%&gt;%</code>pipe and the rename function, like the following:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">well_number =</span> well_report_tracking_number2)</a></code></pre></div>
<p>Do <em>Cmd+Return</em> to run that line, and you’ll see the first column name has changed. Note that is still ONE line of code, even though it is written in multiple lines.</p>
<p>We can rename more than one column at at time if we separate the assignments with commas. Now, let’s edit this to also change the <code>plugging_report_tracking_number2</code> column, which is the last column of the data.</p>
<ul>
<li>In the same code chunk, add a comma and a return <em>before</em> the ending <code>)</code>.</li>
<li>add the new column mapping, like this:</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">well_number =</span> well_report_tracking_number,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">         <span class="dt">plug_number =</span> plugging_report_tracking_number)</a></code></pre></div>
<p>Note the indents in the code there. RStudio probably indented it properly for you, but it’s done that way so you can visually see that these two lines are are related.</p>
<p>We could do all the column names that way to remove the “2”, but I want to show you a different way below to change them all at once.</p>
<div id="assign-renamed-columns-back-to-wells" class="section level4">
<h4><span class="header-section-number">4.3.2.1</span> Assign renamed columns back to wells</h4>
<p>Now, again, we have printed these column name chages to our screen, but we have not yet saved them back to the wells data frame. We need to assign it back to <code>wells</code>.</p>
<ul>
<li>Add <code>wells &lt;-</code> to the beginning of the code chunk so what had printed to the screen is now instead being pushed into the wells data frame.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">wells &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">well_number =</span> well_report_tracking_number2,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">         <span class="dt">plug_number =</span> plugging_report_tracking_number2)</a></code></pre></div>
<blockquote>
<p>NOTE: An important concept: Now that you have permanently changed the <code>wells</code> data frame, you can’t run that same code chunk again or it will give you an error. Why? because “well_report_tracking_number2” doesn’t exist anymore, so R can’t find it to change it! If you need to re-run that chunk, you need to first re-run all the code above it, either by using the down-arrow play button on the chunk or going up to the Run menu and chosing “Run All Chunks Above”.</p>
</blockquote>
</div>
</div>
<div id="mass-renaming-of-columns" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Mass renaming of columns</h3>
<p>While we could individually rename all the columns to remove the trailing “2” on all the names, there is a way to do it all at once. It’s the last way we’ll discuss how to change column names, as I’ve already broken my rule of showing you only one way to do something. This is worth it because it saves time and introduces a couple of useful concepts.</p>
<p>We can access all the column names of a data frame with a generic R function called <a href="https://www.rdocumentation.org/packages/base/versions/3.5.2/topics/names">names()</a>, and we can use a pattern matching replacement called <code>str_replace()</code> to change them.</p>
<ul>
<li>Write in text that we are going to change the names of all the columns to remove the “2”.</li>
<li>Create a new code block and insert this:</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">names</span>(wells)</a></code></pre></div>
<p>Run that, and you get a return like this, which is a list of all the column names of your data frame.</p>
<pre class="text"><code> [1] &quot;well_number&quot;          &quot;type_of_work2&quot;        &quot;proposed_use2&quot;        &quot;owner_name2&quot;         
 [5] &quot;county2&quot;              &quot;well_address2&quot;        &quot;coord_dd_lat2&quot;        &quot;coord_dd_long2&quot;      
 [9] &quot;grid_number2&quot;         &quot;drilling_start_date2&quot; &quot;drilling_end_date2&quot;   &quot;borehole_depth2&quot;     
[13] &quot;driller_signed2&quot;      &quot;driller_company&quot;      &quot;license_number2&quot;      &quot;plug_number&quot;   </code></pre>
<p>Cool, we can now use the <code>%&gt;%</code> pipe to “THEN” perform actions on those names, just like we did on the data frame above. The next function we’ll use to do that is <code>str_replace()</code> which allows us to search and replace strings. It works like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="st">`</span><span class="dt">str_replace(data, &quot;search_pattern&quot;, &quot;replacement_text&quot;)</span><span class="st">`</span></a></code></pre></div>
<p>In our case, the “data” will be passed into it with the pipe. We want to replace “2” with nothing, so we’ll do this:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">names</span>(wells) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Let’s break that down again:</p>
<ul>
<li>We start with <code>names(wells)</code> which gives us a list of our column “names”.</li>
<li>We use the <code>%&gt;%</code> to THEN apply a new function called <code>str_replace()</code>, which allows use to replace strings of text.</li>
<li>Our data has been passed in by the pipe, so our our next argument is to search for the character <code>&quot;2&quot;</code> in all the names.</li>
<li>And we replace those 2s with and empty string <code>&quot;&quot;</code>, which essentially deletes them.</li>
</ul>
<div id="assign-the-replaced-column-names-back-into-nameswells" class="section level4">
<h4><span class="header-section-number">4.3.3.1</span> Assign the replaced column names back into names(wells)</h4>
<p>Like our other examples, we have to now save our changes, but this one is a little different. Since we are only working with the names of the data with <code>names(wells)</code>, we need to assign the back the same way, into <code>names(wells)</code>.</p>
<ul>
<li>Add <code>names(wells) &lt;-</code> to the first line of the code chunk so we assign the names back.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">names</span>(wells) &lt;-<span class="st"> </span><span class="kw">names</span>(wells) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;2&quot;</span>,<span class="st">&quot;&quot;</span>)</a></code></pre></div>
</div>
</div>
</div>
<div id="clean-data-within-columns" class="section level2">
<h2><span class="header-section-number">4.4</span> Clean data within columns</h2>
<p>Now that we’ve cleaned up our column names, our next task is to clean up some of the data itself.</p>
<div id="using-lubridate-to-clean-dates" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Using lubridate to clean dates</h3>
<p>Fixing dates in generic R can be a semi-complicated process. Luckily, the tidyverse package <a href="https://lubridate.tidyverse.org/">lubridate</a> makes date conversions simple. The package was included when we installed the tidyverse package, but we need to add the library.</p>
<ul>
<li>Go back to the top of your R Notebook where the libraries are loaded, and add this line <strong>and run it</strong>: <code>library(lubridate)</code>.</li>
<li>Return back to the bottom of the Notebook and add in Markdown a headline and text describing that you will use lubridate to convert the date fields.</li>
<li>Insert a new code chunk and add and run this, then I’ll explain it:</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">wells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">drilling_start_date =</span> <span class="kw">mdy</span>(drilling_start_date))</a></code></pre></div>
<p>Go head and click over to the <code>drilling_start_date</code> column so you can see the converted date.</p>
<ul>
<li>We started with the <code>wells</code>.</li>
<li>We then piped the results into <code>mutate()</code>, which “mutates” data within columns. Mutate is not just for dates and we will use it to change and create all kinds of changes in the future.</li>
<li>The first argument of <code>mutate</code> is the name of the new column. In this case, we are changing the <em>existing</em> column, so we are using <code>drilling_start_date</code>.</li>
<li><code>=</code> is the assignment operators. What is on the right will be put into the left.</li>
<li><code>mdy(drilling_start_date)</code> is the lubridate function. We are telling lubridate that the format of the <em>existing</em> text field is in Month/Day/Year format. Lubridate is smart enough to realize the <code>/</code> separates the dates, and it would also understand if the separators were <code>-</code> or <code>.</code>.</li>
</ul>
<p>That’s kind of weird. We are telling lubridate that we are starting with <code>mdy</code> so it will convert and show it back to us in <code>yyyy-mm-dd</code>, which is standard database data format.</p>
<div id="your-turn" class="section level4">
<h4><span class="header-section-number">4.4.1.1</span> Your turn</h4>
<p>It’s time for you to use some of the skills you’ve learned already to accomplish a couple of easy tasks:</p>
<ul>
<li>Update the <code>mutate()</code> function above to also update <code>drilling_end_date</code> field to a date. Hint: <code>mutate</code> is a tidyverse function just like <code>rename</code>, so it works similarly.</li>
<li>Assign the changes you’ve made back to the <code>wells</code> data frame and then reprint it to make sure it’s all good.</li>
</ul>
</div>
</div>
<div id="fix-the-bore-hole-depth" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Fix the bore hole depth</h3>
<p>If you look at the CSV data, the <code>borehole_depth</code> is and integer (a number without a decimal point), but it was imported as a <code>&lt;dbl&gt;</code> number with decimals. This <em>could</em> cause us problems later if we wanted to math on these, so we’ll convert this to an integer using <code>mutate()</code>.</p>
<ul>
<li>Add a Markdown headline and description to describe our actions.</li>
<li>Add a code chunk and add the following and run it:</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">borehole_depth =</span> <span class="kw">as.integer</span>(borehole_depth))</a></code></pre></div>
<p>This will reassign that column as an integer. How did I know to use <code>as.integer</code>? I Googled “r convert float to integer” and found <a href="http://www.r-tutor.com/r-introduction/basic-data-types/integer">this tutorial</a> and this <a href="https://stackoverflow.com/questions/11638303/how-to-convert-num-to-int-in-r">Stack Overflow article</a>.</p>
<blockquote>
<p>A side note about this: I didn’t realize this might be a problem until a later lesson. If I found a problem like this in Excel, I would have to redo all my steps, but since I’m using a script, I was able to make this change and then rerun the notebook.</p>
</blockquote>
<p>As a last step, we have to <strong>reassign our mutated data frame back to wells</strong>, so change the first line to <code>wells &lt;- wells %&gt;%</code>.</p>
</div>
</div>
<div id="export-the-data" class="section level2">
<h2><span class="header-section-number">4.5</span> Export the data</h2>
<p>It’s not a bad idea to organize a project into multiple R Notebooks. I’ll often create my first notebook to complete the tasks of downloading and cleaning up data, and then create a new one to handle analysis, etc. (This is why I had you name the files <strong>01-</strong>wells.Rmd.) It’s possible to output the data frame you have created with all the changes and datatypes into a special <code>.rds</code> format that will re-import into R in exactly the same form. We’ll do that now.</p>
<ul>
<li>Create a new Markdown header and text description to explain that you are exporting the data.</li>
<li>Use the <strong>Files</strong> pane to create a <strong>New Folder</strong> called <code>data-out</code>. (If the folder doesn’t exist already, you’ll get an error trying save the file.)</li>
<li>Create a new code chunk and add the following and run it:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">saveRDS</span>(<span class="st">&quot;data-out/wells_01.rds&quot;</span>)</a></code></pre></div>
<p>To break that down:</p>
<ul>
<li>We are staring with <code>wells</code></li>
<li>We are piping that into the <code>saveRDS()</code> function.</li>
<li>We are giving <code>saveRDS()</code> the path to save the file.</li>
</ul>
<p><strong>DO NOT</strong> update this to assign back into the <code>wells</code> data frame. We don’t have to do that here since our output is an external file.</p>
<p><strong>DO</strong> use your <strong>Files</strong> pane to make sure it worked and you actually saved out the file.</p>
</div>
<div id="turn-in-wells" class="section level2">
<h2><span class="header-section-number">4.6</span> Turn in wells</h2>
<p>Congratulations! You finished this chapter, having renamed columns and changed data types. Depending on where we are in the week, you <em>may</em> be asked to turn this in at this stage. In any event, you should save and Knit your files.</p>
</div>
<div id="practice-assignment-clean-census-names" class="section level2">
<h2><span class="header-section-number">4.7</span> Practice assignment: Clean census names</h2>
<p>You will start with the “census-practice”&quot; project that you started in the previous chapter, so the first step is to open that project in RStudio.</p>
<p>The goal here is to <strong>rename the columns</strong> in the data to shorter, more-friendly names, such as “black” instead of “Not Hispanic - Black alone”, or “american_indian” instead of “Not Hispanic - American Indian alone”.</p>
<ul>
<li>Use <code>clean_names()</code> to standardize them.</li>
<li>Use either <code>rename()</code> or <code>str_replace()</code> on <code>names()</code> to rename the columns. It doesn’t matter to me how what method you use to change them, as long as it gets done.</li>
<li>Make sure each step is documented in Markdown with good headlines and descriptions.</li>
<li>Save the resulting data out as an “.rds” file into a <code>data-out</code> folder.</li>
</ul>
<p>Save, Knit, Zip and submit your project folder to the “Practice: Columns” assignment.</p>
<!--chapter:end:04-columns.Rmd-->
</div>
</div>
<div id="transform" class="section level1">
<h1><span class="header-section-number">5</span> Transform</h1>
<div id="goals-for-the-section" class="section level2">
<h2><span class="header-section-number">5.1</span> Goals for the section</h2>
<ul>
<li>Pay more attention to the Markdown to record our goals, actions and explain our code. We’ll name our code chunks, too.</li>
<li>Use the <a href="">dplyr</a> tools to filter, sort and create new columns of data.</li>
</ul>
</div>
<div id="introducing-dplyr" class="section level2">
<h2><span class="header-section-number">5.2</span> Introducing dplyr</h2>
<p>One of the packages within the tidyverse is <a href="https://dplyr.tidyverse.org/">dplyr</a> ( <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a> ) which allows us to transform our data frames in ways that let us explore the data and prepare it for visualizing. It’s the R equivalent of common Excel functions like sort, filter and pivoting.</p>
<div class="figure">
<img src="images/transform-dplyractions.png" alt="dplyr functions" width="600" />
<p class="caption">dplyr functions</p>
</div>
<p>(Some slides included here are used with permission from Hadley and Charlotte Wickham.)</p>
</div>
<div id="start-a-new-r-notebook" class="section level2">
<h2><span class="header-section-number">5.3</span> Start a new R Notebook</h2>
<p>As I explained at the end of our last lesson, it’s a good practice to separate your import/cleaning functions from your analysis functions into separate notebooks, so we’ll create a new one for our analysis.</p>
<ul>
<li>Launch RStudio and open your wells project.</li>
<li>Create a new R Notebook and set a new title of “Wells exploration and analysis”.</li>
<li>Remove the boilerplate language and add a description of our goals: To explore an analyze our wells project. Mention that you have to run the other notebook first in case your someone else (or your future self) comes here first.</li>
<li>Save your file as <code>02-wells-explore.Rmd</code>.</li>
</ul>
</div>
<div id="record-our-goals" class="section level2">
<h2><span class="header-section-number">5.4</span> Record our goals</h2>
<p>What do we want to learn about these wells? Look over the columns and some of the values in them and come up with a list of at least five things you might want to learn from the data.</p>
<ul>
<li>Add a Markdown headline <code>## Goals</code>.</li>
<li>Create a bullet list of things you might want to find. Use a <code>*</code> or <code>-</code> to start each new line.</li>
</ul>
<p>We’ll review some of your ideas in class.</p>
</div>
<div id="name-your-code-chunks" class="section level2">
<h2><span class="header-section-number">5.5</span> Name your code chunks</h2>
<p>By adding the word <code>setup</code> after our the <code>{r}</code> at the beginning, then we can find that chunk in our navigation drop down at the bottom of the R Notebook window.</p>
<div class="figure">
<img src="images/transform-navigate.png" alt="R Notebook navigation" width="600" />
<p class="caption">R Notebook navigation</p>
</div>
</div>
<div id="import-our-data" class="section level2">
<h2><span class="header-section-number">5.6</span> Import our data</h2>
<ul>
<li>Add a Markdown headline and description that you are loading the data.</li>
<li>Add a code chunk named <code>import</code> with the following:</li>
</ul>
<div class="figure">
<img src="images/transform-wells-import.png" alt="Wells data imported" width="600" />
<p class="caption">Wells data imported</p>
</div>
<p>Now we are back to where we ended with the first notebook.</p>
</div>
<div id="filter" class="section level2">
<h2><span class="header-section-number">5.7</span> Filter()</h2>
<p>We can use dplyr’s <code>filter()</code> function to capture a subset of the data, like all the wells in Travis County. It works like this:</p>
<div class="figure">
<img src="images/transform-filter.png" alt="dplyr filter function" width="600" />
<p class="caption">dplyr filter function</p>
</div>
<p>Let’s filter our wells data to just those in Travis County. We are going to use the <code>%&gt;%</code> pipe function to do this to the <code>wells</code> data frame.</p>
<div class="figure">
<img src="images/transform-wells-travis.png" alt="Travis wells" />
<p class="caption">Travis wells</p>
</div>
<p>When you run this, you’ll see that you the about 9000 rows instead of the 18,000+ of the full data set.</p>
<p>Note the two equals signs there <code>==</code>. It’s important two use two of them, as a single <code>=</code> will not work, as that means something else.</p>
<p>There are a number of these logical test operations:</p>
<div class="figure">
<img src="images/transform-logical-test.png" alt="dplyr logical tests" width="600" />
<p class="caption">dplyr logical tests</p>
</div>
<div id="filter-your-turn" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Filter your turn</h3>
<p>Create new code blocks and filter for each of the following:</p>
<ul>
<li>Wells with a proposed use of Irrigation.</li>
<li>Wells at least 1000 feet deep. (HINT: If you are filtering on a number, don’t put it in quotes, or it will become text instead.)</li>
<li>One more that might help you answer one of your goals you listed above.</li>
</ul>
</div>
<div id="common-mistakes-with-filter" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Common mistakes with filter</h3>
<p>Some common mistakes that happen when using filter.</p>
<div id="use-two-signs-for-true" class="section level4">
<h4><span class="header-section-number">5.7.2.1</span> Use two == signs for “true”</h4>
<p>DON’T DO THIS:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="dt">county =</span> <span class="st">&quot;Travis&quot;</span>)</a></code></pre></div>
<p>DO THIS:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>)</a></code></pre></div>
</div>
<div id="forgetting-quotes" class="section level4">
<h4><span class="header-section-number">5.7.2.2</span> Forgetting quotes</h4>
<p>DON’T DO THIS:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> </span>Bastrop)</a></code></pre></div>
<p>DO THIS:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Bastrop&quot;</span>)</a></code></pre></div>
</div>
</div>
</div>
<div id="combining-filters" class="section level2">
<h2><span class="header-section-number">5.8</span> Combining filters</h2>
<p>You can filter for more than one thing at a time by separating more than one test with a comma.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>, proposed_use <span class="op">==</span><span class="st"> &quot;Irrigation&quot;</span>)</a></code></pre></div>
<p>If you use a comma to separate tests, then both tests have to be true. If you want OR, then you use a pipe <code>|</code> (the shift-key above the backslash.)</p>
<div class="figure">
<img src="images/transform-boolean.png" alt="Boolean operators" width="600" />
<p class="caption">Boolean operators</p>
</div>
<div id="your-turn-combining-filters" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Your turn combining filters</h3>
<p>Your quest is to filter to wells in Travis or Williamson counties that have a start date in 2018.</p>
<p><strong>BIG HINT</strong>: If you include <code>library(lubridate)</code> in your notebook then you can access the year of a field with <code>year(name_of_date_field)</code>.</p>
</div>
<div id="common-mistakes-with-combining-filters" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Common mistakes with combining filters</h3>
<p>Some things to watch when trying to combine filters.</p>
<div id="collapsing-multiple-tests-into-one" class="section level4">
<h4><span class="header-section-number">5.8.2.1</span> Collapsing multiple tests into one</h4>
<p>DON’T DO THIS:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span> <span class="op">|</span><span class="st"> &quot;Williamson&quot;</span>)</a></code></pre></div>
<p>DO THIS:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">well <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span> <span class="op">|</span><span class="st"> </span>county <span class="op">==</span><span class="st"> &quot;Williamson&quot;</span>)</a></code></pre></div>
<p>BUT EVEN BETTER:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Travis&quot;</span>, <span class="st">&quot;Williamson&quot;</span>))</a></code></pre></div>
<p>If you want to combine a series of strings in your filter, you have to put them inside a “concatenate” function, which is shortened to <code>c()</code>, as in the example above.</p>
</div>
</div>
</div>
<div id="arrange" class="section level2">
<h2><span class="header-section-number">5.9</span> Arrange()</h2>
<p>The <code>arrange()</code> function sorts data.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">dataframe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(column)</a></code></pre></div>
<p>Or, to arrange in descending order (biggest on top):</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">dataframe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(column))</a></code></pre></div>
<p>So, let’s sort our data by the borehole depth:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(borehole_depth)</a></code></pre></div>
<p>You’ll have to scroll the columns over to see it, and the depths start at zero, which is not very sexy. As journalists, we usually want to see the largest (or deepest) thing, so we can arrange the column in descending order with this:</p>
<div class="figure">
<img src="images/transform-wells-deep.png" alt="Deepest wells" width="600" />
<p class="caption">Deepest wells</p>
</div>
<p>Now we see some deep wells … 3300 feet when I pulled my test data.</p>
</div>
<div id="multi-step-operations" class="section level2">
<h2><span class="header-section-number">5.10</span> Multi-step operations</h2>
<p>But what if you want to both filter and arrange? It is possible to chain piped opperations together.</p>
<p>Let’s find the deepest well in Travis County:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(borehole_depth))</a></code></pre></div>
<div id="your-turn-to-combine-and-pipe" class="section level3">
<h3><span class="header-section-number">5.10.1</span> Your turn to combine and pipe</h3>
<p>Find a list of the deepest irrigation wells in Travis County in 2017. Use the pipe to string together your functions.</p>
</div>
</div>
<div id="select" class="section level2">
<h2><span class="header-section-number">5.11</span> Select()</h2>
<p>As we’ve worked with <code>borehole_depth</code> it’s been kind of a pain to tab through all the fields to see the result we want. The <code>select()</code> function allows you to choose which fields to display from a data frame. If we are only interested in the <code>owner</code> and <code>borehole_depth</code> from our previous query of deepest wells in Travis, then we we can pipe the results to a select function. It works by listing the column names inside the function. You can use <code>-</code> before a column name to remove it.</p>
<ul>
<li>One the end of your previous code chunk, add a pipe, then <code>select(owner_name, borehole_depth)</code>:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Travis&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(borehole_depth)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(owner_name, borehole_depth)</a></code></pre></div>
<p>The order of all these operations matter. If you use <code>select()</code> that removes a column, you cannot later use filter on that removed column.</p>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">5.12</span> Mutate()</h2>
<p>We used the <code>mutate()</code> function with our data cleaning, but let’s dive more into it. <code>mutate()</code> allows us to change data based on a formula. We can assign the change back to an existing column or create a new one.</p>
<div class="figure">
<img src="images/transform-mutate.png" alt="Create columns with mutate()" width="600" />
<p class="caption">Create columns with mutate()</p>
</div>
<p>In the example above:</p>
<ul>
<li><code>gapminder</code> is the source data frame.</li>
<li><code>gdp</code> is the new column being created. it comes first.</li>
<li><code>= gdpPercap * pop</code> is the function. It is multiplying the the two columns that are in the <code>gapminder</code> data frame.</li>
</ul>
<p>The applied function doesn’t have to be math. It could be pulling part of a string or any number of things.</p>
<p>We’ll use this to create a new “year_drilled” column that has just the year that well was started. It will help us plot data later.</p>
<p>We’re going to do this is two steps. We’ll first write the function to make sure it working like we want, then we’ll assign the result back to the <code>wells</code> data frame.</p>
<div class="figure">
<img src="images/transform-wells-mutate.png" alt="Mutate and select" />
<p class="caption">Mutate and select</p>
</div>
<p>This added our new column to the end of the data frame.</p>
<div id="your-turn-to-mutate" class="section level3">
<h3><span class="header-section-number">5.12.1</span> Your turn to mutate</h3>
<ul>
<li>Modify the above mutate function to also add a <code>month_drilled</code> column.</li>
</ul>
</div>
<div id="document-and-save-new-columns" class="section level3">
<h3><span class="header-section-number">5.12.2</span> Document and save new columns</h3>
<ul>
<li>Before the code chunk, write out what we are doing. Add a Markdown headline and description of our task, which was to add a “year_drilled” and “month_drilled” column.</li>
<li>Name the chunk by adding <code>add_year_month</code> inside the <code>{r}</code> part of the chunk.</li>
<li>Edit the first line <code>wells %&gt;%</code> to <code>wells &lt;- wells %&gt;%</code> to assign the mutate result back to our wells data frame.</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">wells &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">    <span class="dt">year_drilled =</span> <span class="kw">year</span>(drilling_start_date),</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">    <span class="dt">month_drilled =</span> <span class="kw">month</span>(drilling_start_date)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">  )</a></code></pre></div>
<p>As we’ve seen before, when we assign the result back to <code>wells</code>, the data frame will no longer print to the screen anymore. That’s OK. Inspect the <code>wells</code> data frame within the Environment tab and to make sure it was created properly. (If you really want to check the data on your screen, you could use <code>head(wells)</code> to see just the several lines.)</p>
<p>As you may recall from our lesson on column renaming, we can create more than one column within the same <code>mutate()</code> function by separating them with commas.</p>
</div>
<div id="export-the-mutated-data" class="section level3">
<h3><span class="header-section-number">5.12.3</span> Export the mutated data</h3>
<p>We actually want to keep these new columns to use later, so let’s do a quick export to save them for later.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">saveRDS</span>(<span class="st">&quot;data-out/wells_02.rds&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="summarize" class="section level2">
<h2><span class="header-section-number">5.13</span> Summarize()</h2>
<p>The <code>summarize()</code> and <code>summarise()</code> functions compute tables <em>about</em> your data. They are the same function, as R supports both the American and European spelling of summarize. I don’t care which you use.</p>
<div class="figure">
<img src="images/transform-summarise.png" alt="Learn about your data with Summarize()" width="600" />
<p class="caption">Learn about your data with Summarize()</p>
</div>
<p>Much like the <code>mutate()</code> function, we list the name of the new column first, then assign to it the function we want to accomplish using <code>=</code>.</p>
<p>Let’s find the average <code>borehole_depth</code> of all the wells.</p>
<div class="figure">
<img src="images/transform-wells-nanowork.png" alt="Attempt to find the mean" />
<p class="caption">Attempt to find the mean</p>
</div>
<p>But, our return isn’t good? What’s up with that?</p>
<div id="ignoring-na" class="section level3">
<h3><span class="header-section-number">5.13.1</span> ignoring na</h3>
<p>In short, you can’t divide by zero or a NULL or NA value. I’ll show you how to ignore them, but first we should find out how many there are:</p>
<div class="figure">
<img src="images/transform-wells-findna.png" alt="Find NA values" />
<p class="caption">Find NA values</p>
</div>
<p>Take a look at this and guess what is happening. Clearly <code>is.na</code> is a thing. How is it being used?</p>
<p>There are 22 records returned out of 18k+. Can we safely exclude them without affecting the results? I think so.</p>
<p>We can apply a similar function <code>na.rm</code> function inside our <code>summarise()</code> function to remove the missing values before the calculation, like this:</p>
<div class="figure">
<img src="images/transform-wells-narm.png" alt="NAs removed from summarize" />
<p class="caption">NAs removed from summarize</p>
</div>
<p>A mean (or average in common terms) is a way to use one number to represent a group of numbers. It works well when the variance in the numbers is not great. Median is another way, and sometimes better when there are high or low numbers that would unduly influence a mean.</p>
</div>
<div id="your-turn-with-summarise" class="section level3">
<h3><span class="header-section-number">5.13.2</span> Your turn with summarise</h3>
<p>Like filter and mutate, you can do more than one calculation within a summarize function. Edit the code chunk above in two ways:</p>
<ul>
<li>Make sure to name the code chunk, something like <code>depth_summaries</code>.</li>
<li>Modify the summarize function to also create a <code>median_depth</code> summary. Look at your dplyr cheat sheet or google to find out how.</li>
</ul>
</div>
</div>
<div id="group_by" class="section level2">
<h2><span class="header-section-number">5.14</span> Group_by()</h2>
<p>The <code>summarise()</code> function is an especially useful in combination with another function called <code>group_by()</code>, which allows us to pivot tables to count and measure data by its values.</p>
<div class="figure">
<img src="images/transform-groupby.png" alt="Group by" />
<p class="caption">Group by</p>
</div>
<p>This is easier to understand when you can see an example, so let’s do it.</p>
<div id="group-and-count" class="section level3">
<h3><span class="header-section-number">5.14.1</span> Group and count</h3>
<p>So, we have more than 18,000 wells, but we don’t know how many of each kind. We could filter them one-by-one, but there is an easier way.</p>
<div class="figure">
<img src="images/transform-wells-groupbyn.png" alt="Group and count" />
<p class="caption">Group and count</p>
</div>
<p>Let’s break this down:</p>
<ul>
<li>We start with the <strong>wells</strong> data frame.</li>
<li>We then <strong>group_by</strong> the data by the <code>proposed_use</code>. If we print the data frame at this point, we won’t really see a difference. The <code>group_by()</code> function always needs another function to see a result.</li>
<li>We then <strong>summarise</strong> the grouped data. In this case, we are creating a column called <code>count</code>, and we are assigning to is a special function <code>n()</code> which counts the number of records within each group.
<ul>
<li>The result is for each unique value in the <strong>prospose_use</strong> column, we get the number of records that have that have that value.</li>
</ul></li>
<li>We then <strong>arrange</strong> the resulting table in descending order by our new column, <code>count</code>, so we can see which value has the most records.</li>
</ul>
<p>We can see that “Domestic” wells are more prevalent by a wide margin. If page through the list, you’ll see that to get an accurate count of each type of well, we’ll need to do some data cleaning. We’ll do that at another time.</p>
<p>Let’s walk through another example:</p>
<div class="figure">
<img src="images/transform-group-summarise.png" alt="Group and summarise" />
<p class="caption">Group and summarise</p>
</div>
</div>
<div id="your-turn-to-group" class="section level3">
<h3><span class="header-section-number">5.14.2</span> Your turn to group</h3>
<ul>
<li>How many wells were drilled in each county? Use the same <code>group_by</code> and <code>summarise</code> method to make a table that counts wells drilled in each county.</li>
<li>Since you can <code>summarise</code> by more than one thing, try to find the count and average (mean) borehole_depth of wells by proposed use. You can copy the first summary we did and work from that, editing the <code>summarise</code> statement.</li>
</ul>
</div>
<div id="counting-only" class="section level3">
<h3><span class="header-section-number">5.14.3</span> Counting only</h3>
<p>We’ll use summarize to do more than count, but if counting is all you want to know, there is an easier way. (I’ll try not to show you too many alternate methods … there are many ways to do everything, but this is worth knowing.)</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">well <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(proposed_use)</a></code></pre></div>
<p>It creates a column named “n” with the count. You could <em>then</em> use <code>rename(new = old)</code> to call it something else, like “wells_drilled”.</p>
</div>
</div>
<div id="transform-review" class="section level2">
<h2><span class="header-section-number">5.15</span> Transform review</h2>
<p>This has been a lot to learn, but it is the basics of just about any data analysis … to <strong>filter</strong>, <strong>select</strong>, <strong>arrange</strong>, <strong>group</strong> and <strong>summarise</strong> values. And to create new variables with with <strong>mutate</strong>.</p>
<p>Next, we’ll start plotting some of this data so we can <em>see</em> it.</p>
</div>
<div id="turn-in-your-in-class-project" class="section level2">
<h2><span class="header-section-number">5.16</span> Turn in your in-class project</h2>
<p>At this point, you’ll want so <strong>save</strong>, <strong>knit to HTML</strong> and then close your project. Zip up the folder and turn it into the assignment in Canvas.</p>
</div>
<div id="practice-assignment-transforms-on-census" class="section level2">
<h2><span class="header-section-number">5.17</span> Practice assignment: Transforms on census</h2>
<p>For this practice assignment, you’ll continue with your “census-practice” project.</p>
<p>The goal here is: For each race in the data, find the county with the highest percentage for that race. You’ll use the dplyr commands from this lesson to do it.</p>
<ul>
<li>Start a new notebook that imports the cleaned data from the last assignment. Start the notebook name with “02-” so you know the order to run them in the future.</li>
<li>Use <code>mutate()</code> to create a new column for each race that calculates the percentage for that race. You might create columns names like “hispanic_prc” with the formula “(hispanic / total_populaton) * 100”. Assign those values back to the “census” data frame.</li>
<li>Create a series of code chunks, one for each race that does this: Arrange the data so the county with the highest percentage of that race is on top, then use <code>select()</code> to show these columns: The county, total population, that race total, and the percentage of that race.</li>
<li>Make sure that each each action is clearly described in Markdown headlines and text, and that each code chunk is named.</li>
</ul>
<p>If you feel like you are repeating yourself a lot on this assignment and feel like there should be a better way, I assure you there is. We will get to that.</p>
<p>Save, Knit, Zip and upload your project to the “Practice: Transform with dplyr” assignment.</p>
<!--chapter:end:05-transform.Rmd-->
</div>
</div>
<div id="cleaning" class="section level1">
<h1><span class="header-section-number">6</span> Cleaning</h1>
<div id="goals-for-this-section-2" class="section level2">
<h2><span class="header-section-number">6.1</span> Goals for this section</h2>
<ul>
<li>Create a new notebook for cleaning data</li>
<li>Throughout the notebook, we want to explain our thoughts and goals in Markdown. Each code block should have a human readable explanation of the goal or task.</li>
<li>Import most recent data</li>
<li>Create cleaned proposed_use column</li>
<li>Export data for next notebook</li>
</ul>
<div id="resources-1" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Resources</h3>
<ul>
<li><a href="https://r4ds.had.co.nz/strings.html">Strings</a> chapter from Hadley Wickham’s book, specifically about <a href="https://r4ds.had.co.nz/strings.html#replacing-matches"><code>str_replace()</code></a>.</li>
<li><a href="https://www.rdocumentation.org/packages/stringr/versions/1.3.1/topics/str_replace">RDocumentation</a> on <code>str_replace()</code>.</li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/strings.pdf">stringr cheatsheet</a>.</li>
</ul>
</div>
</div>
<div id="taking-stock-of-the-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Taking stock of the data</h2>
<p>As we were looking at the <code>proposed_use</code> field in the wells data, we found that the values there were pretty dirty, with misspellings and unofficial designations. If we look at the official designations for Proposed Use on <a href="http://www.twdb.texas.gov/groundwater/data/doc/TWRSRS_UserManual.pdf?d=43539.49999999895">page 10 of the data user manual</a>, we see there are 14 official designations, none with any of various spellings of <a href="https://en.wikipedia.org/wiki/Piezometer">Piezo</a>, which looks to be monitor wells.</p>
<p>We need to create a clean version of the <code>proposed_use</code> column to use with our analysis and visualizations. Typically when I discover a situation like this, I go back to my first “import and cleaning” notebook and make changes there so the work can carry through to all subsequent notebooks, but in this case we’ll just make our changes in a new notebook and then document and export the changes for future work.</p>
</div>
<div id="setup-and-import" class="section level2">
<h2><span class="header-section-number">6.3</span> Setup and import</h2>
<ul>
<li>Create a new R Notebook with a title “Wells cleaning” and a filename of <code>03-wells-cleaning.Rmd</code>.</li>
<li>In Markdown, write down our purpose and goals in your own words.</li>
<li>Set up the tidyverse library and import the <code>data/wells_02.rds</code> file that we exported at the end of our last notebook. (If you don’t recall how to do this, look at your last notebook, but update the code to reflect the new filename.) For this block and all others, make sure you have a Markdown description of the goal or task.</li>
</ul>
</div>
<div id="clean-the-proposed_use-column" class="section level2">
<h2><span class="header-section-number">6.4</span> Clean the proposed_use column</h2>
<div id="count-values-in-a-column" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Count values in a column</h3>
<p>Let’s look again at the the values in the <code>proposed_use</code> column of the wells data. One way to see all the unique values and also find out how many there are is to use the <code>count()</code> function, which is a simple pivot table.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(proposed_use)</a></code></pre></div>
<p>Which gives us a list that looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">proposed_use</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AG WELL</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Closed-Loop Geothermal</td>
<td align="right">246</td>
</tr>
<tr class="odd">
<td align="left">Commercial</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">De-watering</td>
<td align="right">33</td>
</tr>
<tr class="odd">
<td align="left">Domestic</td>
<td align="right">8408</td>
</tr>
<tr class="even">
<td align="left">Environmental Soil Boring</td>
<td align="right">3719</td>
</tr>
<tr class="odd">
<td align="left">Ground Well for Electric Substation</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Industrial</td>
<td align="right">102</td>
</tr>
<tr class="odd">
<td align="left">Injection</td>
<td align="right">61</td>
</tr>
<tr class="even">
<td align="left">Irrigation</td>
<td align="right">1493</td>
</tr>
<tr class="odd">
<td align="left">IRRIGATION/TESTWELL</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Monitor</td>
<td align="right">3354</td>
</tr>
<tr class="odd">
<td align="left">Monitor-VMP</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">peizometer</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Peizometer</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">piezo</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Piezo</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">piezometer</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">Piezometer</td>
<td align="right">25</td>
</tr>
<tr class="even">
<td align="left">Piezometer Installation</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">PLUGGING</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Public Supply</td>
<td align="right">174</td>
</tr>
<tr class="odd">
<td align="left">Rig Supply</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Soil Vapor Monitor</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Stock</td>
<td align="right">259</td>
</tr>
<tr class="even">
<td align="left">Surface Slab Repair</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Test Well</td>
<td align="right">266</td>
</tr>
<tr class="even">
<td align="left">Unknown</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Vapor Monitoring Point</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">VAPOR POINT</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>We have 30 different values here that we need to combine into at most 14 categories, which are the official ones listed on <a href="http://www.twdb.texas.gov/groundwater/data/doc/TWRSRS_UserManual.pdf?d=43539.49999999895">page 10 of the data user manual</a>. After looking through it and doing some Googling, I came to a couple of conclusions:</p>
<ul>
<li>Anything named “piezo” or a variant should be a Monitor well.</li>
<li>Anything named “vapor” should be a Monitor well.</li>
<li>Anything that isn’t on the official list should be Other.</li>
</ul>
<p>TBH, if I was writing stories about this data, I would call the TWDB and make my sure that my educated assumptions are correct. But they seem reasonable given the documentation.</p>
</div>
<div id="change-values-in-a-column" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Change values in a column</h3>
<p>So, our goal here is to create a new column that starts with the value of <code>proposed_use</code>, but then we search through the values for things like “piezo” and set them to something more useful.</p>
<p>We’ll utilize a stringr function called <code>str_replace()</code> using <a href="https://drive.google.com/open?id=1DvAM4lnGJLefo9skD8GgM-_9S1BEhpjJfV86yhJavI0">regular expressions</a> to do this, within a <code>mutate()</code> function, which we know we can use to create or make changes in a column data. And, of course, we need to figure out how to do it before we save it, so let’s work through it.</p>
<p>Start by calling the <code>wells</code> data frame, then using mutate to create a new column from <code>proposed_use</code>, and then count the rows from the new column. For now, it will be the same as it was for <code>proposed use</code> but we’ll fix that. Note that we will work through several steps in this mutate function <em>before</em> we save it back into wells.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">    <span class="dt">use_clean =</span> proposed_use</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(use_clean)</a></code></pre></div>
<div id="convert-to-lowercase" class="section level4">
<h4><span class="header-section-number">6.4.2.1</span> Convert to lowercase</h4>
<p>It will be much easier for us to deal with different spellings of words if everything was lower case. “Piezo” is different than “piezo”, so let’s convert everything to lower case.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">    <span class="dt">use_clean =</span> <span class="kw">tolower</span>(proposed_use)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(use_clean)</a></code></pre></div>
<p>Now our results are all lowercase. It looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">use_clean</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ag well</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">closed-loop geothermal</td>
<td align="right">246</td>
</tr>
<tr class="odd">
<td align="left">commercial</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">de-watering</td>
<td align="right">33</td>
</tr>
</tbody>
</table>
</div>
<div id="clean-up-the-piezo-ish-values" class="section level4">
<h4><span class="header-section-number">6.4.2.2</span> Clean up the piezo-ish values</h4>
<p>We still have four different versions of “piezo” and the like, which need to be labeled as “monitor”. You might make a mental note of how many values you currently have for “monitor” now so we can notice how that value grows as we fix our piezos. (I have 3354 in our example, but the number will be different depending on when the data was pulled from TWDB.) We can continue to stack changes inside our <code>mutate()</code> function to deal with this using <code>str_replace()</code>.</p>
<p>There are three arguments to the <a href="https://www.rdocumentation.org/packages/stringr/versions/1.3.1/topics/str_replace"><code>str_replace()</code> function</a>:</p>
<ul>
<li>what column are we working on.</li>
<li>what pattern are we looking for, as a regular expression.</li>
<li>what value do we want it to be.</li>
</ul>
<p>We have created a new column <code>use_clean</code> that we want to continue to modify, so it is both our target and our source of our subsequent mutates.</p>
<p>The pattern we want is anything that starts with the word “piezo” and “peizo” with anything that follows. The regex expression for “anything” is <code>.*</code>, so <code>piezo.*</code> with catch “piezo”, “piezometer” and “piezo installation”. We also want to set any value with those terms to “monitor”, so we set up our string replace function: <code>str_replace(use_clean, &quot;piezo.*&quot;, &quot;monitor&quot;)</code> and add it to our list of mutates:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="dt">use_clean =</span> <span class="kw">tolower</span>(proposed_use),</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">    <span class="dt">use_clean =</span> <span class="kw">str_replace</span>(use_clean, <span class="st">&quot;piezo.*&quot;</span>, <span class="st">&quot;monitor&quot;</span>)</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(use_clean)</a></code></pre></div>
<p>If we look at the results of that change, we see we are left with the one misspelled “peizometer”. We can fix that by adding an “or” section to our search pattern, using the regular expression key <code>|</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">    <span class="dt">use_clean =</span> <span class="kw">tolower</span>(proposed_use),</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">    <span class="dt">use_clean =</span> <span class="kw">str_replace</span>(use_clean, <span class="st">&quot;piezo.*|peizo.*&quot;</span>, <span class="st">&quot;monitor&quot;</span>)</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(use_clean)</a></code></pre></div>
<p>Check your results and make sure that there are no longer any versions of “piezo” in use_clean.</p>
<p>You can keep stacking these <code>str_replace()</code> mutates to clean further values.</p>
</div>
<div id="your-turn-str_replace-functions" class="section level4">
<h4><span class="header-section-number">6.4.2.3</span> Your turn: str_replace functions</h4>
<p>Now it’s up to you to add more mutate strings to clean the rest of the column to get the 14 official “Proposed Use” designations listed below. It would make sense to organize your new mutate lines in logical ways, like perhaps to capture all the terms that would go into “other” together using the <code>|</code> in your search pattern, like we did with piezo and peizo example above. Here’s the official list:</p>
<ul>
<li>closed-loop geothermal</li>
<li>de-watering</li>
<li>domestic</li>
<li>environmental soil boring</li>
<li>industrial</li>
<li>injection</li>
<li>irrigation</li>
<li>monitor</li>
<li>other</li>
<li>public supply</li>
<li>rig supply</li>
<li>stock</li>
<li>test</li>
<li>unknown</li>
</ul>
</div>
<div id="double-check-our-results" class="section level4">
<h4><span class="header-section-number">6.4.2.4</span> Double-check our results</h4>
<p>It might make sense to do one last check of our conversions before reassigning all of changes back to the wells data frame. Change the last <code>count()</code> function to the following:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">  <span class="kw">count</span>(use_clean) <span class="co">#change this line</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">  <span class="kw">distinct</span>(proposed_use, use_clean) <span class="co"># to this line</span></a></code></pre></div>
<p>The result looks something similar to this:</p>
<table>
<thead>
<tr class="header">
<th>proposed_use</th>
<th>use_clean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Irrigation</td>
<td>irrigation</td>
</tr>
<tr class="even">
<td>Domestic</td>
<td>domestic</td>
</tr>
<tr class="odd">
<td>Monitor</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>Public Supply</td>
<td>public supply</td>
</tr>
<tr class="odd">
<td>Environmental Soil Boring</td>
<td>environmental soil boring</td>
</tr>
<tr class="even">
<td>Closed-Loop Geothermal</td>
<td>closed-loop geothermal</td>
</tr>
<tr class="odd">
<td>Industrial</td>
<td>industrial</td>
</tr>
<tr class="even">
<td>Piezo</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>Stock</td>
<td>stock</td>
</tr>
<tr class="even">
<td>Piezometer</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>Test Well</td>
<td>test</td>
</tr>
<tr class="even">
<td>Unknown</td>
<td>unknown</td>
</tr>
<tr class="odd">
<td>piezometer</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>De-watering</td>
<td>de-watering</td>
</tr>
<tr class="odd">
<td>Ground Well for Electric Substation</td>
<td>other</td>
</tr>
<tr class="even">
<td>VAPOR POINT</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>Piezometer Installation</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>Surface Slab Repair</td>
<td>other</td>
</tr>
<tr class="odd">
<td>Monitor-VMP</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>peizometer</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>piezo</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>Vapor Monitoring Point</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>Injection</td>
<td>injection</td>
</tr>
<tr class="even">
<td>Peizometer</td>
<td>monitor</td>
</tr>
<tr class="odd">
<td>Commercial</td>
<td>other</td>
</tr>
<tr class="even">
<td>IRRIGATION/TESTWELL</td>
<td>test</td>
</tr>
<tr class="odd">
<td>Soil Vapor Monitor</td>
<td>monitor</td>
</tr>
<tr class="even">
<td>PLUGGING</td>
<td>other</td>
</tr>
<tr class="odd">
<td>AG WELL</td>
<td>other</td>
</tr>
<tr class="even">
<td>Rig Supply</td>
<td>rig supply</td>
</tr>
</tbody>
</table>
<p>This will allow you to double check that all your conversions happened properly.</p>
</div>
</div>
<div id="reassign-your-changes-back-to-the-data-frame" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Reassign your changes back to the data frame</h3>
<p>Once you have all your column changes worked out, you need to fix it up to reassign the values to the data frame, and then <strong>add Markdown commentary above it to explain the purpose of the code chunk</strong>.</p>
<ul>
<li>Edit your code chunk to remove the <code>distinct()</code> or <code>count()</code> functions at the end.</li>
<li>Edit the code chunk to reassign the values back to <code>wells</code>.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">wells &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">    <span class="dt">use_clean =</span> <span class="kw">tolower</span>(proposed_use),</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">    <span class="dt">use_clean =</span> <span class="kw">str_replace</span>(use_clean, <span class="st">&quot;piezo.*|peizo.*&quot;</span>, <span class="st">&quot;monitor&quot;</span>),</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">    <span class="co"># your other str_replace items ...</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6">  )</a></code></pre></div>
</div>
</div>
<div id="export-your-updated-data-frame" class="section level2">
<h2><span class="header-section-number">6.5</span> Export your updated data frame</h2>
<p>Let’s again export our data so we can use it in a new notebook. Since we are in our third notebook of this project, let’s name the file <code>wells_03.rds</code> since this is coming out of our third notebook.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">saveRDS</span>(wells, <span class="st">&quot;data-out/wells_03.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="future-addition" class="section level2">
<h2><span class="header-section-number">6.6</span> Future addition</h2>
<p>While this data doesn’t support it, it would be good to have here an example of how you might take a column made up of codes, like school accountability ratings being “M”, “I”, “A”, etc. and convert them to their readable values like like “Met standard”, “Needs Improvement” and “Alternative standard”.</p>
<!--chapter:end:06-cleaning.Rmd-->
</div>
</div>
<div id="graphics" class="section level1">
<h1><span class="header-section-number">7</span> Graphics</h1>
<div id="goals-for-this-section-3" class="section level2">
<h2><span class="header-section-number">7.1</span> Goals for this section</h2>
<ul>
<li>An introduction to the Grammar of Graphics</li>
<li>We’ll make charts!</li>
</ul>
</div>
<div id="introduction-ggplot" class="section level2">
<h2><span class="header-section-number">7.2</span> Introduction ggplot</h2>
<p><a href="https://ggplot2.tidyverse.org/">ggplot2</a> is the data visualization library within Hadley Wickham’s <a href="https://www.tidyverse.org/">tidyverse</a>. It uses a concept called the <a href="https://byrneslab.net/classes/biol607/readings/wickham_layered-grammar.pdf">Grammar of Graphics</a>, the idea that you can build every graph from the same components: a data set, a coordinate system, and geoms – the visual marks that represent data points. With a hat tip to <a href="http://www.mattwaite.com/">Matt Waite</a>, the main concepts are:</p>
<ul>
<li><strong>data</strong>: which data frame you are pulling from</li>
<li><strong>aesthetics</strong>: the specific data from the data frame which we are going to plot</li>
<li><strong>geometries</strong>: the shape the data is going to take</li>
<li><strong>scales</strong>: any transformations we might make on the data</li>
<li><strong>layers</strong>: how we might lay multiple geometries over top of each other to reveal new information.</li>
<li><strong>facets</strong>: which means how we might graph many elements of the same data set in the same space</li>
</ul>
<p>The challenge to understand here is for every graphic, we start with the data, and then describe how to layer plots or pieces on top of that data.</p>
</div>
<div id="the-basic-ggplot-template" class="section level2">
<h2><span class="header-section-number">7.3</span> The basic ggplot template</h2>
<p>The template for a basic plot is this. (The <code>&lt;&gt;</code> denote that we are inserting values there.)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="dt">mapping =</span> <span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM<span class="op">&gt;</span>(<span class="op">&lt;</span>ADDITONAL_MAPPINGS<span class="op">&gt;</span>)</a></code></pre></div>
<ul>
<li><strong><code>ggplot()</code></strong> is our function. We feed into it the data we wish to plot.</li>
<li><strong><code>aes()</code></strong> stands for “aesthetics”, and it describes the column of data we want to plot, and how, like which column is on the <strong>x axis</strong> and which is on the <strong>y axis</strong>. These are called <strong>mappings</strong>, which we show in our template with <strong><code>&lt;MAPPINGS&gt;</code></strong>. They typically look like this: <code>aes(x = col_name_x, y = col_name_y)</code>. Now matter what type of chart we are building (bar chart, scatterplot, etc) we have to tell it which columns to show on the chart.</li>
<li>The <strong><code>+</code></strong> is the equivalent of <code>%&gt;%</code> in our tidyverse data. It means we are adding a layer, and it should always be at the end of the line, not at the beginning of the next.</li>
<li><strong><code>&lt;GEOM_FUNCTION&gt;</code></strong> is the type of chart or addition we are adding. They all start with the term <strong>geom_</strong> like <strong><code>geom_bar</code></strong>, which is what we will build with this example. It will take the mappings we supplied and plot them on the type of <strong>geom_</strong> we choose.</li>
<li><strong><code>&lt;ADDITIONAL MAPPINGS&gt;</code></strong> if a geom_ requires it, we can specify additional columns/axis mapping combinations to that <strong>geom_</strong>. We don’t always have or need them.</li>
</ul>
<p>There are some ways to simplify this, and some ways to complicate it. Let’s simplify first:</p>
<ul>
<li>It is implied that the first thing fed to <code>ggplot</code> is the data, so you don’t have to write out <code>data =</code> unless there is ambiguity.</li>
<li>The <code>aes()</code> values are also implied as mappings, so you don’t have to write out <code>mapping =</code> unless there is ambiguity.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">)</a></code></pre></div>
<p>One of the ways we make things complicated, is we layer different geometries. We might start with a scatterplot, and then add a reference line on top of it, which is a new geometry. Each <strong>goem_</strong> can specify their own mappings.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(<span class="kw">aes</span>(<span class="op">&lt;</span>SPECIFIC_MAPPINGS<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(<span class="kw">aes</span>(<span class="op">&lt;</span>SPECIFIC_MAPPINGS<span class="op">&gt;</span>))</a></code></pre></div>
</div>
<div id="lets-plot" class="section level2">
<h2><span class="header-section-number">7.4</span> Let’s plot!</h2>
<div id="set-up-our-notebook" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Set up our Notebook</h3>
<ul>
<li>Create a new RNotebook. Title it “Wells visualizations” and name the file <code>04-charts.Rmd</code>.</li>
<li>Load the following libraries: tidyverse, lubridate.</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="kw">library</span>(lubridate)</a></code></pre></div>
</div>
<div id="scatterplot" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Scatterplot</h3>
<p>One of the better ways to see this in action for the first time is build a scatterplot showing the relationship between two numbers. Unfortunately, our wells data does not have two such values, so we’ll explore this using a data set that is already built into ggplot2, <strong>mpg</strong>.</p>
<p>Take a look at the <strong>mpg</strong> by calling it like a data frame.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">mpg</a></code></pre></div>
<p>It looks something like this, which shows the first and last couple of rows:</p>
<table>
<thead>
<tr class="header">
<th>manufacturer</th>
<th>model</th>
<th>displ</th>
<th>year</th>
<th>cyl</th>
<th>trans</th>
<th>drv</th>
<th>cty</th>
<th>hwy</th>
<th>fl</th>
<th>class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>audi</td>
<td>a4</td>
<td>1.8</td>
<td>1999</td>
<td>4</td>
<td>auto(l5)</td>
<td>f</td>
<td>18</td>
<td>29</td>
<td>p</td>
<td>compact</td>
</tr>
<tr class="even">
<td>audi</td>
<td>a4</td>
<td>1.8</td>
<td>1999</td>
<td>4</td>
<td>manual(m5)</td>
<td>f</td>
<td>21</td>
<td>29</td>
<td>p</td>
<td>compact</td>
</tr>
<tr class="odd">
<td>audi</td>
<td>a4</td>
<td>2</td>
<td>2008</td>
<td>4</td>
<td>manual(m6)</td>
<td>f</td>
<td>20</td>
<td>31</td>
<td>p</td>
<td>compact</td>
</tr>
<tr class="even">
<td>audi</td>
<td>a4</td>
<td>2</td>
<td>2008</td>
<td>4</td>
<td>auto(av)</td>
<td>f</td>
<td>21</td>
<td>30</td>
<td>p</td>
<td>compact</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>.</td>
<td>…</td>
<td>.</td>
<td>..</td>
<td>..</td>
<td>.</td>
<td>…</td>
</tr>
<tr class="even">
<td>volkswagen</td>
<td>passat</td>
<td>2</td>
<td>2008</td>
<td>4</td>
<td>manual(m6)</td>
<td>f</td>
<td>21</td>
<td>29</td>
<td>p</td>
<td>midsize</td>
</tr>
<tr class="odd">
<td>volkswagen</td>
<td>passat</td>
<td>2.8</td>
<td>1999</td>
<td>6</td>
<td>auto(l5)</td>
<td>f</td>
<td>16</td>
<td>26</td>
<td>p</td>
<td>midsize</td>
</tr>
<tr class="even">
<td>volkswagen</td>
<td>passat</td>
<td>2.8</td>
<td>1999</td>
<td>6</td>
<td>manual(m5)</td>
<td>f</td>
<td>18</td>
<td>26</td>
<td>p</td>
<td>midsize</td>
</tr>
<tr class="odd">
<td>volkswagen</td>
<td>passat</td>
<td>3.6</td>
<td>2008</td>
<td>6</td>
<td>auto(s6)</td>
<td>f</td>
<td>17</td>
<td>26</td>
<td>p</td>
<td>midsize</td>
</tr>
</tbody>
</table>
<p>The data is a subset of fuel economy data from 1999 and 2008 for 38 popular cars. Don’t get too hung up on the data, it is just for examples.</p>
<p>The size of an engine is shows in the column <code>displ</code>. The Audi A4 has a 1.8 liter engine. The column <code>hwy</code> is the fuel rating for highways. Well also us the <code>class</code> column, which categorizes the type of vehicle.</p>
<p>What kind of relationship might you expect between the size of the engine and highway mileage?</p>
<p>Let’s use our plot to show this. If our basic template is like this:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM<span class="op">&gt;</span></a></code></pre></div>
<p>Now, let’s put our data in here. Our goal here is to show how the <strong>hwy</strong> number (y axis) changes as the <strong>displ</strong> number gets bigger (x axis.)</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p>Which gets us a our first chart:</p>
<div class="figure">
<img src="images/visualize-mpg-01.png" alt="MPG: hwy vs displ" />
<p class="caption">MPG: hwy vs displ</p>
</div>
<p>We can see there is a relationships of sort here, but ggplot has some additional geometries to help us see this, including <a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html"><code>geom_smooth()</code></a>. Since we have already the mappings in the main <code>ggplot()</code> call, all we have to do is add the new geom.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="co"># new plot. don&#39;t forget the + on previous line</span></a></code></pre></div>
<div class="figure">
<img src="images/visualize-mpg-02.png" alt="MPG: displ vs hwy with smooth line" />
<p class="caption">MPG: displ vs hwy with smooth line</p>
</div>
<p>Let’s add one more visual cue (or aesthetic) to this graphic by coloring the dots based on the <code>class</code> of the vehicle. Since we want this aesthetic to apply only to the <code>geom_point()</code>, we have to add the <code>aes()</code> value there.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span><span class="co"># added color aesthetic</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<div class="figure">
<img src="images/visualize-mpg-03.png" alt="MPG: disply vs mpg with class" />
<p class="caption">MPG: disply vs mpg with class</p>
</div>
<p>Looking at that graphic, what values might you want to learn more about?</p>
</div>
</div>
<div id="plotting-our-wells-data" class="section level2">
<h2><span class="header-section-number">7.5</span> Plotting our wells data</h2>
<p>For bar charts and line charts, we can return to our wells data, so let’s import what we had from our last notebook.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">wells &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data-out/wells_03.rds&quot;</span>)</a></code></pre></div>
<div id="total-wells-per-county" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Total wells per county</h3>
<div id="shape-our-data" class="section level4">
<h4><span class="header-section-number">7.5.1.1</span> Shape our data</h4>
<p>If we are plotting wells per county, we need to first build a data frame that counts the number of wells for each county. We can use the same <code>count()</code> function that we used when we cleaned our data.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">wells_by_county &lt;-<span class="st"> </span>wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(county) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">wells_count =</span> n)</a>
<a class="sourceLine" id="cb55-4" data-line-number="4">wells_by_county</a></code></pre></div>
<p>Let’s break this down:</p>
<ul>
<li>The first line creates the new data frame <code>wells_by_county</code>, starting with our <code>wells</code> data frame.</li>
<li>We apply the <code>count()</code> function on the “county” column. This makes our basic pivot table.</li>
<li>On the third line, we rename the “n” column that was created by <code>count()</code>, so it is more descriptive, calling it <code>wells_count</code>.</li>
<li>So now we have a data frame with two columns: <strong>county</strong> and <strong>wells_count</strong>. We print it on the fourth line so we can inspect it.</li>
</ul>
</div>
<div id="plot-our-wells-by-county" class="section level4">
<h4><span class="header-section-number">7.5.1.2</span> Plot our wells by county</h4>
<p>Here is the verbose plot for our counties.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> wells_by_county) <span class="op">+</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> county, <span class="dt">y =</span> wells_count), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<ul>
<li>On the first line we tell <code>ggplot()</code> that we are using the we <code>wells_by_county</code> data.</li>
<li>On the next, we apply the <code>geom_bar()</code> function to make a bar chart. It needs two things:
<ul>
<li>The mapping, which are the aesthetics. We well it to plot <strong>county</strong> on the x (horizontal) axis, and <strong>wells_count</strong> on the y (vertical) axis.</li>
<li>Because <strong>county</strong> is a category instead of a number, we have to use the <code>stat = &quot;identity&quot;</code> value to describe that we are using values within county to separate the bars. This is a special thing for bar charts. One of those things that drive you nuts.</li>
</ul></li>
</ul>
<div class="figure">
<img src="images/visualize-county-plot.png" alt="Basic county plot" />
<p class="caption">Basic county plot</p>
</div>
<p>Our less verbose way to do this looks like this:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">ggplot</span>(wells_by_county, <span class="kw">aes</span>(<span class="dt">x=</span>county, <span class="dt">y=</span>wells_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="add-a-layer-of-text-labels" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Add a layer of text labels</h3>
<p>For each new thing that we add to our graphic, we add it with <code>+</code>. In this case, we want to add number labels to show the wells_count for that county.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> wells_by_county, <span class="kw">aes</span>(<span class="dt">x =</span> county, <span class="dt">y =</span> wells_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>wells_count), <span class="dt">vjust=</span><span class="op">-</span><span class="fl">0.25</span>) <span class="co"># adds the numbers on bars</span></a></code></pre></div>
<div class="figure">
<img src="images/visualize-county-plot-labels.png" alt="Basic county plot" />
<p class="caption">Basic county plot</p>
</div>
<p>In this case, we are just adding another layer, the <code>geom_text()</code>. It requires some additional aesthetics, like what <code>label=</code> we want to use. The <code>vjust=</code> moves the numbers up a little. Change the number and see what happens.</p>
<p>The last layer we want to add here is a Title layer. The function for labels is called <code>labs()</code> and it takes an argument of <code>title = &quot;&quot;</code> You can also change your <code>x</code> and <code>y</code> axis names, etc.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> wells_by_county, <span class="kw">aes</span>(<span class="dt">x =</span> county, <span class="dt">y =</span> wells_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>wells_count), <span class="dt">vjust=</span><span class="op">-</span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb59-4" data-line-number="4">  <span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of wells drilled by county&quot;</span>) <span class="co"># adds the title</span></a></code></pre></div>
<div class="figure">
<img src="images/visualize-county-by-year-done.png" alt="Wells by county with title" />
<p class="caption">Wells by county with title</p>
</div>
<p>Congratulations! You made your first <code>ggplot()</code> chart. Not particularly revealing, but it does show that Travis County has WAY more wells than the other counties.</p>
<p>Let’s see how those trends play out over time.</p>
</div>
</div>
<div id="wells-per-county-over-time" class="section level2">
<h2><span class="header-section-number">7.6</span> Wells per county over time</h2>
<p>Our next chart will be a line chart to show how the number of wells drilled has changed over time within each county.</p>
<p>Again, it will help us to think about what we are after and then build our data frame to match. In this case, we want to plot the “number of wells” for each county, by year. That means we need a data frame that has columns for county, year and the number of wells. To get that, we have to use group and summarize.</p>
<p>Sometimes it helps to write out the steps of everything before you to do it.</p>
<ul>
<li>Start with the <code>wells</code> data frame.</li>
<li>Filter to 2003 or later, because that’s when the <a href="http://www.twdb.texas.gov/groundwater/data/drillersdb.asp">system came online</a>.</li>
<li>Group by the <code>county</code> and <code>year_drilled</code> fields.</li>
<li>Summarize to create a count of the number of <code>wells_drilled</code>.</li>
<li>Set all of the above to a new data frame, <code>wells_county_year</code>.</li>
<li>Start a plot with the new data.</li>
<li>Set x (horizontal) to be year_drilled and y (vertical) to be wells_drilled, and color to be the county.</li>
</ul>
<div id="work-up-the-data-frame" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Work up the data frame</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(year_drilled <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2003</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(county, year_drilled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb60-5" data-line-number="5">    <span class="dt">wells_drilled =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">  )</a></code></pre></div>
<p>This gives you a table similar to this:</p>
<table>
<thead>
<tr class="header">
<th align="left">county</th>
<th align="left">year_drilled</th>
<th align="right">wells_drilled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Bastrop</td>
<td align="left">2003</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">Bastrop</td>
<td align="left">2004</td>
<td align="right">99</td>
</tr>
<tr class="odd">
<td align="left">Bastrop</td>
<td align="left">2005</td>
<td align="right">97</td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="left">…</td>
<td align="right">…</td>
</tr>
<tr class="odd">
<td align="left">Caldwell</td>
<td align="left">2003</td>
<td align="right">40</td>
</tr>
<tr class="even">
<td align="left">Caldwell</td>
<td align="left">2004</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Caldwell</td>
<td align="left">2005</td>
<td align="right">40</td>
</tr>
</tbody>
</table>
<p>We call this <em>long</em> data, because each row contains a single observation, instead of <em>wide</em> data, which would have a column for each observation.</p>
<p>Once you are have the data formatted, set it to fill a new data frame called <code>wells_county_year</code>.</p>
</div>
<div id="draw-the-plot" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Draw the plot</h3>
<p>Remember the formula for a basic plot:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span></a></code></pre></div>
<p>and if all our mappings are the same, they can go into the ggplot function.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">ggplot</span>(wells_county_year, <span class="kw">aes</span>(<span class="dt">x=</span>year_drilled, <span class="dt">y=</span>wells_drilled)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span>county)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Wells by county and year&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of wells&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="images/visualize-county-year-line.png" alt="Wells drilled by county by year" />
<p class="caption">Wells drilled by county by year</p>
</div>
<p>How easy would it be to add points for every year to make each data point stand out?</p>
</div>
<div id="your-turn-add-layers" class="section level3">
<h3><span class="header-section-number">7.6.3</span> Your turn: Add layers</h3>
<ul>
<li>Add a new layer <code>geom_point()</code> and see what happens</li>
<li>Add a labels layer to add a title, like we did in the bar chart above.</li>
</ul>
</div>
<div id="dates-as-numbers-and-the-problems-they-cause" class="section level3">
<h3><span class="header-section-number">7.6.4</span> Dates as numbers and the problems they cause</h3>
<p>There was one point during my work on this graphic when my x axis did not fall evenly on years, and I figured it was because the <code>year_drilled</code> field was a number and not a date. It’s possible to fix that by including the <code>library(lubridate)</code> and then mutating the year_drilled column like this:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">  <span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb63-2" data-line-number="2">    <span class="dt">year_drilled =</span> <span class="kw">ymd</span>(year_drilled, <span class="dt">truncated=</span>2L)</a>
<a class="sourceLine" id="cb63-3" data-line-number="3">  ) <span class="op">%&gt;%</span></a></code></pre></div>
</div>
</div>
<div id="your-turn-build-a-line-chart" class="section level2">
<h2><span class="header-section-number">7.7</span> Your turn: Build a line chart</h2>
<p>Now, I’d like you to build a line chart that shows how the different kinds of wells drilled has changed over time. Here’s a major hint: It’s very much like the line chart you just built, but with different columns. You’ll need so start at creating a data frame with the correct data.</p>
</div>
<div id="review-of-ggplot" class="section level2">
<h2><span class="header-section-number">7.8</span> Review of ggplot</h2>
<p>Exploring with graphics are one of the more powerful features of working with R. It takes a bit to get used to the Grammar of Graphics and ggplot2 and it will be frustrating at first. But be assured it can do about anything once you learn how, and being able to fold in these charts with your thoughts and analysis in a repeatable way will make you a better data journalist.</p>
<p>By design, every chart in ggplot starts with the same three things: data, a geometric coordinate system, and a mapping of the aesthetics, including the x and y values.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span></a></code></pre></div>
<p>If your graphic is simple, there may be less verbose ways to write it as ggplot will assume your are passing it data first, and that <code>aes()</code> functions are for mapping.</p>
</div>
<div id="plotly-for-more-interactive-graphics" class="section level2">
<h2><span class="header-section-number">7.9</span> Plotly for more interactive graphics</h2>
<p>At the risk of adding yet a little more complexity I want to introduce you to <a href="https://plot.ly/r/">Plotly</a>. I see two ways you might find Plotly interesting:</p>
<div id="ggplotly" class="section level3">
<h3><span class="header-section-number">7.9.1</span> ggplotly</h3>
<p><a href="https://plot.ly/ggplot2/">ggplotly</a> allows you to port your ggplot graphic into Plotly so they have interactive tooltips. The tutorial examples are also not bad for a general ggplot reference.</p>
<p>After installing and loading the Plotly library, giving your chart hover tips is as easy as assigning your plot to an object (<code>p</code> in the example below), and then calling that with the <code>ggplotly()</code> function:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x=</span>displ, <span class="dt">y=</span>hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="kw">ggplotly</span>(p)</a></code></pre></div>
<div class="figure">
<img src="images/visualize-ggplotly-example.png" alt="ggplotly example" />
<p class="caption">ggplotly example</p>
</div>
<p>The black label above appears when you hover on the graphic.</p>
</div>
<div id="more-with-plot_ly-function" class="section level3">
<h3><span class="header-section-number">7.9.2</span> More with <code>plot_ly()</code> function</h3>
<p>You can gain a little more control over your Plotly graphic if you build them using the <code>plot_ly()</code> function instead of <code>ggplot()</code>, but you have to learn a new syntax. It’s still based on the Grammar of Graphics, so it’s not hard … just different.</p>
<p>For example, for our “Wells by County and Year” graphic we did earlier looks like this:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">wells_county_year <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> <span class="op">~</span>year_drilled, <span class="dt">y =</span> <span class="op">~</span>wells_drilled, <span class="dt">name =</span> <span class="op">~</span>county,</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">        <span class="dt">type =</span> <span class="st">&quot;scatter&quot;</span>, <span class="dt">mode =</span> <span class="st">&quot;lines+markers&quot;</span>)</a></code></pre></div>
<p>And it ends up looking like this:</p>
<div class="figure">
<img src="images/visualize-plotly-example.png" alt="Plotly example" />
<p class="caption">Plotly example</p>
</div>
</div>
<div id="plotlys-freemium-model" class="section level3">
<h3><span class="header-section-number">7.9.3</span> Plotly’s freemium model</h3>
<p>It appears that you can use these open source libraries without charge from Plotly. They do also have a hosting service to allow you to embed charts in other websites, which can get into a pay tier of their service.</p>
</div>
</div>
<div id="resources-2" class="section level2">
<h2><span class="header-section-number">7.10</span> Resources</h2>
<ul>
<li><a href="http://ggplot2.tidyverse.org/reference/index.html">The ggplot2 documentation</a> and <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">ggplot2 cheatsheets</a>.</li>
<li><a href="https://r4ds.had.co.nz/data-visualisation.html">R for Data Science, Chap 3.</a> Hadley Wickam dives right into plots in his book.</li>
<li><a href="https://r-graphics.org/index.html">R Graphics Cookbook</a> has lots of example plots. Good to harvest code and see how to do things.</li>
<li><a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a> another place to see examples.</li>
</ul>
<!--chapter:end:07-graphics.Rmd-->
</div>
</div>
<div id="tidy" class="section level1">
<h1><span class="header-section-number">8</span> Tidy data</h1>
<p>Data “shape” can be important when you are trying to work with and visualize data. In this chapter we’ll discuss “tidy” data and how this style of organization helps us.</p>
<blockquote>
<p>Slides by Hadley Wickham are used with permission from the author.</p>
</blockquote>
<div id="goals-for-this-section-4" class="section level2">
<h2><span class="header-section-number">8.1</span> Goals for this section</h2>
<ul>
<li>Explore what it means to have “tidy” data.</li>
<li>Learn <code>gather()</code>, <code>spread()</code> and other <a href="https://tidyr.tidyverse.org/">tidyr</a> verbs.</li>
<li>Use Mixed Beverage Gross Receipts to explore shaping data.
<ul>
<li>We’ll introduce the RSocrata package to get the data.</li>
</ul></li>
<li>Explore and chart the alcohol data to practice our skills.</li>
</ul>
</div>
<div id="what-is-tidy-data" class="section level2">
<h2><span class="header-section-number">8.2</span> What is tidy data</h2>
<p>“Tidy” data is well formatted so each variable is in a column, each observation is in a row and each value is a cell. Our first step in working with any data is to make sure we are “tidy”.</p>
<div class="figure">
<img src="images/tidy-example.png" alt="Tidy data definition" />
<p class="caption">Tidy data definition</p>
</div>
<p>It’s easiest to see the difference through examples. The data frame below is of tuberculosis reports from the World Health Organization.</p>
<ul>
<li>Each row is a set of observations (or case) from a single country for a single year.</li>
<li>Each column describes a unique variable. The year, the number of cases and the population of the country at that time.</li>
</ul>
<div class="figure">
<img src="images/tidy-table-tidy.png" alt="A tidy table" />
<p class="caption">A tidy table</p>
</div>
<p>Table2 below isn’t tidy. The <strong>count</strong> column contains two different type of values.</p>
<div class="figure">
<img src="images/tidy-table-nottidy.png" alt="A tidy table" />
<p class="caption">A tidy table</p>
</div>
<p>When our data is tidy, it is easy to manipulate. We can use functions like <code>mutate()</code> to calculate new values for each case.</p>
<div class="figure">
<img src="images/tidy-table-manipulate.png" alt="Manipulate a tidy table" />
<p class="caption">Manipulate a tidy table</p>
</div>
</div>
<div id="tidyr-package" class="section level2">
<h2><span class="header-section-number">8.3</span> Tidyr package</h2>
<p>When our data is tidy, we can use the <a href="https://tidyr.tidyverse.org/">tidyr</a> package to reshape the layout of our data to suit our needs.</p>
<p>In the figure below, the table on the left is “wide”. There are are multiple year columns describing the same variable. It might be useful if we want to calculate the difference of the values for two different years. It’s less useful if we want plot on a graphic because we don’t have columns to map as X and Y values.</p>
<p>The table on the right is “long”, in that each column describes a single variable. It is this shape we need when we want to plot values on a chart. We can then set our “Year” column as an X axis, our “n” column on our Y axis, and group by the “Country”.</p>
<div class="figure">
<img src="images/tidy-wide-vs-long.png" alt="Wide vs long" />
<p class="caption">Wide vs long</p>
</div>
</div>
<div id="the-tidyr-verbs" class="section level2">
<h2><span class="header-section-number">8.4</span> The tidyr verbs</h2>
<p>We’ll use functions within the <a href="https://tidyr.tidyverse.org/">tidyr</a> package to manipulate data to our liking, depending on our need.</p>
<div class="figure">
<img src="images/tidy-verbs.png" alt="Tidy verbs" />
<p class="caption">Tidy verbs</p>
</div>
</div>
<div id="set-up-the-mixbev-project" class="section level2">
<h2><span class="header-section-number">8.5</span> Set up the mixbev project</h2>
<p>We’re going to work in a new project with new data for this assignment. I will try to get you up and running as quickly as possible.</p>
<ul>
<li>In RStudio, choose File &gt; New Project</li>
<li>Walk through the steps to create a New Project in a New Directory called <code>yourname-mixbev</code>.</li>
<li>Once you have your project, create a new RNotebook. Save the file and name it <code>01-mixbev-import.Rmd</code>.</li>
<li>Go to <a href="https://gist.githubusercontent.com/critmcdonald/151e1fa44c82ea5ca337b204cfc095d6/raw/c475fcce8b701cd03721dc1c753724c6e4636cd1/01-mixbev-import.Rmd">this link</a> and copy the text and replace everything in your RNotebook.</li>
</ul>
<p>There are a couple of things we need to do before you run this notebook:</p>
<ul>
<li>In the R Console, run <code>install.packages(&quot;RSocrata&quot;)</code></li>
<li>Use the Files pane to create a new folder called <code>data-raw</code> so we have a place to save our data.</li>
<li>Now use <strong>Cmd-option-R</strong> (or go to Run &gt; Run All) to run the notebook.</li>
</ul>
<p>Running that notebook will download three years of data from Travis County establishments and save it into your <code>data-raw</code> folder in your project. How that is done is all documented in that notebook, but we may spend some time in class explaining going over it.</p>
</div>
<div id="create-an-explore-notebook" class="section level2">
<h2><span class="header-section-number">8.6</span> Create an explore notebook</h2>
<p>Now that we have data we don’t have to download it again. Let’s create a new RNotebook to import and explore it (and learn Tidyr while we are at it).</p>
<ul>
<li>Create a new RNotebook. Save the file as <code>02-mixbev-explore.Rmd</code>.</li>
<li>Update the title in the metadata.</li>
<li>Remove the boilerplate below the data.</li>
<li>Add the code below, then <strong>Restart R and Run All Chunks</strong>.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb67-4" data-line-number="4"></a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="co"># import the data</span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6">receipts &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data-raw/receipts_api.rds&quot;</span>)</a></code></pre></div>
<div id="peruse-the-data" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Peruse the data</h3>
<p>In the environment window, click on the <strong>receipts</strong> data frame so it opens and you can look at the data. Some key things to know about the data:</p>
<ul>
<li>Columns with <strong><code>location_</code></strong> are about a specific restaurant or bar selling alcohol.</li>
<li>Columns with <strong><code>taxpayer_</code></strong> are about the owners of that establishment.</li>
<li>The monetary amounts for <strong><code>_receipts</code></strong> are total sales numbers for that establishment in that month.</li>
<li>The <strong><code>obligation_end_date</code></strong> is the last day of the month for those sales.</li>
<li>The liquor type sales like beer and wine <em>should</em> all add up to the <strong>total_receipts</strong>, but sometimes type sales are blank. I don’t trust <strong>cover_charge_receipts</strong> at all.</li>
<li>There are several other columns we won’t deal with in this lesson.</li>
</ul>
<p>So these are NOT the number of drinks sold. It’s the amount of money brought in for the total sale of each type of liquor within that month. The <strong>total_receipts</strong> is used to calculate tax paid to the state on those sales based on a formula. See the record layout on <a href="https://data.texas.gov/Government-and-Taxes/Mixed-Beverage-Gross-Receipts/naix-2893">Socrata</a> for more information.</p>
</div>
</div>
<div id="what-might-we-learn-about-this-dataset" class="section level2">
<h2><span class="header-section-number">8.7</span> What might we learn about this dataset</h2>
<p>If we look at the data set, there are a series of questions we might ask it.</p>
<ul>
<li>How have total sales changed over the past three years?</li>
<li>Who has sold the most alcohol over the past three years?</li>
<li>Which campus-area bars have sold the most, and what are their sales trends?</li>
<li>Do these campus-area bars sell more beer, wine or liquor?</li>
<li>Have the number of establishments that sell alcohol increased? If so, where?</li>
</ul>
<p>There are others for sure, but for this lesson we’ll concentrate on campus-area bars you <em>might</em> be familiar with.</p>
</div>
<div id="add-years-and-months-values" class="section level2">
<h2><span class="header-section-number">8.8</span> Add years and months values</h2>
<p>We will end up doing a lot of summaries based on year and month of the data. It will be easier to do that if we create some new columns that have those values.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">receipts &lt;-<span class="st"> </span>receipts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">    <span class="co"># sales_year = year(obligation_end_date_yyyymmdd),</span></a>
<a class="sourceLine" id="cb68-4" data-line-number="4">    <span class="dt">sales_year =</span> <span class="kw">year</span>(obligation_end_date_yyyymmdd) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>(),</a>
<a class="sourceLine" id="cb68-5" data-line-number="5">    <span class="dt">sales_month =</span> <span class="kw">month</span>(obligation_end_date_yyyymmdd, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb68-6" data-line-number="6">  )</a></code></pre></div>
<blockquote>
<p>I specifically coerced <code>sales_year</code> into a string because the year as a continuous number was causing problems with plots later when I got an axis mark for “2016.5”. Probably not the best solution, but it worked.</p>
</blockquote>
</div>
<div id="campus-bars" class="section level2">
<h2><span class="header-section-number">8.9</span> Campus bars</h2>
<p>Let’s take a look at sales around campus. Make a data frame of just the receipts from the 78705 area.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">uni_area &lt;-<span class="st"> </span>receipts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb69-3" data-line-number="3">    location_zip  <span class="op">==</span><span class="st"> &#39;78705&#39;</span></a>
<a class="sourceLine" id="cb69-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb69-5" data-line-number="5"></a>
<a class="sourceLine" id="cb69-6" data-line-number="6"><span class="co"># peek at the result</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7">uni_area <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<div id="total-78705-sales-leaders-in-2018" class="section level3">
<h3><span class="header-section-number">8.9.1</span> Total 78705 sales leaders in 2018</h3>
<p>Let’s make a quick table to add <code>total_receipts</code> for 2018 so we can find the top selling bars from last year. We can do that by filtering for 2018, grouping by location and address, and then summing together the total receipts.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">uni_area <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(sales_year <span class="op">==</span><span class="st"> </span><span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(location_name, location_address) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb70-5" data-line-number="5">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb70-6" data-line-number="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_sales)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-8" data-line-number="8"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<p>And we get this:</p>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>location_address</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EXECUTIVE EDUCATION AND CONFERENCE CENTER</td>
<td>1900 UNIVERSITY AVE</td>
<td>1684571</td>
</tr>
<tr class="even">
<td>SPIDER HOUSE</td>
<td>2908 FRUTH ST</td>
<td>1575812</td>
</tr>
<tr class="odd">
<td>CAIN &amp; ABEL’S</td>
<td>2313 RIO GRANDE ST</td>
<td>1051230</td>
</tr>
<tr class="even">
<td>TRUDY’S TEXAS STAR CAFE</td>
<td>409 W 30TH ST</td>
<td>1012269</td>
</tr>
<tr class="odd">
<td>THE HOLE IN THE WALL</td>
<td>2538 GUADALUPE ST</td>
<td>827799</td>
</tr>
<tr class="even">
<td>HOTEL ELLA/GOODAL’S KITCHEN &amp; BAR</td>
<td>1900 RIO GRANDE ST</td>
<td>707431</td>
</tr>
<tr class="odd">
<td>DOC’S MOTORWORKS 38TH</td>
<td>1106 W 38TH ST</td>
<td>561019</td>
</tr>
<tr class="even">
<td>THE LOCAL PUB AND PATIO</td>
<td>2610 GUADALUPE ST</td>
<td>544261</td>
</tr>
<tr class="odd">
<td>VIA 313 PIZZA RESTAURANT II</td>
<td>3016 GUADALUPE ST</td>
<td>531878</td>
</tr>
<tr class="even">
<td>THE BACK LOT</td>
<td>606 MAIDEN LN</td>
<td>494638</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="west-campus-student-hot-spots" class="section level2">
<h2><span class="header-section-number">8.10</span> West Campus student hot spots</h2>
<p>Looking at the list above, let’s filter our original data to some top student hangouts that we know are still open.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">student_bars &lt;-<span class="st"> </span>receipts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">    location_name <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb71-4" data-line-number="4">      <span class="st">&quot;SPIDER HOUSE&quot;</span>,</a>
<a class="sourceLine" id="cb71-5" data-line-number="5">      <span class="st">&quot;CAIN &amp; ABEL&#39;S&quot;</span>,</a>
<a class="sourceLine" id="cb71-6" data-line-number="6">      <span class="st">&quot;TRUDY&#39;S TEXAS STAR CAFE&quot;</span>,</a>
<a class="sourceLine" id="cb71-7" data-line-number="7">      <span class="st">&quot;THE HOLE IN THE WALL&quot;</span>,</a>
<a class="sourceLine" id="cb71-8" data-line-number="8">      <span class="st">&quot;THE LOCAL PUB AND PATIO&quot;</span></a>
<a class="sourceLine" id="cb71-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb71-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb71-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb71-12" data-line-number="12"><span class="co"># check the results</span></a>
<a class="sourceLine" id="cb71-13" data-line-number="13">student_bars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(location_name, location_address)</a></code></pre></div>
<p>Note the <code>filter()</code> function above. In order to feed in a list of location names into the filter, I used the <code>%in%</code> operator (instead of <code>==</code>) and I put list of locations into a <code>c()</code> function. The C stands for concatenate, FWIW.</p>
<p>After creating the <code>student_bars</code> data frame above, I used <code>count()</code> to make sure we caught all the bars and made sure each had the same number of reports. Which looks like this:</p>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>location_address</th>
<th>n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CAIN &amp; ABEL’S</td>
<td>2313 RIO GRANDE ST</td>
<td>36</td>
</tr>
<tr class="even">
<td>SPIDER HOUSE</td>
<td>2908 FRUTH ST</td>
<td>36</td>
</tr>
<tr class="odd">
<td>THE HOLE IN THE WALL</td>
<td>2538 GUADALUPE ST</td>
<td>36</td>
</tr>
<tr class="even">
<td>THE LOCAL PUB AND PATIO</td>
<td>2610 GUADALUPE ST</td>
<td>36</td>
</tr>
<tr class="odd">
<td>TRUDY’S TEXAS STAR CAFE</td>
<td>409 W 30TH ST</td>
<td>36</td>
</tr>
</tbody>
</table>
<p>Note I didn’t save the <code>count()</code> function back to the data frame. I just viewed that to the notebook so we could check our work.</p>
</div>
<div id="campus-area-bar-sales-over-time" class="section level2">
<h2><span class="header-section-number">8.11</span> Campus-area bar sales over time</h2>
<div id="visualizing-your-visualization" class="section level3">
<h3><span class="header-section-number">8.11.1</span> Visualizing your visualization</h3>
<p>Now, if we are interested in charting it helps to think about what we need and how to shape our data to get it.</p>
<p>Let’s start with charting <strong>how sales at each bar have changed over the past three years</strong>. Since we are looking at value over time for multiple things, a line chart will probably work best.</p>
<p>If our basic line chart works like this:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="op">&lt;</span>DATA<span class="op">&gt;</span>, <span class="kw">aes</span>(<span class="dt">x=</span><span class="op">&lt;</span>COL_VALUE<span class="op">&gt;</span>, <span class="dt">y=</span><span class="op">&lt;</span>COL_VALUE<span class="op">&gt;</span>, <span class="dt">group=</span><span class="op">&lt;</span>COL_VALUE<span class="op">&gt;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p>We need to figure out how to configure our data to fit the chart.</p>
<ul>
<li>For the “X” value (horizontal) we have the <code>sales_year</code> field to track over time.</li>
<li>For the “Y” value (vertical) we want the total sales of each bar for that year. We’ll need to do a summary to get that.</li>
<li>We want a line for each campus bar, which means we need a column for <code>location_name</code> for our “group”, too.</li>
</ul>
<p>We create this data frame by using our <code>group_by()</code> on <code>location_name</code> and <code>sales_year</code> and then <code>summarize()</code> to get our total sales by our grouping:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">student_bars_grouped &lt;-<span class="st"> </span>student_bars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(location_name, sales_year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb73-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb73-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb73-7" data-line-number="7"><span class="co"># peek at the results</span></a>
<a class="sourceLine" id="cb73-8" data-line-number="8">student_bars_grouped <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<p>Which ends up looking this this:</p>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>sales_year</th>
<th align="right">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CAIN &amp; ABEL’S</td>
<td>2016</td>
<td align="right">896114</td>
</tr>
<tr class="even">
<td>CAIN &amp; ABEL’S</td>
<td>2017</td>
<td align="right">990631</td>
</tr>
<tr class="odd">
<td>CAIN &amp; ABEL’S</td>
<td>2018</td>
<td align="right">1051230</td>
</tr>
<tr class="even">
<td>SPIDER HOUSE</td>
<td>2016</td>
<td align="right">1797800</td>
</tr>
<tr class="odd">
<td>SPIDER HOUSE</td>
<td>2017</td>
<td align="right">1721580</td>
</tr>
<tr class="even">
<td>SPIDER HOUSE</td>
<td>2018</td>
<td align="right">1575812</td>
</tr>
</tbody>
</table>
<p>Now we can plug in our columns to get our chart:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">ggplot</span>(student_bars_grouped, <span class="kw">aes</span>(<span class="dt">x=</span>sales_year, <span class="dt">y=</span>total_sales, <span class="dt">group=</span>location_name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span>location_name)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb74-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>comma)</a></code></pre></div>
<div class="figure">
<img src="images/tidy-campus-bars-over-time.png" alt="Campus bar sales over time" />
<p class="caption">Campus bar sales over time</p>
</div>
<p>We’ve added a couple of do-dads to our line chart to make it prettier, like adding a color aesthetic the <code>geom_line()</code> function to color the lines and give us a legend, and a scale with labels to make the Y numbers pretty.</p>
</div>
<div id="what-did-we-find" class="section level3">
<h3><span class="header-section-number">8.11.2</span> What did we find?</h3>
<p>Looking at the chart, we can see that Cain &amp; Abel’s is the only top campus-area bar with an increase in alcohol sales over each of the past three years. The Hole in the Wall did have a good 2018, reversing a downward trend. Everywhere else dropped sales each year.</p>
</div>
</div>
<div id="types-of-sales-within-student-bars" class="section level2">
<h2><span class="header-section-number">8.12</span> Types of sales within student bars</h2>
<p>If we want to see how beer, liquor and wine sales differ at an establishment, we could use a very similar chart, but we would want each line to be the type of alcohol: beer, wine or liquor.</p>
<p>But this is how our columns look right now. Beer, wine and liquor are separate columns.</p>
<div class="figure">
<img src="images/tidy-receipt-cols.png" alt="Sales columns" />
<p class="caption">Sales columns</p>
</div>
<p>This is where we introduce <code>gather()</code> from tidyr so we can shape our data to meet our needs.</p>
</div>
<div id="how-gather-works" class="section level2">
<h2><span class="header-section-number">8.13</span> How gather() works</h2>
<p>The <a href="https://tidyr.tidyverse.org/reference/gather.html"><code>gather()</code></a> function is what we use to change wide data into long data. We are “gathering” all the extra columns into two: one for the value and one to describe it. In the example below, a <strong>key</strong> column is created called “Year” and a <strong>value</strong> column called “n” is created to hold the values from each of the yearly columns. For each value, a new row is created, and the column name is used for the “key” and the data is use for the “value”.</p>
<div class="figure">
<img src="images/tidy-gather-show.png" alt="Show how gather works" />
<p class="caption">Show how gather works</p>
</div>
<p>We can see how this works by tracking a single value from one shape to the other:</p>
<div class="figure">
<img src="images/tidy-wide-vs-long.png" alt="Show gather with single value" />
<p class="caption">Show gather with single value</p>
</div>
<p>Now, how do we define this in code?</p>
<div class="figure">
<img src="images/tidy-gather-function.png" alt="Gather as a function" />
<p class="caption">Gather as a function</p>
</div>
<p>We are, of course, starting with the data frame and then piping it into the <code>gather()</code> function. The first value we have to give the function is to name our <strong>key</strong> column.</p>
<div class="figure">
<img src="images/tidy-name-key.png" alt="Name the key column" />
<p class="caption">Name the key column</p>
</div>
<p>And the next value we give it is name of the <strong>value</strong> column.</p>
<div class="figure">
<img src="images/tidy-name-value.png" alt="Name the value column" />
<p class="caption">Name the value column</p>
</div>
<p>Then we have to give it the <strong>range of columns</strong> that we want to gather. You can define those in different ways.</p>
<p>The first method is a number range of the columns, starting in order of the columns in the data frame. So, for our example above, we want the second, third and fourth column, so we use the range <code>2:4</code>.</p>
<div class="figure">
<img src="images/tidy-name-range.png" alt="Name the range" />
<p class="caption">Name the range</p>
</div>
<p>Or, we could supply those columns in other ways, like by their column names:</p>
<div class="figure">
<img src="images/tidy-name-namerange.png" alt="Range as column names" />
<p class="caption">Range as column names</p>
</div>
<p>Or by specifying which columns we <em>don’t</em> want to gather:</p>
<div class="figure">
<img src="images/tidy-name-deselect.png" alt="Range through deselect" />
<p class="caption">Range through deselect</p>
</div>
</div>
<div id="applying-gather-to-beer-wine-and-liquor" class="section level2">
<h2><span class="header-section-number">8.14</span> Applying gather() to beer, wine and liquor</h2>
<p>Let’s start by making a new data frame with just the columns we need to work with. We are starting with the <code>student_bars</code> data frame we created that has the three years of receipts from just our five campus-area bars:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">student_sales &lt;-<span class="st"> </span>student_bars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(location_name, sales_year, beer_receipts, wine_receipts, liquor_receipts) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb75-4" data-line-number="4">    <span class="dt">beer =</span> beer_receipts,</a>
<a class="sourceLine" id="cb75-5" data-line-number="5">    <span class="dt">wine =</span> wine_receipts,</a>
<a class="sourceLine" id="cb75-6" data-line-number="6">    <span class="dt">liquor =</span> liquor_receipts</a>
<a class="sourceLine" id="cb75-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb75-8" data-line-number="8">student_sales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>() <span class="co"># to show our results</span></a></code></pre></div>
<p>We get a result like this:</p>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>sales_year</th>
<th>beer</th>
<th>wine</th>
<th>liquor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>THE LOCAL PUB AND PATIO</td>
<td>2018</td>
<td>24832</td>
<td>163</td>
<td>14202</td>
</tr>
<tr class="even">
<td>THE LOCAL PUB AND PATIO</td>
<td>2017</td>
<td>27702</td>
<td>470</td>
<td>16086</td>
</tr>
<tr class="odd">
<td>THE HOLE IN THE WALL</td>
<td>2018</td>
<td>30374</td>
<td>370</td>
<td>32533</td>
</tr>
<tr class="even">
<td>THE HOLE IN THE WALL</td>
<td>2017</td>
<td>34232</td>
<td>174</td>
<td>32789</td>
</tr>
<tr class="odd">
<td>THE HOLE IN THE WALL</td>
<td>2018</td>
<td>49320</td>
<td>252</td>
<td>42080</td>
</tr>
<tr class="even">
<td>CAIN &amp; ABEL’S</td>
<td>2016</td>
<td>34239</td>
<td>456</td>
<td>42543</td>
</tr>
</tbody>
</table>
<p>Now, if we can “gather” the beer, wine and liquor columns into two new columns – alcohol type and sales amount – then we could group and sum by the year and type.</p>
<p>The code below builds the new data frame we’ll use for our chart (<code>student_sales_grouped</code>) but you skip the beginning data frame assignment and walk through it line by line to see how it gets built, starting with the <code>student_sales</code> data frame. Once you have it, then assign it back to <code>student_sales_group</code>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">student_sales_grouped &lt;-<span class="st"> </span>student_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(alcohol_type, sales_by_type, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(location_name, sales_year, alcohol_type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb76-5" data-line-number="5">    <span class="dt">sales_sum_year =</span> <span class="kw">sum</span>(sales_by_type)</a>
<a class="sourceLine" id="cb76-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb76-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="co"># peek at the result</span></a>
<a class="sourceLine" id="cb76-9" data-line-number="9">student_sales_grouped <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>() </a></code></pre></div>
<ul>
<li>We start with the <code>student_sales</code> data frame, where each row has the sales for each month of the year in multiple columns.</li>
<li><code>gather()</code> names our fields “alcohol_type” and “sales_by_type” and gathers our beer, wine and liquor columns. At this point, each row of data has the individual sale of a type of alcohol for each month of each year.</li>
<li><code>group_by()</code> collects our data by the name, year and type. This prepares us to:</li>
<li><code>summarize()</code> adds together all the beer sales for each month are summed up into one row for each year.</li>
</ul>
<div id="plot-sales-by-type-for-a-single-campus-area-bar" class="section level3">
<h3><span class="header-section-number">8.14.1</span> Plot sales by type for a single campus-area bar</h3>
<p>Let’s figure out the line chart with one establishment first:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">cain &lt;-<span class="st"> </span>student_sales_grouped <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(location_name <span class="op">==</span><span class="st"> &quot;CAIN &amp; ABEL&#39;S&quot;</span>)</a>
<a class="sourceLine" id="cb77-3" data-line-number="3"></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw">ggplot</span>(cain, <span class="kw">aes</span>(<span class="dt">x=</span>sales_year, <span class="dt">y=</span>sales_sum_year, <span class="dt">group=</span>alcohol_type, <span class="dt">color=</span>alcohol_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p>We get our chart like this:</p>
<div class="figure">
<img src="images/tidy-cain-chart.png" alt="Cain &amp; Abel’s alcohol sales" />
<p class="caption">Cain &amp; Abel’s alcohol sales</p>
</div>
</div>
<div id="plot-sales-by-type-for-multiple-campus-area-bars" class="section level3">
<h3><span class="header-section-number">8.14.2</span> Plot sales by type for multiple campus-area bars</h3>
<p>For this chart, we are going to duplicate what we did for the graphic above, and then instead of applying to the <code>cain</code> data frame, we’ll substitute in our our <code>student_sales_grouped</code> data frame so have all the West Campus bars.</p>
<p>And now we can introduce the <code>facet_wrap()</code>, which allows you to duplicate a graphic based on one of the categories in the data. We feed the <code>facet_wrap()</code> function with the variable (the column name) we want to duplicate. Weirdly, it has to start with a tilde, like this: <code>facet_wrap(~location_name)</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">ggplot</span>(student_sales_grouped, <span class="kw">aes</span>(<span class="dt">x=</span>sales_year, <span class="dt">y=</span>sales_sum_year, <span class="dt">group=</span>alcohol_type, <span class="dt">color=</span>alcohol_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>location_name) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label=</span>comma)</a></code></pre></div>
<div class="figure">
<img src="images/tidy-student-bars-wrapped.png" alt="Student bars as a facet wrap" />
<p class="caption">Student bars as a facet wrap</p>
</div>
</div>
<div id="what-did-we-learn" class="section level3">
<h3><span class="header-section-number">8.14.3</span> What did we learn?</h3>
<p>Liquor sales are what is driving Cain &amp; Abel’s increase in revenue. Wine sales are pretty low everywhere and Trudy’s really sells a lot of liquor. It’s those Mexican Martinis and Margaritas, I imagine.</p>
</div>
</div>
<div id="the-spread-function" class="section level2">
<h2><span class="header-section-number">8.15</span> The spread() function</h2>
<p>There is another tidyr function called <a href="https://tidyr.tidyverse.org/reference/spread.html"><code>spread()</code></a> that does the opposite of <code>gather()</code>. We won’t do an example with this lesson, but this is how it generally works.</p>
<div class="figure">
<img src="images/tidy-spread-function.png" alt="The spread() function" />
<p class="caption">The spread() function</p>
</div>
<div class="figure">
<img src="images/tidy-spread-example.png" alt="A spread() example" />
<p class="caption">A spread() example</p>
</div>
</div>
<div id="practice-assignment-exploring-the-top-seller" class="section level2">
<h2><span class="header-section-number">8.16</span> Practice assignment: Exploring the top seller</h2>
<p>This assignment looks a little further into some specific establishments from the Mixed Beverage Data. Here are the directions, with lots of hints thrown in.</p>
<ul>
<li>Create a new notebook called “03-practice.Rmd”. Use the same libraries and data as the in-class assignment.</li>
<li>Find the establishment with highest total receipts in last three years. See the first Bonus section below for the the code.</li>
<li>For the top establishment found, <strong>create a bar chart with sales by year</strong>. Here are some hints:
<ul>
<li>Start with <code>receipts</code>, then filter by the <code>location_name</code> and the <code>location_address</code>. (You have to include <code>location_address</code> because there is more than one location in Ausitn for this chain.) Assign that to a data frame that you can use going forward.</li>
<li>Group by <code>sales_year</code>, then summarize to get the <code>sum(total_receipts)</code>. Review <a href="https://utdata.github.io/rwd-class/transform.html#summarize">Summarize</a> if needed. Save the result into a new data frame.</li>
<li>Use <code>ggplot()</code> with <code>geom_bar(stat=&quot;identity&quot;)</code>. Review the less verbose <a href="https://utdata.github.io/rwd-class/graphics.html#plot-our-wells-by-county">wells by county</a> for an example of how to write the plot.</li>
</ul></li>
<li>For that top establishment, <strong>create a bar chart with total_receipts each month</strong>. Some hints:
<ul>
<li>Don’t over think this. You already have a filtered data set, and you can plot the x axis on the <code>obligation_end_date_yyyymmdd</code>.</li>
</ul></li>
<li>Because the chart shows trends but it’s hard to see the values for the top months, <strong>create a table showing the top monthly total sales by month</strong>. Some hints:
<ul>
<li>Select the <code>oblibgation_end_date_yyyymmdd</code> and arrange the <code>total_receipts</code> in descending order. Show just the top by piping into <code>head()</code></li>
</ul></li>
<li>For that establishment, <strong>create a line chart with sales by alcohol type by year</strong>. This one is more challenging, but you have everything you need in the chapter when we did this for Cain &amp; Abel’s. Here are some hints:
<ul>
<li>You can start from the the filtered data that you did with the previous chart.</li>
<li>Create a new data frame with just the columns you need: select name, sales_year, beer, wine, liquor</li>
<li>Use <code>gather()</code> to collect the beer, wine, liquor columns as <code>alcohol_type</code> and <code>sales_by_type</code>. This is the same as we did in class.</li>
<li>Group by <code>sales_year</code>, <code>alcohol_type</code>.</li>
<li>Summarize to get the <code>sales_sum_year</code>.</li>
<li>Plot as a geom_line chart with x=sales_year, y=sales_sum_year, group and color as alcohol_type.</li>
</ul></li>
<li>Lastly, to show that once you have code you can re-purpose it, <strong>create a line chart of sales by alcohol type by year for the Circuit of the Americas</strong>. Your hint:
<ul>
<li>Create a new data frame with just the Circuit of the Americas data.</li>
<li>Copy the steps from the last chart, and change out the data frame name.</li>
</ul></li>
</ul>
</div>
<div id="bonus-top-5-sellers-in-travis-county-over-three-years" class="section level2">
<h2><span class="header-section-number">8.17</span> Bonus: Top 5 sellers in Travis County over three years</h2>
<p>Because some chains might have that same <code>location_name</code> but more than one location, we need to group by both the <code>location_name</code> and the <code>location_address</code> fields. Then we can summarize their total sales.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">receipts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(location_name, location_address) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb79-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_sales)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-7" data-line-number="7"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</a></code></pre></div>
<p>Which gives you something like this:</p>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>location_address</th>
<th align="right">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WLS BEVERAGE CO</td>
<td>110 E 2ND ST</td>
<td align="right">35878211</td>
</tr>
<tr class="even">
<td>RYAN SANDERS SPORTS</td>
<td>9201 CIRCUIT OF THE AMERICAS BLVD</td>
<td align="right">20714630</td>
</tr>
<tr class="odd">
<td>W HOTEL AUSTIN</td>
<td>200 LAVACA ST</td>
<td align="right">15435458</td>
</tr>
<tr class="even">
<td>ROSE ROOM/ 77 DEGREE</td>
<td>11500 ROCK ROSE AVE</td>
<td align="right">14726420</td>
</tr>
<tr class="odd">
<td>THE DOGWOOD DOMAIN</td>
<td>11420 ROCK ROSE AVE STE 700</td>
<td align="right">14231072</td>
</tr>
</tbody>
</table>
<p>What exactly is that top location? (Google it). It looks like that location (hint: a hotel) has sold more that twice the amount as the next hotel.</p>
<p>What is the second location? That could be pretty interesting to look further into as well.</p>
</div>
<div id="bonus-total-sales-by-county" class="section level2">
<h2><span class="header-section-number">8.18</span> Bonus: Total sales by county</h2>
<p>So, are alcohol sales going up in Travis County? We can use our new <code>sales_year</code> column to group the data and summarize by the sum of <code>total_sales</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">receipts <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sales_year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb80-4" data-line-number="4">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb80-5" data-line-number="5">  )</a></code></pre></div>
<p>If you want to <em>see</em> the result, we can plot as a bar chart. I’m repeating our code above, but then shoving it into a new data frame, which we use to plot.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">receipts_group_all &lt;-<span class="st"> </span>receipts <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(sales_year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb81-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb81-6" data-line-number="6"></a>
<a class="sourceLine" id="cb81-7" data-line-number="7"><span class="kw">ggplot</span>(receipts_group_all, <span class="kw">aes</span>(<span class="dt">x=</span>sales_year, <span class="dt">y=</span>total_sales)) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>comma)</a></code></pre></div>
<p>The last line in the plot comes from the <a href="https://www.rdocumentation.org/packages/scales/versions/0.4.1">scales</a> package and it gives us pretty numbers on the Y axis.</p>
<p>If you are writing a story about alcohol sales in Travis County over the last three years, you can say that sales have risen over each year. You might go further and compare the sales to the population over the same time period, but we’ll skip that for now.</p>
<!--chapter:end:08-tidy.Rmd-->
</div>
</div>
<div id="reordering-factors" class="section level1">
<h1><span class="header-section-number">9</span> Reordering factors</h1>
<p>There is a complexity within R data frames that we need to cover becomes it comes into play when we want to order categorical data within graphics.</p>
<p>We are going to handle this through a new project using our Survey data from class.</p>
<div id="goals-for-this-section-5" class="section level2">
<h2><span class="header-section-number">9.1</span> Goals for this section</h2>
<ul>
<li>Create a new project with our class survey data.</li>
<li>Create a chart that uses categorical data.</li>
<li>Reorder the values in the chart using <code>fct_reorder()</code>.</li>
</ul>
<p>This is the chart we want to build:</p>
<div class="figure">
<img src="images/factors-graphic-example.png" alt="Popular princesses" />
<p class="caption">Popular princesses</p>
</div>
</div>
<div id="create-our-survey-project" class="section level2">
<h2><span class="header-section-number">9.2</span> Create our survey project</h2>
<div id="setup" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Setup</h3>
<ul>
<li>In RStudio, choose File &gt; New Project</li>
<li>Walk through the steps to create a New Project in a New Directory called <code>yourname-survey</code>.</li>
<li>In your project, create a new directory called <code>data-raw</code>.</li>
<li>Go to <a href="https://github.com/utdata/rwd-mastery-assignments/blob/master/survey-results/survey-results-2019-01-sp.csv?raw=true">this link</a> in a browser. Do <strong>File &gt; Save page as</strong> and save the file inside your <code>data-out</code> folder as <code>survey-results.csv</code>.</li>
<li>Create a new RNotebook. Save the file and name it <code>01-survey.Rmd</code>. For this simple example, we’ll only be using one notebook.</li>
</ul>
</div>
<div id="libraries" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Libraries</h3>
<p>We need two libraries. I <em>think</em> the <strong>forcats</strong> library is already installed, but if not you’ll have to run the following in your RConsole: <code>install.packages(&quot;forcats&quot;)</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="kw">library</span>(forcats)</a></code></pre></div>
</div>
<div id="import-the-data" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Import the data</h3>
<p>Import the data from the csv</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">survey &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data-raw/survey-results.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">clean_names</span>()</a>
<a class="sourceLine" id="cb83-2" data-line-number="2"></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="co"># peek at the data</span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4">survey <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<p>Peeking at the data, we see it is something like this:</p>
<table>
<thead>
<tr class="header">
<th>class</th>
<th>graduating</th>
<th>ice_cream</th>
<th>princess</th>
<th>computer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Senior</td>
<td>Yes</td>
<td>Cookies &amp; Cream</td>
<td>Mulan</td>
<td>Macintosh</td>
</tr>
<tr class="even">
<td>Masters candidate</td>
<td>Yes</td>
<td>Rocky Road</td>
<td>Mulan</td>
<td>Windows</td>
</tr>
<tr class="odd">
<td>Senior</td>
<td>Yes</td>
<td>Chocolate</td>
<td>Ariel (Little Mermaid)</td>
<td>Windows</td>
</tr>
<tr class="even">
<td>Senior</td>
<td>No</td>
<td>Mint chocolate chip</td>
<td>Mulan</td>
<td>Macintosh</td>
</tr>
<tr class="odd">
<td>Junior</td>
<td>No</td>
<td>Mint chocolate chip</td>
<td>Jasmine (Aladdin)</td>
<td>Windows</td>
</tr>
<tr class="even">
<td>Senior</td>
<td>No</td>
<td>Mint chocolate chip</td>
<td>Rapunzel (Tangled)</td>
<td>Macintosh</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="figuring-out-our-data-shape" class="section level2">
<h2><span class="header-section-number">9.3</span> Figuring out our data shape</h2>
<p>As we’ve talked about before, it is helpful to think of what we want the graphic to be, even to draw it out, so we can figure out what columns we need for the X and Y axis.</p>
<p>The example I showed above is a little weird in that we are really building a bar/column chart, but we’ve turned sideways so we can read the labels. To build the chart, we are really looking at this:</p>
<div class="figure">
<img src="images/factors-before-flip.png" alt="Princess before flip" />
<p class="caption">Princess before flip</p>
</div>
<ul>
<li>What do we need for the x value? Well, we need the <strong>total votes</strong> for each princess.</li>
<li>What do we need for the y value? We need to list each <strong>princess</strong> that got votes.</li>
</ul>
</div>
<div id="charting-the-popularity-of-princess" class="section level2">
<h2><span class="header-section-number">9.4</span> Charting the popularity of princess</h2>
<p>So, we need a <code>princess</code> column and a <code>votes</code> column. These easiest way to do this is a simple <code>count()</code> summary. Build the count <em>before</em> you assign it back to <code>princess_count</code> so you see what is happening, but this is similar to what we’ve done in the past.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">princess_count &lt;-<span class="st"> </span>survey <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(princess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">votes =</span> n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(votes))</a>
<a class="sourceLine" id="cb84-5" data-line-number="5"></a>
<a class="sourceLine" id="cb84-6" data-line-number="6"><span class="co"># peak</span></a>
<a class="sourceLine" id="cb84-7" data-line-number="7">princess <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<p>In order, we are:</p>
<ul>
<li>Assigning the result (which you do at the end), starting from <code>survey</code>.</li>
<li>Count the rows of each princess.</li>
<li>Rename the <code>n</code> column to <code>votes</code>.</li>
<li>Arrange so the most votes are on top.</li>
</ul>
<p>We get this:</p>
<table>
<thead>
<tr class="header">
<th>princess</th>
<th align="right">votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mulan</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td>Rapunzel (Tangled)</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td>Jasmine (Aladdin)</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td>Ariel (Little Mermaid)</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td>Tiana (Princess and the Frog)</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>Aurora (Sleeping Beauty)</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Belle (Beauty and the Beast)</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td>Merida (Brave)</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Snow White</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="create-our-princess-plot" class="section level2">
<h2><span class="header-section-number">9.5</span> Create our princess plot</h2>
<p>We are going to use a new chart, <code>geom_col</code>, which is like <code>geom_bar</code> but it already understands the <code>stat=&quot;identity&quot;</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">princess_count <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> princess, <span class="dt">y =</span> votes)) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Favorite Disney Princesses in class&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Princess&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Votes&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> votes), <span class="dt">hjust=</span><span class="op">-</span>.<span class="dv">25</span>)</a></code></pre></div>
<p>And we get this:</p>
<div class="figure">
<img src="images/factors-wrong-order.png" alt="Princess wrong order" />
<p class="caption">Princess wrong order</p>
</div>
<p>Well, that is frustrating. The bars are not in the same order that we arranged them in the data frame.</p>
<p>As explained in <a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2/">the R-Graph-Gallery post</a>: This is due to the fact that ggplot2 takes into account the order of the factor levels, not the order you observe in your data frame. You can sort your input data frame with sort() or arrange(), it will never have any impact on your ggplot2 graphic.</p>
<div id="labels-and-titles" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Labels and titles</h3>
<p>Before I get into factors, let me explain the other lines in the graphic above:</p>
<ul>
<li><code>coord_flip()</code> transposes the bars so they go horizontal instead of vertical. This allows us to read the princess values.</li>
<li><code>labs()</code> allows us to add the title and cleaner axis labels.</li>
<li><code>geom_text()</code> adds the numbers at the end of the bar, with some adjustments to get them off the top of the bars.</li>
</ul>
</div>
</div>
<div id="factors" class="section level2">
<h2><span class="header-section-number">9.6</span> Factors</h2>
<p>Factors allow you to apply an order (called “levels”) to values beyond being alphabetical. It is super useful when you are dealing with things like the names of months which have a certain order (“Jan”, “Feb”, “March”) which would not be ordered correctly alphabetically.</p>
<p>But is is kind of frustrating here.</p>
<p>We can improve it by reordering the levels of <code>princess</code> using a function from the <a href="https://forcats.tidyverse.org/">forcats</a> package. (forcats is an anagram for “factors”). There are four functions you can use reorder a factor:</p>
<ul>
<li><code>fct_reorder()</code>: Reordering a factor by another variable.</li>
<li><code>fct_infreq()</code>: Reordering a factor by the frequency of values.</li>
<li><code>fct_relevel()</code>: Changing the order of a factor by hand.</li>
<li><code>fct_lump()</code>: Collapsing the least/most frequent values of a factor into “other”.</li>
</ul>
<p>We will use <a href="https://forcats.tidyverse.org/reference/fct_reorder.html"><code>fct_reorder()</code></a> to reorder the <strong>princess</strong> values based on the <strong>votes</strong> values. <code>fct_reorder()</code> takes two main arguments: a) the factor (or column) whose levels you want to modify, and b) a numeric vector (or column of values) that you want to use to reorder the levels.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">fct_reorder</span>(what_you_are_reordering, the_col_to_base_it_on)</a></code></pre></div>
</div>
<div id="reorder-princess" class="section level2">
<h2><span class="header-section-number">9.7</span> Reorder princess</h2>
<p>While we could do this in the ggplot code, I find it’s easiest to do in the data frame as we shape our data. So, go back up to where we made the <code>princes_count</code> data frame and add a new pipe like this:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">princess_count &lt;-<span class="st"> </span>survey <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(princess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">votes =</span> n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(votes)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">princess =</span> <span class="kw">fct_reorder</span>(princess, votes)) <span class="co"># this line reorders the factors</span></a></code></pre></div>
<p>The data frame won’t look any different but if you re-run the ggplot code chunk, you graphic will be reordered.</p>
<div class="figure">
<img src="images/factors-graphic-example.png" alt="Popular princess" />
<p class="caption">Popular princess</p>
</div>
</div>
<div id="factors-recap" class="section level2">
<h2><span class="header-section-number">9.8</span> Factors recap</h2>
<p>Factors in R allow us to apply “levels” to sort categorical data into a logical order beyond alphabetical.</p>
<p>If you are building a graphic that uses a categorical column as one of your aesthetics, then you might need to reorder the factor using <code>fct_reorder()</code> or one of the other functions. It’s easiest to do that using dplyr’s <code>mutate()</code> function on your data frame before you plot.</p>
</div>
<div id="practice-make-an-ice-cream-chart" class="section level2">
<h2><span class="header-section-number">9.9</span> Practice: Make an ice cream chart</h2>
<p>Make the same chart as above, but using the <code>ice_cream</code> counts. Order the column chart by the most popular ice cream.</p>
<div id="turn-in-this-project" class="section level3">
<h3><span class="header-section-number">9.9.1</span> Turn in this project</h3>
<ul>
<li>Save, knit and zip the project and turn it into the Canvas assignment for “Factors”.</li>
</ul>
</div>
</div>
<div id="resources-3" class="section level2">
<h2><span class="header-section-number">9.10</span> Resources</h2>
<p>These resources can help you understand the concepts.</p>
<ul>
<li>This post on <a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2/">Reordering a variable in ggplot</a> helped me understand how to reorder factors for graphics.</li>
<li>Hadley Wickam’s R for Data Science has a <a href="https://r4ds.had.co.nz/factors.html">Chapter on factors</a>. For those who <em>really</em> want to learn more about them later.</li>
</ul>
<!--chapter:end:09-factors.Rmd-->
</div>
</div>
<div id="joins" class="section level1">
<h1><span class="header-section-number">10</span> Joins</h1>
<div id="goals-for-this-section-6" class="section level2">
<h2><span class="header-section-number">10.1</span> Goals for this section</h2>
<ul>
<li>Learn how to join two files based on a common column</li>
<li>Explore correlations between two numerical values</li>
<li>Practice showing relationships with scatterplots</li>
<li>Learn how to merge two files one top of each other</li>
</ul>
<p>This lesson is <em>heavily</em> cribbed from a lesson in Matt Waite’s Sports Data Journalism course at the University of Nebraska.</p>
</div>
<div id="project-setup" class="section level2">
<h2><span class="header-section-number">10.2</span> Project setup</h2>
<ul>
<li>Create your project. Call it <code>yourname-football</code>.</li>
<li>Create a <code>data-raw</code> folder so you have a place to download the files.</li>
<li>Start a new notebook.</li>
</ul>
<div id="download-the-data" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Download the data</h3>
<p>You can download the files we are using based on their URLs in a Github repository. Once you’ve run this block of code, comment out the three <code>download.file()</code> lines by putting a <code>#</code> at the beginning. You really only need to download the files once.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="co"># Downloads the files. Convert to comments once you&#39;ve done this:</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="kw">download.file</span>(<span class="st">&quot;https://github.com/utdata/rwd-mastery-assignments/blob/master/football-compare/penalties.csv?raw=true&quot;</span>, <span class="st">&quot;data-raw/penalties.csv&quot;</span>)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="kw">download.file</span>(<span class="st">&quot;https://github.com/utdata/rwd-mastery-assignments/blob/master/football-compare/scoring_offense.csv?raw=true&quot;</span>, <span class="st">&quot;data-raw/scoring_offense.csv&quot;</span>)</a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="kw">download.file</span>(<span class="st">&quot;https://github.com/utdata/rwd-mastery-assignments/blob/master/football-compare/third_down_conversion.csv?raw=true&quot;</span>, <span class="st">&quot;data-raw/third_down_conversion.csv&quot;</span>)</a></code></pre></div>
<p>Import the three files:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="co"># import the files</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2">scoring &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/scoring_offense.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">clean_names</span>()</a>
<a class="sourceLine" id="cb89-3" data-line-number="3">thirddown &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/third_down_conversion.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">clean_names</span>()</a></code></pre></div>
</div>
</div>
<div id="the-story" class="section level2">
<h2><span class="header-section-number">10.3</span> The story</h2>
<p>The data we are using comes from <a href="http://www.cfbstats.com/">cfbstats</a>, a website for college football statistics. We will be comparing how <a href="http://www.cfbstats.com/2018/leader/national/team/offense/split01/category25/sort01.html">third-down conversions</a> might correlate to a football team’s <a href="http://www.cfbstats.com/2018/leader/national/team/offense/split01/category09/sort01.html">scoring offense</a>.</p>
</div>
<div id="explore-the-data" class="section level2">
<h2><span class="header-section-number">10.4</span> Explore the data</h2>
<p>We have two data sets here.</p>
<div id="third-down-conversions" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Third-down conversions</h3>
<ul>
<li><strong>year</strong>: Year. Goes from 2009-2018</li>
<li><strong>name</strong>: Team name. There are 131 different teams.</li>
<li><strong>g</strong>: Number of games played</li>
<li><strong>attempts</strong>: Third-down attempts</li>
<li><strong>conversions</strong>: Third-down attempts that were successful</li>
<li><strong>conversion_percent</strong>: conversions/attempts * 100</li>
</ul>
</div>
<div id="scoring" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Scoring</h3>
<ul>
<li><strong>year</strong>: Year</li>
<li><strong>name</strong>: Team name</li>
<li><strong>g</strong>: Number of games played</li>
<li><strong>td</strong>: Touchdowns</li>
<li><strong>fg</strong>: Field goals</li>
<li><strong>x1xp</strong>: 1pt PAT made</li>
<li><strong>x2xp</strong>: 2pt PAT made</li>
<li><strong>safety</strong>: Safeties</li>
<li><strong>points</strong>: Total points scored</li>
<li><strong>points_g</strong>: Points per game</li>
</ul>
<p>Now our goal here is to compare how the <code>conversion_percent</code> might relate to <code>points_g</code> for all teams, and how specific teams might buck the national trend.</p>
</div>
</div>
<div id="about-joins" class="section level2">
<h2><span class="header-section-number">10.5</span> About joins</h2>
<p>To make our plot, we need to join the two data sets on common fields. We want to start with the <code>scoring</code> data frame, and then add all the columns from the <code>thirddown</code> data frame. We want to do this based on the same year and team.</p>
<p>There are several types of <a href="https://dplyr.tidyverse.org/reference/join.html">joins</a>. We describe these as left vs right based on which table we reference first (which is the left one). In the figure below, we can see which matching records are retained based on the type of join we use.</p>
<div class="figure">
<img src="images/joins-description.png" alt="Types of joins" />
<p class="caption">Types of joins</p>
</div>
<p>In our case we only want records that match on both <code>year</code> and <code>name</code>, so we’ll use an <code>inner_join()</code>.</p>
<p>The syntax works like this:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">new_dataframe &lt;-<span class="st"> </span><span class="er">*</span><span class="kw">_join</span>(first_df, second_df, <span class="dt">by =</span> field_name_to_join_on)</a></code></pre></div>
<p>If you want to use more than one field in the <em>by</em> part like we do, then you define them in a concatenated list: <code>by = &quot;field1&quot;, &quot;field2&quot;)</code>.</p>
<p>If the fields you are joining on are not named the same, then you can define the relationships: <code>by = c(&quot;a&quot; = &quot;b&quot;)</code>.</p>
<p>For our project we want to use an <code>inner_join()</code>. Add the code below to your notebook along with notes describing that you are joining the two data sets:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">offense &lt;-<span class="st"> </span><span class="kw">inner_join</span>(scoring, thirddown, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;name&quot;</span>))</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="co"># peak at the new data frame</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4">offense <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<p>So, to break this down:</p>
<ul>
<li>Our new combined dataframe will be called <code>offense</code>.</li>
<li>We’ll be doing an <code>inner_join()</code>, which is just keep matching records. (They all match, FWIW.)</li>
<li>Our “left” table is <code>scoring</code> and our “right” table is <code>thirddown</code>.</li>
<li>We are joining on both the <code>year</code> and <code>name</code> columns.</li>
</ul>
<p>Anytime you do a join (or a bind as described below), check the resulting number of rows and columns to make sure they pass the logic test.</p>
</div>
<div id="build-our-scatterplot" class="section level2">
<h2><span class="header-section-number">10.6</span> Build our scatterplot</h2>
<p>We’re trying to show the relationship between <code>conversion_percent</code> and <code>points_g</code>, so we can use those as our x and y values in a <code>geom_point()</code> graphic.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">offense <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() </a></code></pre></div>
<div class="figure">
<img src="images/join-scatter.png" alt="First scatterplot" />
<p class="caption">First scatterplot</p>
</div>
<div id="add-a-fit-line" class="section level3">
<h3><span class="header-section-number">10.6.1</span> Add a fit line</h3>
<p>We can see by the shape of the dots that indeed, as conversion percentage goes up, points go up.</p>
<p>In statistics, there is something called a fit line – the line that predicts what happens given the data. There’s lot of fit lines we can use but the easiest to understand is a straight line. It’s like linear algebra – for each increase or decrease in x, we get an increase or decrease in x. To get the fit line, we add <a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html"><code>geom_smooth()</code></a> with a method.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">offense <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g)) <span class="op">+</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="co"># adds fit line</span></a></code></pre></div>
<div class="figure">
<img src="images/join-scatter-fitline.png" alt="First scatterplot" />
<p class="caption">First scatterplot</p>
</div>
<p>The <code>lm</code> means linear method. The <code>se=FALSE</code> removes the confidence interval (based on the standard error) of the prediction. See the <a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html"><code>geom_smooth()</code></a> for more information.</p>
</div>
<div id="run-a-correlation-test" class="section level3">
<h3><span class="header-section-number">10.6.2</span> Run a correlation test</h3>
<p>So we can see how important third down conversions are to scoring. But still, how important? For this, we’re going to dip our toes into statistics. We want to find out the correlation coefficient (specifically the <a href="https://statistics.laerd.com/statistical-guides/pearson-correlation-coefficient-statistical-guide.php">Pearson Correlation Coefficient</a>. That will tell us how related our two numbers are. We do that using <code>cor.test()</code>, which is part of R core.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">cor.test</span>(offense<span class="op">$</span>conversion_percent, offense<span class="op">$</span>points_g)</a></code></pre></div>
<p>The result is:</p>
<pre><code>    Pearson&#39;s product-moment correlation

data:  offense$conversion_percent and offense$points_g
t = 30.82, df = 1251, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.6242939 0.6873331
sample estimates:
      cor 
0.6569602 </code></pre>
<p>That bottom number is the key. If we square it, we then know exactly how much of scoring can be predicted by third down conversions.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">(<span class="fl">0.6569602</span> <span class="op">*</span><span class="st"> </span><span class="fl">0.6569602</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<p>Which gets us 43.15967.</p>
<p>So what that says is that 43 percent of a team’s score is predicted by their third down percentage. That’s nearly half. In social science, anything above 10 percent is shockingly predictive. So this is huge if this were human behavior research. In football, it’s not that surprising, but we now know how much is predicted.</p>
</div>
</div>
<div id="how-does-texas-compare" class="section level2">
<h2><span class="header-section-number">10.7</span> How does Texas compare?</h2>
<p>Let’s compare how Texas does vs the field by plotting their results on top of the national stats. Create a data frame of the Texas data.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">tx &lt;-<span class="st"> </span>offense <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Texas&quot;</span>)</a></code></pre></div>
<p>And now we’ll add some layers to our ggplot graphic. We’re also editing our original <code>geom_point()</code> and <code>geom_smooth()</code> layers to make them light grey so that the Texas plots stand out more.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">offense <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g)) <span class="op">+</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;light grey&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># adds light grey color</span></a>
<a class="sourceLine" id="cb98-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="st">&quot;light grey&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># adds light grey color</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> tx, <span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g), <span class="dt">color =</span> <span class="st">&quot;#bf5700&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># adds Texas points colored burnt orange, of course</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> tx, <span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g, <span class="dt">label =</span> year)) <span class="co"># adds year labels to see</span></a></code></pre></div>
<div class="figure">
<img src="images/join-scatter-tx.png" alt="Adding Texas to plot" />
<p class="caption">Adding Texas to plot</p>
</div>
<p>This is good, but the labels for the year are sitting on top of the values. There is an R package called <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">ggrepel</a> that will move those labels off the numbers, which we’ll use with our next set of changes. You might have to run <code>install.packages('ggrepel')</code> to make this work.</p>
<p>For this update, we are doing a number of things, adding or modifying layers along the way:</p>
<ul>
<li>Add a <code>goem_smooth()</code> fit line specific to Texas, in burnt orange. We’ll put it before the text so it shows underneath the labels.</li>
<li>Modify the <code>geom_text</code> to <code>geom_text_repel</code> to move the labels off the points.</li>
<li>Add <code>labs()</code> for a title and such to finish out our graphic.</li>
<li>Add <code>theme_minimal()</code> just to improve the looks.</li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">  <span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;light grey&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="st">&quot;light grey&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> tx, <span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g), <span class="dt">color =</span> <span class="st">&quot;#bf5700&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> tx, <span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g), <span class="dt">method=</span>lm, <span class="dt">se=</span>F, <span class="dt">color =</span> <span class="st">&quot;#bf5700&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> tx, <span class="kw">aes</span>(<span class="dt">x =</span> conversion_percent, <span class="dt">y =</span> points_g, <span class="dt">label =</span> year)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Third-down conversion rate&quot;</span>,</a>
<a class="sourceLine" id="cb99-8" data-line-number="8">       <span class="dt">y=</span><span class="st">&quot;Points per game&quot;</span>,</a>
<a class="sourceLine" id="cb99-9" data-line-number="9">       <span class="dt">title=</span><span class="st">&quot;Texas&#39; third down success predicts scoreboard&quot;</span>,</a>
<a class="sourceLine" id="cb99-10" data-line-number="10">       <span class="dt">subtitle=</span><span class="st">&quot;In 2018 the Longhorns were 18th in the FBS for third down conversions.&quot;</span>,</a>
<a class="sourceLine" id="cb99-11" data-line-number="11">       <span class="dt">caption=</span><span class="st">&quot;Source: NCAA&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<div class="figure">
<img src="images/join-scatter-tx-finished.png" alt="Finished Texas graphic" />
<p class="caption">Finished Texas graphic</p>
</div>
</div>
<div id="correlaton-test-for-texas" class="section level2">
<h2><span class="header-section-number">10.8</span> Correlaton test for Texas</h2>
<p>It looks like Texas tracks pretty much along the national average.</p>
<p>Let’s do the correlation test for Texas just to compare.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">cor.test</span>(tx<span class="op">$</span>conversion_percent, tx<span class="op">$</span>points_g)</a></code></pre></div>
<p>Which yields a correlation of 0.685967. Let’s see how much third-down conversions predict Texas’ scoring per game.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">(<span class="fl">0.685967</span> <span class="op">*</span><span class="st"> </span><span class="fl">0.685967</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<p>Which gets us 47.1%, not too far from the national average of 43.2%.</p>
</div>
<div id="practice-1-compare-penn-state" class="section level2">
<h2><span class="header-section-number">10.9</span> Practice 1: Compare Penn State</h2>
<p>Not every team tracks the national average like Texas. Tell me (and show me) how Penn State performs in this same third down conversion vs scoring metric by creating a similar graphic and correlation test from the Penn State data on top of the national data.</p>
</div>
<div id="practice-2-penalties-vs-scoring" class="section level2">
<h2><span class="header-section-number">10.10</span> Practice 2: Penalties vs scoring</h2>
<p>How predictive are penalty yards per game on points per game? Do more disciplined teams score more points than undisciplined ones? How does Texas compare to the rest of the league?</p>
<p>Create a <strong>new RNotebook</strong> to answer these questions.</p>
<ul>
<li>You will need to join <a href="http://www.cfbstats.com/2018/leader/national/team/offense/split01/category14/sort01.html">penalty data</a> (you’ve already downloaded the file <code>data-raw/penalties.csv</code> file) to the same points-per-games statistics from <a href="http://www.cfbstats.com/2018/leader/national/team/offense/split01/category09/sort01.html">scoring offense</a>.</li>
<li>Make your own scatterplot with a fit line to show the relationships between penalty yards per game vs points per game.</li>
<li>Run a correlation test for both the national average and for Texas.</li>
<li>What does it say? Write a sentence that explains this to a reader.</li>
</ul>
</div>
<div id="using-bind_rows-to-merge-data-sets" class="section level2">
<h2><span class="header-section-number">10.11</span> Using bind_rows() to merge data sets</h2>
<p>We won’t go through an example or do practice sessions, but you should be aware that you can also merge data sets on top of each other when your columns are the same.</p>
<p>Let’s say you have a multiple data sets where each year is broken into a different file or data frame. You can “stack” data frames on top of each other with a tidyverse function called <a href="https://dplyr.tidyverse.org/reference/bind.html"><code>bind_rows()</code></a>. When row-binding, columns are matched by name, and any missing columns will be filled with NA.</p>
<p>An example might look like this …</p>
<ul>
<li>Let’s say you have three years of data in three different data frames: fy2016, fy2017, fy2018.</li>
<li>And all three data frames have the same column names: donor_type, date, amount.</li>
<li>And each data frame has 1000 rows of data.</li>
</ul>
<p>If you want then all in the same file you would do this:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">combined &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fy2016, fy2017, fy2018)</a></code></pre></div>
<p>The new data frame <code>combined</code> would have all the same columns, but would have 3000 rows of data.</p>
<div id="combine-data-with-a-group" class="section level3">
<h3><span class="header-section-number">10.11.1</span> Combine data with a group</h3>
<p>If you needed to know which data frame each row came from, you can name a “group” for each data frame, and then merge them. We will name our groups for each year they come from.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">combined &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">  <span class="st">&quot;2016&quot;</span> =<span class="st"> </span>fy2016,</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">  <span class="st">&quot;2017&quot;</span> =<span class="st"> </span>fy2017,</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">  <span class="st">&quot;2018&quot;</span> =<span class="st"> </span>fy2018,</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">  <span class="dt">.id =</span> <span class="st">&quot;year&quot;</span></a>
<a class="sourceLine" id="cb103-6" data-line-number="6">)</a></code></pre></div>
<p>With this you would end up with a new data frame called <code>combined</code>, but it would have four columns: year, donor_type, date, amount. It would have all 3000 rows. All the rows that were pulled from <code>fy2016</code> would have a <code>year</code> of “2016”, and so on.</p>
<p>It’s a good way to note which file the data came from, and especially helpful if they are from different years, like the example.</p>
<p>It is admittedly weird that you name the groups before you specify the data frame the come from, but specify <code>.id</code> before the name of your new column. <code>¯\_(ツ)_/¯</code></p>
<!--chapter:end:10-joins.Rmd-->
</div>
</div>
</div>
<div id="census" class="section level1">
<h1><span class="header-section-number">11</span> Census</h1>
<p>The U.S. <a href="https://census.gov/">Census Bureau</a> has a wealth of data that can help journalists tell stories. This chapter is <em>not</em> a comprehensive guide on how to use it, but instead an introduction on some ways you can.</p>
<p>But we can’t talk about specifics of <em>how</em> do to anything before learning <em>about</em> the different Census programs, so here is a mini overview of some of the more popular programs.</p>
<div id="goals-of-this-section" class="section level2">
<h2><span class="header-section-number">11.1</span> Goals of this section</h2>
<ul>
<li>Introduce three of the more popular Census data sets and discuss how they differ:
<ul>
<li><a href="https://www.census.gov/programs-surveys/decennial-census/decade.2010.html">Decennial Census</a></li>
<li><a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a></li>
<li><a href="https://www.census.gov/programs-surveys/popest.html">Population Estimates Program</a></li>
</ul></li>
<li>Discuss differences between <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a> and <a href="https://data.census.gov/cedsci/">data.census.gov</a>.</li>
<li>Introduce and demonstrate packages that use the Census Bureau’s API to pull data into R.</li>
<li>Introduce packages that allow static and interactive mapping within R, which often comes into play when using Census data.</li>
</ul>
<p>None of these topics are comprehensive. I have <a href="https://drive.google.com/open?id=1vfPIhXcodmqVHvZCauEc9QZgyev-Lm4ZWxn2nlhhzRI">lectured on the census</a> in the past and have <a href="https://drive.google.com/open?id=1z6XnsPg2fhdwZeko7MG5IYq4CJfqDqxQx5-RLFUUiIM">multiple</a> <a href="https://drive.google.com/open?id=18hZ7DvQkGoSnJNKGvqjR3rvErglNZGAmTO-PysarsSQ">lessons</a> using different software if you want more general instruction, or you could just dive in and gain your own experience.</p>
</div>
<div id="census-bureau-programs-and-platforms" class="section level2">
<h2><span class="header-section-number">11.2</span> Census Bureau programs and platforms</h2>
<p>The Census Bureau has a series of different data “programs” and data sets, many with their own distribution platforms. They are currently in a development effort to combine distribution of all of them into a new, combined platform: <a href="https://data.census.gov/cedsci/">data.census.gov</a>. <em>It is a work in progress.</em> That said, the plan is to stop publishing new data to the much-bemoaned <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a>, their “old” site, this summer of 2019. As such, I’ll concentrate on <a href="https://data.census.gov/cedsci/">data.census.gov</a>.</p>
<p>That’s to say that while I’m outlining three different programs here, the data will eventually be found all int he same place, but it’s in a state of flux currently. Your default should be to use <a href="https://data.census.gov/cedsci/">data.census.gov</a> first, then go to <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a> if you can’t find something. We’ll also discuss some R packages that use the Census API, and the advantages of using them.</p>
<div id="decennial-census" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Decennial Census</h3>
<p>Every <a href="https://www.census.gov/programs-surveys/decennial-census/decade.2010.html">ten years</a>, the government tries to count everyone in every household in America. The results are used to redraw Congressional Districts, allocate tax dollars and a million other reasons. The number of questions asked each decade has been condensed to center around how many people live in a household, their age, race and ethnicity, their relationship to each other, and if they own or rent the home.</p>
<blockquote>
<p>The decennial census data is the most accurate snapshot you can get for a single point in time. It’s just limited in the scope of data.</p>
</blockquote>
<p>Most decennial data has been migrated to the data.census.gov data portal.</p>
<p>April 1, 2020 is <a href="https://2020census.gov/en">Census Day</a> for the <a href="https://www.census.gov/programs-surveys/decennial-census/2020-census.html">next count</a>.</p>
</div>
<div id="american-community-survey" class="section level3">
<h3><span class="header-section-number">11.2.2</span> American Community Survey</h3>
<p>The <a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a>, or ACS, is the method the government uses to collect more detailed data than who lives where. It is quite extensive, with information relevant to almost any beat in Journalism.</p>
<p>While the decennial count comes once every ten years, the ACS has been continuously collecting data since 2005. Each year about 1.7% of Americans answer the ACS survey, and those results are distributed at regular intervals each year.</p>
<p>This is fine for large geographic areas with 65,000 people or more. But, when you want results for smaller geographic areas or very specific individuals, the bureau combines five years of survey results together so they have enough data to make estimates. This combination of 1-year and 5-year data sets is a trade off: New data each year for large areas, but fuzzier 5-year windows for small areas.</p>
<p>Each estimate also comes with a “margin of error”, which represents the upper and lower bounds of the estimate with a 90% confidence rate. You can read more about this in the <a href="https://www.census.gov/library/publications/2008/acs/media.html">ACS media guide</a>, but here is a brief example:</p>
<p>If an estimate is 2,000 with an MOE of +/- 100, that means that you could take 10 new random samples in that area and the average of those samples would be between 1,900 and 2,100 for nine out of the 10 samples.</p>
<p>As journalists, we don’t typically report the margin of error each time we use an estimate, but we do make sure our readers understand the data are based on survey estimates. Most importantly we make sure the MOE is not more than 10% of our estimate if we are basing our story on that number.</p>
<blockquote>
<p>The ACS allows us to get the most detailed characteristics about our population, like how we travel to work or how much of our income we spend on rent. However, it comes with a degree of uncertainty, especially for smaller geographic areas. It is still very valuable.</p>
</blockquote>
<p>Most of these tables are available on data.census.gov, with the rest scheduled to be ported this year (2019). New releases will only be published to the data portal.</p>
</div>
<div id="population-estimates-program" class="section level3">
<h3><span class="header-section-number">11.2.3</span> Population Estimates Program</h3>
<p>PEP uses current data on births, deaths, and migration to calculate population change since the most recent decennial census. Each year the Census Bureau publishes tables with estimates of population, demographics, and housing units for cities, counties and metro areas.</p>
<blockquote>
<p>Populations estimates are a great way to see population and demographic changes for large areas. It does not have a margin of error like the ACS because it is based on actual data and not random surveys of a part of the population.</p>
</blockquote>
<p>These tables are currently only available in FactFinder, but should be ported to the new data.census.gov data portal this year (2019).</p>
</div>
</div>
<div id="using-the-new-data-portal" class="section level2">
<h2><span class="header-section-number">11.3</span> Using the new data portal</h2>
<p>Again, the <a href="https://data.census.gov/cedsci/">data.census.gov</a> data portal is under development and has some known challenges, but it’s the one you should learn first since FactFinder will be retired this year. It is slow, cumbersome and error prone but getting better with each new release.</p>
<p>Instead of me writing out directions, I recommend you watch <a href="https://www.census.gov/data/academy/webinars/2019/transition-data-census.html">this webinar</a> that demonstrates how to use the portal and outlines the current challenges and development plans for the future.</p>
<p>I will provide brief demos of the data portal and FactFinder in class, just so you can see them.</p>
<div id="tips-about-using-downloaded-portal-data-in-r" class="section level3">
<h3><span class="header-section-number">11.3.1</span> Tips about using downloaded portal data in R</h3>
<p>When you download a table from the portal, you get a stuffed archive with three files. Here is an example from a 5-year ACS data set for table B19013, which includes median income data:</p>
<ul>
<li><code>ACSDT5Y2017.B19013_data_with_overlays_2019-04-20T000019.csv</code> is the data. It contains two header rows (arg!) with the first row being coded values for each column. The second row has long descriptions of what is in each column.</li>
<li><code>ACSDT5Y2017.B19013_metadata_2019-04-20T000019.csv</code> is a reference file that gives the code and description for each header in the data.</li>
<li><code>ACSDT5Y2017.B19013_table_title_2019-04-20T000019.txt</code> is a reference file with information about the table. If data is masked or missing, this file will explain the symbols used in the data to describe how and why.</li>
</ul>
<p>The first part of the file names include the program, year and table the data comes from. At the end of the file name is the date and time the data was downloaded from the portal.</p>
</div>
<div id="importing-downloaded-data" class="section level3">
<h3><span class="header-section-number">11.3.2</span> Importing downloaded data</h3>
<p>When I import this data into R, I typically use the <code>read_csv()</code> function and skip the first, less-descriptive row. The second row becomes the headers, which are really long but explain the columns. I then rename them to something shorter. If you are only using selected columns, then you might use <code>select()</code> to get only those you need.</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">tx_income &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data-raw/ACSDT5Y2017.B19013_2019-04-20T000022/ACSDT5Y2017.B19013_data_with_overlays_2019-04-20T000019.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">    <span class="dt">median_income =</span> <span class="st">`</span><span class="dt">Estimate!!Median household income in the past 12 months (in 2017 inflation-adjusted dollars)</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb104-4" data-line-number="4">    <span class="dt">median_income_moe =</span> <span class="st">`</span><span class="dt">Margin of Error!!Median household income in the past 12 months (in 2017 inflation-adjusted dollars)</span><span class="st">`</span></a>
<a class="sourceLine" id="cb104-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">clean_names</span>()</a></code></pre></div>
<p>Which yields this:</p>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>geographic_area_name</th>
<th align="right">median_income</th>
<th align="right">median_income_moe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0500000US48199</td>
<td>Hardin County, Texas</td>
<td align="right">56131</td>
<td align="right">3351</td>
</tr>
<tr class="even">
<td>0500000US48207</td>
<td>Haskell County, Texas</td>
<td align="right">43529</td>
<td align="right">6157</td>
</tr>
<tr class="odd">
<td>0500000US48227</td>
<td>Howard County, Texas</td>
<td align="right">50855</td>
<td align="right">2162</td>
</tr>
</tbody>
</table>
</div>
<div id="fields-made-to-join-with-other-data" class="section level3">
<h3><span class="header-section-number">11.3.3</span> Fields made to join with other data</h3>
<p>Pay attention to fields named <code>id</code> or <code>geoid</code> or similar names as these are often fields meant to be joined to other tables. Many use parts of FIPS codes that define specific geographic areas, and allow you to match similar fields in multiple data sets.</p>
<p>This is especially important when it comes to mapping data, as these codes are how you join data to “shape files”, which are a data representation of geographic shapes for mapping. While we won’t go into a lot of detail about maps in this lesson, I’ve linked some examples below.</p>
<p>You may find you want to join data based on geography names, in which case you might need to use <a href="https://dplyr.tidyverse.org/">dplyr</a> tools to split and normalize those terms so they match your other data set, like changing “Travis County, Texas” to just “Travis”.</p>
</div>
</div>
<div id="using-the-census-api-in-r" class="section level2">
<h2><span class="header-section-number">11.4</span> Using the Census API in R</h2>
<p>You can also import data into R directly from the Census Bureau using their API. There are a number of packages that do this, and they all work a little differently to solve different challenges. Again, I won’t go into great detail about how to use these, but I’ll show examples and provide links to further self-study.</p>
<blockquote>
<p>Manually downloading census data is usually a multiple-step and multiple-decision process. An advantage to using the API is you can script that decision-making process for consistency. Different packages also provide the data in different formats, which might be beneficial depending on your goal.</p>
</blockquote>
<div id="setting-up-an-api-key" class="section level3">
<h3><span class="header-section-number">11.4.1</span> Setting up an API key</h3>
<p>The Census requires a free API key to use their service. It’s like your personal license, and should not be shared with others. You can sign up for an <a href="http://api.census.gov/data/key_signup.html">API key here</a> and then <a href="https://rdrr.io/cran/tidycensus/man/census_api_key.html">store it on your machine in an .Rnviron</a> file so you don’t have to display it in your code.</p>
<blockquote>
<p>You only have to set up your API key once on each machine. Once installed, it gets automatically loaded when you restart R.</p>
</blockquote>
</div>
<div id="the-censusapi-package" class="section level3">
<h3><span class="header-section-number">11.4.2</span> The censusapi package</h3>
<p><a href="https://twitter.com/hannah_recht?lang=en">Hannah Recht</a> of Bloomberg News developed the <a href="https://hrecht.github.io/censusapi/">censusapi</a> to pull data directly from the Census Bureau into R. See that site for more examples and documentation on use.</p>
<p>You can view the <a href="https://utdata.github.io/rwd-r-census-examples/01-censusapi.html">full notebook of the examples below here</a>.</p>
<p>This example code chunk pulls the same data set we manually downloaded from the portal. We are asking for the median income estimate (<code>B19013_001E</code>) and margin of error (<code>B19013_001M</code>), but I’m also including the total population for the county with <code>B01003_001E</code>, which was not in the “B19013” table. This is another advantage to using the API, as we are pulling from multiple tables at once. To do this manually, we would have to search for and download two separate data sets and merge them.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">tx_income &lt;-<span class="st"> </span><span class="kw">getCensus</span>(<span class="dt">name =</span> <span class="st">&quot;acs/acs5&quot;</span>, <span class="dt">vintage =</span> <span class="dv">2017</span>, </a>
<a class="sourceLine" id="cb105-2" data-line-number="2">    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span>,<span class="st">&quot;B01003_001E&quot;</span>, <span class="st">&quot;B19013_001E&quot;</span>, <span class="st">&quot;B19013_001M&quot;</span>), </a>
<a class="sourceLine" id="cb105-3" data-line-number="3">    <span class="dt">region =</span> <span class="st">&quot;county:*&quot;</span>, <span class="dt">regionin =</span> <span class="st">&quot;state:48&quot;</span>)</a></code></pre></div>
<p>Which ends up looking like this:</p>
<table>
<thead>
<tr class="header">
<th>state</th>
<th>county</th>
<th>NAME</th>
<th align="right">B01003_001E</th>
<th align="right">B19013_001E</th>
<th align="right">B19013_001M</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>48</td>
<td>199</td>
<td>Hardin County, Texas</td>
<td align="right">55993</td>
<td align="right">56131</td>
<td align="right">3351</td>
</tr>
<tr class="even">
<td>48</td>
<td>207</td>
<td>Haskell County, Texas</td>
<td align="right">5806</td>
<td align="right">43529</td>
<td align="right">6157</td>
</tr>
<tr class="odd">
<td>48</td>
<td>227</td>
<td>Howard County, Texas</td>
<td align="right">36491</td>
<td align="right">50855</td>
<td align="right">2162</td>
</tr>
</tbody>
</table>
<p>See how this is similar to the data we imported from file we downloaded from the data portal? In this case we have a <code>state</code> and <code>county</code> field instead of the <code>id</code>, but the shape of the data is the same. Also note that our extra variable for population is added as a new column, which will differ with our next example.</p>
<p>Using an API like this to fetch data can take some effort to learn, but the exact “steps” to get the data are recorded in your code.</p>
</div>
<div id="the-tidycensus-package" class="section level3">
<h3><span class="header-section-number">11.4.3</span> The tidycensus package</h3>
<p><a href="http://personal.tcu.edu/kylewalker/">Kyle Walker</a> is a professor at TCU who developed the <a href="https://walkerke.github.io/tidycensus/index.html">tidycensus</a> package to return census data in tidyverse-ready data frames. He also includes an option to pull the spatial geometry to make maps.</p>
<p>You can <a href="https://utdata.github.io/rwd-r-census-examples/01-tidycensus.html">view this example in full</a>, with the map.</p>
<p>With tidycensus we don’t have to specify to get the MOE with his <code>get_acs()</code> function, it just comes. We only supply the two variables we want, those for population and the median income.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">tx_income &lt;-<span class="st"> </span><span class="kw">get_acs</span>(</a>
<a class="sourceLine" id="cb106-2" data-line-number="2">  <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>,</a>
<a class="sourceLine" id="cb106-3" data-line-number="3">  <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;B01003_001&quot;</span>,<span class="st">&quot;B19013_001&quot;</span>),</a>
<a class="sourceLine" id="cb106-4" data-line-number="4">  <span class="dt">state =</span> <span class="st">&quot;TX&quot;</span></a>
<a class="sourceLine" id="cb106-5" data-line-number="5">  )</a></code></pre></div>
<p>And the result is this:</p>
<table>
<thead>
<tr class="header">
<th>GEOID</th>
<th>NAME</th>
<th>variable</th>
<th align="right">estimate</th>
<th align="right">moe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>48001</td>
<td>Anderson County, Texas</td>
<td>B01003_001</td>
<td align="right">57747</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>48001</td>
<td>Anderson County, Texas</td>
<td>B19013_001</td>
<td align="right">42313</td>
<td align="right">2337</td>
</tr>
<tr class="odd">
<td>48003</td>
<td>Andrews County, Texas</td>
<td>B01003_001</td>
<td align="right">17577</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>48003</td>
<td>Andrews County, Texas</td>
<td>B19013_001</td>
<td align="right">70753</td>
<td align="right">6115</td>
</tr>
<tr class="odd">
<td>48005</td>
<td>Angelina County, Texas</td>
<td>B01003_001</td>
<td align="right">87700</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>48005</td>
<td>Angelina County, Texas</td>
<td>B19013_001</td>
<td align="right">46472</td>
<td align="right">1452</td>
</tr>
</tbody>
</table>
<p>Note how the resulting data is a different shape here. Instead of the table getting wider for each variable added, it gets longer. This is a more “tidy” shape that can potentially be easier to plot or map.</p>
</div>
<div id="adding-geometry-to-tidycensus" class="section level3">
<h3><span class="header-section-number">11.4.4</span> Adding geometry to tidycensus</h3>
<p>The tidycensus package also allows you to download the geometry or shapes of your data at the same time by adding <code>geometry = TRUE</code> to your tidycensus call. This allows you to quickly make static maps of your data.</p>
<p>I’m removing the population variable because we don’t need it for the map.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">tx_income_map &lt;-<span class="st"> </span><span class="kw">get_acs</span>(</a>
<a class="sourceLine" id="cb107-2" data-line-number="2">  <span class="dt">geography =</span> <span class="st">&quot;county&quot;</span>,</a>
<a class="sourceLine" id="cb107-3" data-line-number="3">  <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;B19013_001&quot;</span>),</a>
<a class="sourceLine" id="cb107-4" data-line-number="4">  <span class="dt">state =</span> <span class="st">&quot;TX&quot;</span>,</a>
<a class="sourceLine" id="cb107-5" data-line-number="5">  <span class="dt">geometry =</span> <span class="ot">TRUE</span> <span class="co"># gets shapes</span></a>
<a class="sourceLine" id="cb107-6" data-line-number="6">  )</a></code></pre></div>
<p>Now we can use <code>geom_sf()</code> to plot the <code>estimate</code> value to each county in shapefile in ggplot.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">ggplot</span>(tx_income_map) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>estimate), <span class="dt">color=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb108-3" data-line-number="3"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb108-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&#39;transparent&#39;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb108-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette=</span><span class="st">&quot;Oranges&quot;</span>, <span class="dt">direction=</span><span class="dv">1</span>, <span class="dt">name=</span><span class="st">&quot;Median income&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb108-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;2017 median income in Texas counties&quot;</span>, <span class="dt">caption=</span><span class="st">&quot;Source: Census Bureau/ACS5 2017&quot;</span>)</a></code></pre></div>
<p>Which yields this:</p>
<div class="figure">
<img src="images/census-tx-tidycensus.png" alt="Map from tidy census" />
<p class="caption">Map from tidy census</p>
</div>
<p>That’s basically two lines of code to pull data and build a map.</p>
</div>
<div id="map-shapes-only-with-tigris" class="section level3">
<h3><span class="header-section-number">11.4.5</span> Map shapes only with tigris</h3>
<p>If you already have the Census data, or perhaps data that is not from the census but has a county name or one of the other geographic code values, then you can use Walker’s <a href="https://github.com/walkerke/tigris">tigris</a> package to get just the shapefiles. The <a href="https://utdata.github.io/rwd-r-census-examples/01-tidycensus.html">censusapi example</a> I have finishes out by pulling tigiris data to make the same median income map as above.</p>
</div>
</div>
<div id="interactive-maps-with-leaflet" class="section level2">
<h2><span class="header-section-number">11.5</span> Interactive maps with leaflet</h2>
<p><a href="https://rpubs.com/rosenblum_jeff/censustutorial1">Here is a tutorial</a> that walks through creating an interactive map of median income by census tract using the <a href="https://rstudio.github.io/leaflet/">leaflet</a>, <a href="https://r-spatial.github.io/mapview/index.html">mapview</a>, <a href="https://github.com/walkerke/tigris">tigris</a> and <a href="https://www.rdocumentation.org/packages/acs/versions/2.1.4">acs</a> packages. It’s a pretty basic map best used for exploration, but it’s pretty neat and not too hard to make.</p>
</div>
<div id="resources-4" class="section level2">
<h2><span class="header-section-number">11.6</span> Resources</h2>
<p>Some other resources not already mentioned:</p>
<ul>
<li><a href="https://rconsortium.github.io/censusguide/">R Census guide</a></li>
<li><a href="https://www.computerworld.com/article/3120415/data-analytics/how-to-download-new-census-data-with-r.html">Sharon Machlis guide</a></li>
<li><a href="https://www.census.gov/data/academy/courses/choroplethr.html">Mapping Census Bureau Data in R with Choroplethr by package creator Ari Lamstein</a></li>
<li><a href="https://www.census.gov/data/academy/courses/ranking-project.html">Using the R Package RankingProject to Make Simple Visualizations for Comparing Populations by former Census Bureau statistician Jerzy Wieczorek</a></li>
<li><a href="https://workshop.mhermans.net/thematic-maps-r/">Thematic maps</a> tutorial.</li>
<li><a href="https://www.baltimoresun.com/news/maryland/bs-md-acs-census-release-20181206-story.html">Baltimore Sun example story</a> and <a href="https://github.com/baltimore-sun-data/census-data-analysis-2018">code</a>. <a href="https://twitter.com/christinezhang">Christine Zhang</a> says &quot;Sometimes I prefer the output of one over the other (censusapi vs tidycensus) which is why I alternate.</li>
<li><a href="https://www.rspatial.org/">Spatial Data Science with R</a> Tutorial.</li>
<li>Not a tutorial but but this <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/">post by Timo Grossenbacher</a> is an explanation and inspiration on how far you can take R in mapping. <a href="https://gist.github.com/chris-prener/cd6b0aa0b2096daf13e545f4264ea6bb">Here is a version</a> that uses U.S. Census Bureau data.</li>
</ul>
<!--chapter:end:11-census.Rmd-->
</div>
</div>
<div id="how-to-tackle-a-new-dataset" class="section level1">
<h1><span class="header-section-number">12</span> How to tackle a new dataset</h1>
<p>For those unfamiliar with exploring data, starting the process can be paralyzing.</p>
<p>How do I explore when I don’t know what I’m looking for? Where do I start?</p>
<p>Every situation is different, but there are some common techniques and some common sense that you can bring to every project.</p>
<div id="start-by-listing-questions" class="section level2">
<h2><span class="header-section-number">12.1</span> Start by listing questions</h2>
<p>It’s likely you’ve acquired data because you needed it to add context to a story or situation. Spend a little time at the beginning brainstorming as list of questions you want to answer. (You might ask a colleague to participate: the act of describing the data set will reveal questions for both of you.) I like to start my RNotebook with this list.</p>
</div>
<div id="understand-your-data" class="section level2">
<h2><span class="header-section-number">12.2</span> Understand your data</h2>
<p>Before you start working on your data, make sure you understand what all the columns and values mean. Look at your data dictionary, or talk to the data owner to make sure you understand what you are working with.</p>
<p>To get a quick summary of all the values, you can use a function called <code>summary()</code> to give you some basic stats for all your data. Here is an example from the Top 100 Billboard data we used in a class assignment.</p>
<div class="figure">
<img src="images/explore-summary.png" alt="Summary of billboard data" />
<p class="caption">Summary of billboard data</p>
</div>
<p>A <code>summary()</code> will show you the data type for each column, and then for number values it will show you the min, max, median, mean and other stats.</p>
</div>
<div id="counting-and-aggregation" class="section level2">
<h2><span class="header-section-number">12.3</span> Counting and aggregation</h2>
<p>A large part of data analysis is counting and sorting, or filtering and then counting and sorting. It’s possible you may need to reshape your data using <code>gather()</code> or <code>spread()</code> before you can do the mutating or grouping and summarizing you need. Review the <a href="#tidy">Tidy data</a> chapter for more on that.</p>
<div id="counting-rows-based-on-a-column" class="section level3">
<h3><span class="header-section-number">12.3.1</span> Counting rows based on a column</h3>
<p>If you are just counting the number of rows based on the values within a column (or columns), then <code>count()</code> is the key. When you use <code>count()</code> like this, a new column called <code>n</code> is created to hold the count of the rows. You can then use <code>arrange()</code> to sort the <code>n</code> column. (I’ll often rename <code>n</code> to something more useful. If you do, make sure you <code>arrange()</code> by the new name.)</p>
<p>In this example, we are counting the number of rows for each princess in our survey data, the arranging by <code>'n</code> then in decending order.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">survey <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(princess) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(n <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">desc</span>())</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th>princess</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mulan</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td>Rapunzel (Tangled)</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td>Jasmine (Aladdin)</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td>Ariel (Little Mermaid)</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td>Tiana (Princess and the Frog)</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>Aurora (Sleeping Beauty)</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Belle (Beauty and the Beast)</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td>Merida (Brave)</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>Snow White</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="sum-mean-and-other-aggregations" class="section level3">
<h3><span class="header-section-number">12.3.2</span> Sum, mean and other aggregations</h3>
<p>If you want to aggregate values in a column, like adding together values, or to find a mean or median, then you will want to use <code>group_by()</code> on your columns of interest, then use <code>summarize()</code> to aggregate the data in the manner you choose, like <code>sum()</code>, <code>mean()</code> or the number of rows <code>n()</code>.</p>
<p>Here is an example where we use <code>group_by</code> and <code>summarize()</code> to add together values in our mixed beverage data. In this case, we had multiple rows for each name/address group, but we wanted to add together <code>total_receipts()</code> for each group.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">receipts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(location_name, location_address) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb110-4" data-line-number="4">    <span class="dt">total_sales =</span> <span class="kw">sum</span>(total_receipts)</a>
<a class="sourceLine" id="cb110-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_sales))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th>location_name</th>
<th>location_address</th>
<th align="right">total_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WLS BEVERAGE CO</td>
<td>110 E 2ND ST</td>
<td align="right">35878211</td>
</tr>
<tr class="even">
<td>RYAN SANDERS SPORTS</td>
<td>9201 CIRCUIT OF THE AMERICAS BLVD</td>
<td align="right">20714630</td>
</tr>
<tr class="odd">
<td>W HOTEL AUSTIN</td>
<td>200 LAVACA ST</td>
<td align="right">15435458</td>
</tr>
<tr class="even">
<td>ROSE ROOM/ 77 DEGREE</td>
<td>11500 ROCK ROSE AVE</td>
<td align="right">14726420</td>
</tr>
<tr class="odd">
<td>THE DOGWOOD DOMAIN</td>
<td>11420 ROCK ROSE AVE STE 700</td>
<td align="right">14231072</td>
</tr>
</tbody>
</table>
<p>The result will have all the columns you included in the group, plus the columns you create in your summarize statement. You can summarize more than one thing at a time, like the number of rows <code>numb_rows = n()</code> and average of the values <code>average = mean(column_name)</code>.</p>
</div>
<div id="creating-columns-to-show-difference" class="section level3">
<h3><span class="header-section-number">12.3.3</span> Creating columns to show difference</h3>
<p>Sometimes you need to perform math on two columns to show the difference between them. Use <code>mutate()</code> to create the column and do the math. Here’s a pseudo-code example:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">new_or_reassigned_df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb111-3" data-line-number="3">    <span class="dt">new_col_name =</span> (part_col <span class="op">/</span><span class="st"> </span>total_col) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb111-4" data-line-number="4">  )</a></code></pre></div>
</div>
</div>
<div id="cleaning-up-categorical-data" class="section level2">
<h2><span class="header-section-number">12.4</span> Cleaning up categorical data</h2>
<p>If you are going to count our summarize rows based on categorical data, you might want to make sure the values in that column are clean and free of typos and values that might be better combined.</p>
<p>In class we did this with the <code>proposed_use</code> column in our wells data in the <a href="#cleaning">Cleaning</a> chapter. Review that chapter for examples.</p>
<p>Some strategies you might use:</p>
<ul>
<li>Create a <code>count()</code> of the column to show all the different values and how often they show up.</li>
<li>You might want to use <code>mutate()</code> to create a new column and then update the values there. Again, see the <a href="#cleaning">Cleaning</a> chapter for examples.</li>
</ul>
<p>If you find you have hundreds of values to clean, then come see me. There are some other tools like <a href="http://openrefine.org/">OpenRefine</a> that you can learn farily quickly to help.</p>
</div>
<div id="time-as-a-variable" class="section level2">
<h2><span class="header-section-number">12.5</span> Time as a variable</h2>
<p>If you have dates in your data, then you almost always want to see change over time for different variables.</p>
<ul>
<li>Summarize records by year or month as appropriate and create a Bar or Column chart to show how the number of records for each time period.</li>
<li>Do you need to see how different categories of data have changed over time? Consider a line chart that shows those categories in different colors.</li>
<li>If you have the same value for different time periods, do might want to see the change or percent change in those values. You can create a new column using <code>mutate()</code> to do the math and show the difference.</li>
<li>Do you need the mean (average), median or sum of a column, or certain values within columns? The the <code>group_by()</code> and <code>summarize()</code> functions are likely your tool to discover those values.</li>
</ul>
</div>
<div id="explore-the-distributions-in-your-data" class="section level2">
<h2><span class="header-section-number">12.6</span> Explore the distributions in your data</h2>
<p>We didn’t talk about histograms in class, but sometimes you might want see the “distributon” of values in your data, i.e. how the values vary within the column. Are many of the values similar? A histogram can show this.</p>
<p>Here is an example of a histogram from our wells data exploring the borehole_depth. Each bar represents the number of wells broken down in 100ft depth increments (set with <code>binwidth=100</code>). So the first bar shows that most of the wells (more than 7000) are less than 100 feet deep.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb112-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> borehole_depth)) <span class="op">+</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>)</a></code></pre></div>
<div class="figure">
<img src="images/explore-histogram.png" alt="Borehole depth histogram" />
<p class="caption">Borehole depth histogram</p>
</div>
<p>While there are wells deeper than 1000 feet, they are so few they don’t even show on the graphic.</p>
<p>You’ll rarely use a histogram as a graphic with a story because they are more difficult to explain to readers. But they do help you to understand how much values differ within a column.</p>
<div id="more-on-histograms" class="section level3">
<h3><span class="header-section-number">12.6.1</span> More on histograms</h3>
<p>If you google around, you might see other ways to create a histogram, including <code>hist()</code> and <code>qplot()</code>. You might stick with the ggplot’s <code>geom_histogram()</code> since you already are familiar with the syntax.</p>
<ul>
<li><a href="https://www.datacamp.com/community/tutorials/make-histogram-ggplot2">Tutorial on histograms</a> using ggplot from DataCamp.</li>
<li><a href="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/">R Cookbook</a> on histograms.</li>
</ul>
<!--chapter:end:12-explore.Rmd-->
</div>
</div>
</div>
<div id="publishing-your-findings" class="section level1">
<h1><span class="header-section-number">13</span> Publishing your findings</h1>
<blockquote>
<p>A work in progress</p>
</blockquote>
<p>Exploring a data set in R is different than publishing your findings. When you are exploring, you will ask a lot of questions and create a lot of plots that will lead to nothing. That is OK. Keep them, and write notes to your future self why you think each plot is NOT interesting, so when you return to it later you’ll see you already studied that path. This is a document for your current and future self.</p>
<p>But once you’ve done all your exploring and FOUND things – findings that become sentences in your story – you may want to (you <em>should</em>) create a new notebook that focuses on these findings and how they relate to the story. You can use this more formal R notebook as a way to explain to readers and others the specific ways you came to your conclusions. This is a document for the public, and should be written as such. Get editing help to make sure you are clear and concise in your writing.</p>
<p>Some things to consider:</p>
<ul>
<li>Include links to the original data. Explain what it is and how it applies to your story. Include a link to the published story if you have it.</li>
<li>Include data dictionaries or similar as files or links so others can see and use the same materials you used to understand the data. If that understanding came through interviews, explain that and include the sources when possible.</li>
<li>If you are pulling from a dataset that will change over time, include the dates you pulled the data. Save a copy of the raw data you used in your final version of the story, if possible, and explain that the data may change as records are added to the original.</li>
<li>If you cleaned or modified to the data, include those steps so they can be repeated. It is sometimes useful to split those steps into a separate notebook and export/import (as an .rds file) into subsequent notebooks.</li>
<li>For each finding, use a headline and text to explain the code block that follows. After the code block, write out your finding and how it relates to your story.</li>
<li>Unless there is a good reason not to, stick with the findings you actually used in your story. Don’t waste readers’ time going down paths that were not reported.</li>
</ul>
<div id="examples" class="section level2">
<h2><span class="header-section-number">13.1</span> Examples</h2>
<blockquote>
<p>Not all of these examples are in R. Some are done in Python, but the theory is the same.</p>
</blockquote>
<ul>
<li>Buzzfeed <a href="https://github.com/BuzzFeedNews/everything">lists all their data analysis</a> in a special Github repo. Their computational journalists use both R and Python, depending on the author or project.</li>
<li>The L.A. Times also publishes <a href="https://github.com/datadesk/notebooks">a list of their data analysis projects</a> in their Github account. Most of their analysis is done in Python (usually in files that end with <code>.ipynb</code>) and the depth of the annotations vary.</li>
<li>The Washington Post Investigative team has begun hosting <a href="https://github.com/wpinvestigative">analysis from their stories</a> in their their Github repo.</li>
<li>Statesman
<ul>
<li><a href="https://github.com/statesman/question-of-restraint-analysis">A Question of Restraint</a></li>
<li><a href="https://github.com/statesman/demolitions/blob/master/notebooks/02_Analysis_Full_demos.ipynb">Demolition permits in Austin</a></li>
</ul></li>
<li><a href="https://github.com/baltimore-sun-data">Baltimore Sun Data Desk</a></li>
<li><a href="https://github.com/trendct-data">Trend CT</a></li>
<li><a href="http://srfdata.github.io/">SRF Data</a>, the data investigative unit of a Swiss TV/Radio network, has robust documentation of their R analysis for stories.</li>
</ul>
</div>
<div id="how-to-publish-your-projects" class="section level2">
<h2><span class="header-section-number">13.2</span> How to publish your projects</h2>
<blockquote>
<p>Needs expounding: what is the HTML file</p>
</blockquote>
<ul>
<li>Explain about the HTML file and how it differs from the .Rmd file.</li>
<li>Explain Advantages to separate Github repos</li>
<li>Use chunk options to hide output or code that is not relevant to the reader.</li>
</ul>
<div id="using-github-pages" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Using Github Pages</h3>
<blockquote>
<p>Needs research and expounding</p>
</blockquote>
<ul>
<li>If you are saving your projec to Github, you can set your RMarkdown documents to knit the HTML versions of your documents into a <code>/docs/</code> folder. As such, you can use Github Pages to <a href="https://help.github.com/en/articles/configuring-a-publishing-source-for-github-pages#publishing-your-github-pages-site-from-a-docs-folder-on-your-master-branch">publish your docs</a> folder.</li>
</ul>
<p>In the metadata for your RMarkdown document, include the <strong>output</strong> lines outlined below.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="op">---</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2">title<span class="op">:</span><span class="st"> &quot;R Notebook&quot;</span></a>
<a class="sourceLine" id="cb113-3" data-line-number="3">output<span class="op">:</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="st">  </span>html_document<span class="op">:</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="st">    </span>df_print<span class="op">:</span><span class="st"> </span>paged</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">knit<span class="op">:</span><span class="st"> </span>(<span class="cf">function</span>(inputFile, encoding) { rmarkdown<span class="op">::</span><span class="kw">render</span>(inputFile, <span class="dt">encoding =</span> encoding, <span class="dt">output_dir =</span> <span class="st">&quot;docs&quot;</span>) })</a>
<a class="sourceLine" id="cb113-7" data-line-number="7"><span class="op">---</span></a></code></pre></div>
</div>
</div>
<div id="making-branded-graphics" class="section level2">
<h2><span class="header-section-number">13.3</span> Making branded graphics</h2>
<p>We haven’t explored many ways to change the theme or looks of our ggplot graphics, but here are some notes worth exploring.</p>
<ul>
<li>ggplot <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">themes</a> can be added with one line.</li>
<li><a href="https://michaeltoth.me/you-need-to-start-branding-your-graphs-heres-how-with-ggplot.html">Branding ggplot graphs</a></li>
<li>Note <a href="https://medium.com/bbc-visual-and-data-journalism/how-the-bbc-visual-and-data-journalism-team-works-with-graphics-in-r-ed0b35693535">this article about BBC using R, ggplot</a>. BBC created the <a href="https://github.com/bbc/bbplot">bblot</a> package to set BBC default styles, and <a href="https://bbc.github.io/rcookbook/">BBC R cookook</a> as a collection of tips and tricks to build their styled graphics. It’s just an example of you can customize R graphics.</li>
</ul>
<!--chapter:end:13-publishing.Rmd-->
</div>
</div>
<div id="chart-examples" class="section level1">
<h1><span class="header-section-number">14</span> Chart examples</h1>
<blockquote>
<p>Under construction</p>
</blockquote>
<p>This will be a annotated list of chart code and examples from this book. It does not include the construction of the data frame used in the plot. (I’ll try to go back and add links.)</p>
<div id="bar-charts" class="section level2">
<h2><span class="header-section-number">14.1</span> Bar charts</h2>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="kw">ggplot</span>(wells_by_county, <span class="kw">aes</span>(<span class="dt">x =</span> county, <span class="dt">y =</span> wells_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb114-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>wells_count), <span class="dt">vjust=</span><span class="op">-</span><span class="fl">0.45</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb114-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Wells by county&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of wells drilled&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="images/visualize-county-by-year-done.png" alt="Wells by county with title" />
<p class="caption">Wells by county with title</p>
</div>
<div id="explanaton" class="section level3">
<h3><span class="header-section-number">14.1.1</span> Explanaton</h3>
<ul>
<li>This is a <code>geom_bar()</code> using <code>stat=&quot;identity&quot;</code>. See below for a similar one using <code>geom_col()</code> which assumes the identity of the category.</li>
<li>The <code>geom_text()</code> line adds the numbers to the top of the bars. <code>vjust</code> moves those number up vertically.</li>
<li>The <code>labs()</code> add the title and modifies the <code>x</code> and <code>y</code> labels. The <code>x</code> value is set to blank because the county labels on the bar is enough.</li>
</ul>
</div>
</div>
<div id="column-chart" class="section level2">
<h2><span class="header-section-number">14.2</span> Column chart</h2>
<p>This is the same as above, but using <code>geom_col</code> which inheriently understands the <code>stat=&quot;identity&quot;</code> problem.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">ggplot</span>(wells_by_county, <span class="kw">aes</span>(<span class="dt">x =</span> county, <span class="dt">y =</span> wells_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>wells_count), <span class="dt">vjust=</span><span class="op">-</span><span class="fl">0.45</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Wells by county&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of wells drilled&quot;</span>)</a></code></pre></div>
<p>It looks the same as above, and is probably the better choice.</p>
</div>
<div id="a-line-chart" class="section level2">
<h2><span class="header-section-number">14.3</span> A line chart</h2>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw">ggplot</span>(wells_county_year, <span class="kw">aes</span>(<span class="dt">x=</span>year_drilled, <span class="dt">y=</span>wells_drilled)) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span>county)) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Wells by county and year&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of wells&quot;</span>)</a></code></pre></div>
<div class="figure">
<img src="images/visualize-county-year-line.png" alt="Wells drilled by county by year" width="500" />
<p class="caption">Wells drilled by county by year</p>
</div>
<div id="explanation" class="section level3">
<h3><span class="header-section-number">14.3.1</span> Explanation</h3>
<ul>
<li>A <code>geom_line()</code> needs either a <code>group=</code> or a <code>color=</code> to “split” the lines on a category across the graphic. This example does this by setting a specific <code>aes()</code> color value in the <code>geom_line()</code> call.</li>
<li>In this example, the title and pretty x and y labels are added with <code>labs()</code></li>
</ul>
</div>
</div>
<div id="scatterplot-1" class="section level2">
<h2><span class="header-section-number">14.4</span> Scatterplot</h2>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span><span class="co"># added color aesthetic</span></a>
<a class="sourceLine" id="cb117-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<div class="figure">
<img src="images/visualize-mpg-03.png" alt="MPG: disply vs mpg with class" />
<p class="caption">MPG: disply vs mpg with class</p>
</div>
<div id="explanation-1" class="section level3">
<h3><span class="header-section-number">14.4.1</span> Explanation</h3>
<ul>
<li>This plot uses the <code>mpg</code> data ggplot. It is comparing <code>displ</code> (the size of an engine) to <code>mpg</code>, the miles per gallon of the car.</li>
<li>The <code>goem_point()</code> adds a new aesthetic to color the dots based on another value in the data, the <code>class</code>.</li>
<li>The <a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html"><code>geom_smooth()</code></a> plot adds a line showing the average of the points at each position. This helps you determine if there is a relationshiop between the two variables.</li>
</ul>
</div>
</div>
<div id="histogram" class="section level2">
<h2><span class="header-section-number">14.5</span> Histogram</h2>
<p>A histogram is a distribution of a number in your data. It’s super useful in helping understand your data, but difficult to explain to readers.</p>
<p>We’ll use the well’s data column <code>borehole_depth</code> to explore this. The question is this: Are most wells shallow or deep? We can explore this with the histogram.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> borehole_depth)) <span class="op">+</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Depth of wells&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;More than 7,500 of the 18,000 wells drilled since 2005 are less than 100-feet deep.&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Wells drilled&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Depth in 100ft increments&quot;</span>)</a></code></pre></div>
<p>The histogram chart defaults to splitting into 30 even groups, but you can change that in a couple of ways.</p>
<ul>
<li>Using <code>bin = 40</code> will set a different number of bins.</li>
<li>Using <code>binwidth = 100</code> will create bins based on your x value.</li>
</ul>
<p>That yields this chart:</p>
<div class="figure">
<img src="images/examples-histogram01.png" alt="Histogram example" />
<p class="caption">Histogram example</p>
</div>
<p>You can add labels to note the number of records in each bin with the <code>stat_bin()</code> function, which is a bit different than other ggplot functions. Here’s an example in the last line of this plot:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">wells <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> borehole_depth)) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Depth of wells&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;More than 7,500 of the 18,000 wells drilled since 2005 are less than 100-feet deep.&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Wells drilled&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Depth in 100ft increments&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_bin</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>, <span class="dt">geom=</span><span class="st">&quot;text&quot;</span>, <span class="kw">aes</span>(<span class="dt">label =</span> ..count..), <span class="dt">vjust=</span><span class="op">-</span>.<span class="dv">5</span>)</a></code></pre></div>
</div>
<div id="titles-labels-and-other-cleanup" class="section level2">
<h2><span class="header-section-number">14.6</span> Titles, labels and other cleanup</h2>
<p>Titles and labels are added as new layers on a graphic. These examples just show the line that adds the new layer.</p>
<div id="title-and-axis-labels" class="section level3">
<h3><span class="header-section-number">14.6.1</span> Title and axis labels</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">yourchartsofar <span class="op">+</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Wells by county and year&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Number of wells&quot;</span>)</a></code></pre></div>
</div>
<div id="flip-the-graphic" class="section level3">
<h3><span class="header-section-number">14.6.2</span> Flip the graphic</h3>
<p>Sometime you want to turn a graphic 90 degrees to you can read long values, or make a bar chart horizontal instead of vertical.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">yourchartsofar <span class="op">+</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
</div>
<div id="fix-exponential-numbers-on-an-axis" class="section level3">
<h3><span class="header-section-number">14.6.3</span> Fix exponential numbers on an axis</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">yourchartsofar <span class="op">+</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>comma)</a></code></pre></div>
<p>You can do the same for <code>scale_x_continuous()</code> if needed.</p>
</div>
</div>
<div id="interactivity-with-plotly" class="section level2">
<h2><span class="header-section-number">14.7</span> Interactivity with plotly</h2>
<p>This requires a library in addition to the tidyverse called <code>library(plotly)</code>. The idea is that you:</p>
<ul>
<li>create a ggplot graphic.</li>
<li>save that entire graphic to a new R object.</li>
<li>Call the <code>ggplotly()</code> function with that new variable.</li>
</ul>
<pre><code>saved_plot &lt;- wells_county_year %&gt;%
  ggplot(aes(x = year_drilled, y = wells_drilled, color = county)) + 
  geom_line() +
  geom_point() +
  labs(title = &quot;Wells drilled per county&quot; )

# shove into ggploty
ggplotly(saved_plot)</code></pre>
<p>This screen shot below is not interactive, but you can see the hover tool tip displayed.</p>
<div class="figure">
<img src="images/graphics-wells-county-plotly.png" alt="Wells by county with ggplotly" />
<p class="caption">Wells by county with ggplotly</p>
</div>
</div>
<div id="resources-5" class="section level2">
<h2><span class="header-section-number">14.8</span> Resources</h2>
<p>In addition to the examples below, you might also look at these resources:</p>
<ul>
<li><a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a></li>
<li><a href="http://www.cookbook-r.com/Graphs/">R Graphics Cookbook</a></li>
<li><a href="https://plot.ly/r/">Plotly R</a>, especially the <a href="https://plot.ly/ggplot2/">Plotly ggplot2 Library</a></li>
<li><a href="">ggplot themes</a><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="uri">https://ggplot2.tidyverse.org/reference/ggtheme.html</a> and <a href="https://www.r-graph-gallery.com/192-ggplot-themes/">R Graph theme list</a></li>
</ul>
<!--chapter:end:14-examples.Rmd-->
</div>
</div>
<div id="verbs" class="section level1">
<h1><span class="header-section-number">15</span> Verbs</h1>
<p>An opinionated list of the most common <a href="https://www.tidyverse.org/">Tidyverse</a> and other R verbs used with data storytelling.</p>
<div id="importexport" class="section level2">
<h2><span class="header-section-number">15.1</span> Import/Export</h2>
<ul>
<li><a href="https://readr.tidyverse.org/reference/read_delim.html"><code>read_csv()</code></a> imports data from a CSV file. (It handles data types better than the base R <code>read.csv()</code>). Also <code>write_csv()</code> when you need export as CSV. <strong>Example:</strong> <code>read_csv(&quot;path/to/file.csv&quot;)</code>.</li>
<li><a href="https://readr.tidyverse.org/reference/read_rds.html"><code>write_rds</code></a> to save a data frame as an <code>.rds</code> R data data file. This preserves all the data types. <a href="https://readr.tidyverse.org/reference/read_rds.html"><code>read_rds()</code></a> to import R data. <strong>Example:</strong> <code>read_rds(&quot;path/to/file.rds&quot;)</code>.</li>
<li><a href="https://readxl.tidyverse.org/"><code>readxl</code></a> is a package we didn’t talk about, but it has <a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel()</a> that allows you to import from an Excel file, including specified sheets.</li>
<li><a href="">clean_names()</a> from the <code>library(janitor)</code> package standardizes column names.</li>
</ul>
</div>
<div id="data-manipulation" class="section level2">
<h2><span class="header-section-number">15.2</span> Data manipulation</h2>
<ul>
<li><a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a> to select columns. <strong>Example:</strong> <code>select(col01, col02)</code> or <code>select(-excluded_col)</code>.</li>
<li><a href="https://dplyr.tidyverse.org/reference/select.html"><code>rename()</code></a> to rename a column. <strong>Example:</strong> <code>rename(new_name = old_name)</code>.</li>
<li><a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a> to filter rows of data. <strong>Example:</strong> <code>filter(column_name == &quot;value&quot;)</code>.
<ul>
<li>See <a href="https://www.rdocumentation.org/packages/base/versions/3.5.3/topics/Logic">Relational Operators</a> like <code>==</code>, <code>&gt;</code>, <code>&gt;=</code> etc.</li>
<li>See <a href="https://www.rdocumentation.org/packages/base/versions/3.5.3/topics/Logic">Logical operators</a> like <code>&amp;</code>, <code>|</code> etc.</li>
<li>See <a href="https://www.rdocumentation.org/packages/base/versions/3.5.3/topics/NA">is.na</a> tests if a value is missing.</li>
</ul></li>
<li><a href="https://dplyr.tidyverse.org/reference/distinct.html"><code>distinct()</code></a> will filter rows down to the unique values of the columns given.</li>
<li><a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange()</code></a> sorts data based on values in a column. Use <code>desc()</code> to reverse the order. <strong>Example:</strong> <code>arrange(col_name %&gt;% desc())</code></li>
<li><a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a> changes and existing column or creates a new one. <strong>Example:</strong> <code>mutate(new_col = (col01 / col02))</code>.</li>
<li><a href="https://tidyr.tidyverse.org/reference/gather.html"><code>gather()</code></a> collapses columns into two, one a key and the other a value. Turns wide data into long. <strong>Example:</strong> <code>gather(key = &quot;new_key_col_name&quot;, value = &quot;new_val_col_name&quot;, 3:5)</code> will gather columns 3 through 5. Can also name columns to gather.</li>
<li><a href="https://tidyr.tidyverse.org/reference/spread.html"><code>spread()</code></a> turns long data into wide by spreading into multiple columns based on as key.</li>
</ul>
</div>
<div id="aggregation" class="section level2">
<h2><span class="header-section-number">15.3</span> Aggregation</h2>
<ul>
<li><a href="https://dplyr.tidyverse.org/reference/tally.html"><code>count()</code></a> will count the number rows based on columns you feed it.</li>
<li><a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by()</code></a> and <a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarize()</code></a> often come together. When you use <code>group_by()</code>, every function after it is broken down by that grouping. <strong>Example:</strong> <code>group_by(song, artist) %&gt;% summarize(weeks = n(), top_chart_position = min(peak_position))</code></li>
</ul>
</div>
<div id="math" class="section level2">
<h2><span class="header-section-number">15.4</span> Math</h2>
<p>These are the function often used within <code>summarize()</code>:</p>
<ul>
<li><a href="https://dplyr.tidyverse.org/reference/n.html"><code>n()</code></a> to count the number of rows. <a href="https://dplyr.tidyverse.org/reference/n_distinct.html"><code>n_distinct()</code></a> counts the unique values.</li>
<li><code>sum()</code> to add things together.</li>
<li><code>mean()</code> to get an average.</li>
<li><code>median()</code> to get the median.</li>
<li><code>min()</code> to get the smallest value. <code>max()</code> for the largest.</li>
<li><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> are math operators similar to a calculator.</li>
</ul>
<!--chapter:end:15-verbs.Rmd-->
</div>
</div>
<div id="notes-about-future-sessions" class="section level1 unnumbered">
<h1>Notes about future sessions</h1>
<div id="maps" class="section level2 unnumbered">
<h2>Maps</h2>
<ul>
<li>Andrew Tran’s <a href="https://github.com/andrewbtran/NICAR/tree/master/2019/mapping">mapping session from NICAR</a></li>
<li><a href="https://github.com/trinker/mapit/blob/master/R/geo_code.R">Geocoding package</a></li>
</ul>
</div>
<div id="joins-1" class="section level2 unnumbered">
<h2>Joins</h2>
<p>Add this as a short lesson on joining and merging files.</p>
</div>
<div id="data-packages" class="section level2 unnumbered">
<h2>Data packages</h2>
<p>Add a chapter that lists various data packages and such.</p>
<ul>
<li><a href="https://googledrive.tidyverse.org/">googledrive</a> to get data from Google Drive. Could do the perhaps do the ice cream and princess graphics.</li>
</ul>
<div id="twitter" class="section level3 unnumbered">
<h3>Twitter</h3>
<ul>
<li><a href="https://rtweet-workshop.mikewk.com/#1">Slides</a> from a <a href="https://github.com/mkearney/rtweet-workshop">rtweets</a> package workshop.</li>
</ul>
</div>
</div>
<div id="tools-for-pdfs" class="section level2 unnumbered">
<h2>Tools for PDFs</h2>
<p><code>@abtran</code> says: In R, there are a handful of packages I cycle through depending on the quality of the PDFs:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/tabulizer/vignettes/tabulizer.html">tabulizer</a> will detect tables, will let you set parameters for where to find the tables, or lets you interactively set the parameters. <a href="https://rpubs.com/gd6/291026">Another example</a>.</li>
<li>sometimes the PDFs need to be OCR’d first, then I use <a href="https://cran.r-project.org/web/packages/tesseract/vignettes/intro.html">Tesseract’s R bindings</a>.</li>
<li>and finally there’s <a href="https://ropensci.org/technotes/2018/12/14/pdftools-20/">pdftools</a>, which also extracts tables.</li>
<li>here’s a <a href="https://www.youtube.com/watch?v=tHszX31_r4s&amp;feature=youtu.be&amp;t=1298">video of Hadley Wickham</a> scraping pdfs and turning the data into dataframes</li>
</ul>
</div>
<div id="more-graphics-ideas" class="section level2 unnumbered">
<h2>More graphics ideas</h2>
<ul>
<li>RStudio add in <a href="https://github.com/dreamRs/esquisse">esquisse</a> with UI for easy ggplot graphics.</li>
<li><a href="https://plot.ly/r/">Plotly</a> for interactive charts with hovers. There is also a <a href="https://plot.ly/ggplot2/">ggplot port</a> that makes ggplot graphics interactive. It appears use of the open source library is free. When you get into publishing embeddable graphics, there is cost.</li>
<li><a href="https://davidgohel.github.io/ggiraph/articles/offcran/using_ggiraph.html">ggirafe</a> is yet another port to make <strong>ggplot</strong> interactive.</li>
</ul>
</div>
<div id="matt-waite-ideas-yet-to-incorporate" class="section level2 unnumbered">
<h2>Matt Waite ideas yet to incorporate</h2>
<ul>
<li>Uses sports data to make a <a href="https://github.com/hrbrmstr/waffle">waffle chart</a>, which is pretty cool. A better way than a pie chart to compare two values, or even multiples of a whole.</li>
<li><a href="https://www.displayr.com/formattable/">formattable</a> could be useful. More features than tabyl.</li>
</ul>
<!--chapter:end:98-notes.Rmd-->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<p>Figures and tables with captions will be placed in <code>figure</code> and <code>table</code> environments, respectively.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">.1</span>, <span class="fl">.1</span>))</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="kw">plot</span>(pressure, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="99-references_files/figure-html/nice-fig-1.png" alt="Here is a nice figure!" width="80%" />
<p class="caption">
(#fig:nice-fig)Here is a nice figure!
</p>
</div>
<p>Reference a figure by its code chunk label with the <code>fig:</code> prefix, e.g., see Figure @ref(fig:nice-fig). Similarly, you can reference tables generated from <code>knitr::kable()</code>, e.g., see Table @ref(tab:nice-tab).</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">  <span class="kw">head</span>(iris, <span class="dv">20</span>), <span class="dt">caption =</span> <span class="st">&#39;Here is a nice table!&#39;</span>,</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">  <span class="dt">booktabs =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb125-4" data-line-number="4">)</a></code></pre></div>
<table>
<caption>(#tab:nice-tab)Here is a nice table!</caption>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">5.1</td>
<td align="right">3.5</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">3.0</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">4.7</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.6</td>
<td align="right">3.1</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.0</td>
<td align="right">3.6</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.4</td>
<td align="right">3.9</td>
<td align="right">1.7</td>
<td align="right">0.4</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">4.6</td>
<td align="right">3.4</td>
<td align="right">1.4</td>
<td align="right">0.3</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.0</td>
<td align="right">3.4</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">4.4</td>
<td align="right">2.9</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">3.1</td>
<td align="right">1.5</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.4</td>
<td align="right">3.7</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.8</td>
<td align="right">3.4</td>
<td align="right">1.6</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">4.8</td>
<td align="right">3.0</td>
<td align="right">1.4</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.3</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.8</td>
<td align="right">4.0</td>
<td align="right">1.2</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.7</td>
<td align="right">4.4</td>
<td align="right">1.5</td>
<td align="right">0.4</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.4</td>
<td align="right">3.9</td>
<td align="right">1.3</td>
<td align="right">0.4</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.1</td>
<td align="right">3.5</td>
<td align="right">1.4</td>
<td align="right">0.3</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.7</td>
<td align="right">3.8</td>
<td align="right">1.7</td>
<td align="right">0.3</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.1</td>
<td align="right">3.8</td>
<td align="right">1.5</td>
<td align="right">0.3</td>
<td align="left">setosa</td>
</tr>
</tbody>
</table>
<p>You can write citations, too. For example, we are using the <strong>bookdown</strong> package <span class="citation">(Xie <a href="#ref-R-bookdown">2018</a>)</span> in this sample book, which was built on top of R Markdown and <strong>knitr</strong> <span class="citation">(Xie <a href="#ref-xie2015">2015</a>)</span>.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co">#     download: [&quot;pdf&quot;, &quot;epub&quot;]</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="co"># bookdown::pdf_book:</span></a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="co">#   includes:</span></a>
<a class="sourceLine" id="cb126-4" data-line-number="4"><span class="co">#     in_header: preamble.tex</span></a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="co">#   latex_engine: xelatex</span></a>
<a class="sourceLine" id="cb126-6" data-line-number="6"><span class="co">#   citation_package: natbib</span></a>
<a class="sourceLine" id="cb126-7" data-line-number="7"><span class="co">#   keep_tex: yes</span></a>
<a class="sourceLine" id="cb126-8" data-line-number="8"><span class="co"># bookdown::epub_book: default</span></a></code></pre></div>
<!--chapter:end:99-references.Rmd-->
<div id="refs" class="references">
<div id="ref-xie2015">
<p>Xie, Yihui. 2015. <em>Dynamic Documents with R and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://yihui.name/knitr/">http://yihui.name/knitr/</a>.</p>
</div>
<div id="ref-R-bookdown">
<p>———. 2018. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown">https://CRAN.R-project.org/package=bookdown</a>.</p>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

</body>

</html>
